{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:lib/lib/core.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/RoomTypeConfig.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/channels.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/conversation.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/direct.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/favorite.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/index.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/private.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/public.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/unread.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/getURL.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/callbacks.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/fileUploadRestrictions.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/getAvatarColor.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/getValidRoomName.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/placeholders.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/promises.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/RoomTypesCommon.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/slashCommand.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/Message.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/messageBox.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/MessageTypes.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/templateVarHandler.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/getUserPreference.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/startup/settingsOnLoadSiteUrl.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/debug.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/bugsnag.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/metrics.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/RateLimiter.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/configLogger.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/PushNotification.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/defaultBlockedDomainsList.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/interceptDirectReplyEmails.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/loginErrorMessageOverride.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/notifyUsersOnMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/processDirectEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/roomTypes.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/sendEmailOnMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/sendNotificationsOnMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/validateEmailDomain.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/index.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/isDocker.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/addUserToDefaultChannels.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/addUserToRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/archiveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/checkUsernameAvailability.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/checkEmailAvailability.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/createRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/deleteMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/deleteUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/getFullUserData.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/getRoomByNameOrIdWithOptionToJoin.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/removeUserFromRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/saveUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/saveCustomFields.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/saveCustomFieldsWithoutValidation.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/sendMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/setUserAvatar.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/setUsername.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/setRealName.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/setEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/unarchiveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/updateMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/validateCustomFields.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/Notifications.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/_Base.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Avatars.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Messages.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Reports.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Rooms.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Subscriptions.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Uploads.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Users.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/_BaseCache.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/_BaseDb.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/oauth/oauth.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/oauth/google.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/oauth/proxy.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/statsTracker.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/cache/CacheLoad.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/settingsOnLoadCdnPrefix.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/settingsOnLoadDirectReply.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/settingsOnLoadSMTP.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/oAuthServicesUpdate.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/publications/settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/addOAuthService.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/refreshOAuthService.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/addUserToRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/addUsersToRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/archiveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/blockUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/checkRegistrationSecretURL.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/checkUsernameAvailability.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/cleanChannelHistory.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/createChannel.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/createToken.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/createPrivateGroup.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/deleteMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/deleteUserOwnAccount.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/filterBadWords.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/filterATAllTag.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getChannelHistory.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getFullUserData.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getRoomJoinCode.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getRoomRoles.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getServerInfo.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getSingleMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getUserRoles.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/insertOrUpdateUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/joinDefaultChannels.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/joinRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/leaveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/removeOAuthService.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/restartServer.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/robotMethods.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/saveSetting.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/sendInvitationEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/sendMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/sendSMTPTestEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/setAdminStatus.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/setRealName.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/setUsername.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/setEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/unarchiveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/unblockUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/updateMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/startup/defaultRoomTypes.js"],"names":["EventEmitter","module","watch","require","default","v","RocketChat","models","export","RoomSettingsEnum","UiTextContext","RoomTypeRouteConfig","RoomTypeConfig","NAME","TOPIC","ANNOUNCEMENT","DESCRIPTION","READ_ONLY","REACT_WHEN_READ_ONLY","ARCHIVE_OR_UNARCHIVE","JOIN_CODE","CLOSE_WARNING","HIDE_WARNING","LEAVE_WARNING","NO_ROOMS_SUBSCRIBED","constructor","name","path","length","Error","_name","_path","identifier","Random","id","order","icon","header","label","route","_identifier","_order","_icon","_header","_label","_route","getDisplayName","room","allowRoomSettingChange","canBeCreated","Meteor","isServer","authz","hasAtLeastOnePermission","userId","canBeDeleted","t","_id","supportMembersList","isGroupChat","canAddUser","userDetailShowAll","userDetailShowAdmin","preventRenaming","includeInRoomSearch","enableMembersListProfile","getUiText","ChannelsRoomType","condition","user","roomsListExhibitionMode","getUserPreference","mergeChannels","includes","ConversationRoomType","DirectMessageRoomRoute","DirectMessageRoomType","action","params","openRoom","username","link","sub","findRoom","query","subscription","ChatSubscription","findOne","rid","ChatRoom","roomName","roomData","fields","fname","settings","get","secondaryRoomName","getUserStatus","roomId","Subscriptions","Session","usernames","join","setting","context","FavoriteRoomType","PrivateRoomType","PublicRoomType","UnreadRoomType","PrivateRoomRoute","hasAllPermission","PublicRoomRoute","showJoinLink","unread","s","getURL","cdn","full","cdnPrefix","rtrim","trim","pathPrefix","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","basePath","finalPath","ltrim","isCordova","absoluteUrl","_","callbacks","regexCallbacks","ts","Date","callback","onload","Object","keys","forEach","key","value","isRegExp","test","reduce","items","push","set","call","batchSet","save","editor","actions","map","reduceRight","wrap","err","success","load","initialLoad","item","cbKey","cbValue","regex","concat","k","source","showTime","showTotalTime","priority","HIGH","MEDIUM","LOW","add","hook","isNumber","stack","find","cb","remove","hookName","reject","run","constant","totalTime","result","sortBy","time","now","callbackResult","currentTime","statsTracker","timing","split","match","console","log","String","runAsync","defer","fileUploadMediaWhiteList","mediaTypeWhiteList","fileUploadIsValidContentType","type","list","contains","wildCardGlob","wildcards","filter","indexOf","replace","colors","getAvatarColor","getValidRoomName","displayName","slugifiedName","Rooms","findOneByDisplayName","archived","function","channel_name","slugify","nameValidation","RegExp","error","findOneByName","tmpName","next","findOneByNameAndNotId","placeholders","str","data","strLeft","strRightBack","email","password","unsubscribe","promises","p","Promise","resolve","previousPromise","then","RoomTypesCommon","roomTypes","roomTypesOrder","mainOrder","roomConfig","routeConfig","isClient","triggersExit","roomExit","FlowRouter","hasCustomLink","roomType","getRouteLink","subData","routeData","openRouteLink","queryParams","go","slashCommands","commands","command","options","description","clientOnly","methods","slashCommand","method","cmd","msg","Message","parse","language","messageType","MessageTypes","getType","render","template","message","localStorage","getItem","TAPi18n","__","u","html","escapeHTML","messageBox","group","config","actionExists","ret","getById","messageActions","types","registerType","isSystemMessage","system","startup","room_name","user_by","user_added","user_removed","user_left","user_muted","user_unmuted","role","logger","Logger","templateVarHandler","variable","object","templateRegex","exec","tmpVariable","hasOwnProperty","debug","tmplVar","tmplAttrName","attrVal","defaultValue","undefined","preference","preferences","host","ROOT_URL","defaultOptions","rootUrl","hostname","process","env","MOBILE_ROOT_URL","MOBILE_DDP_URL","WebAppInternals","generateBoilerplate","publish","wrapMethods","originalHandler","methodsMap","args","Array","prototype","slice","arguments","apply","originalMeteorMethods","methodMap","each","handler","originalMeteorPublish","func","WebApp","rawConnectHandlers","use","req","res","setHeader","InstanceStatus","bugsnag","register","notify","Info","app","version","info","on","bindEnvironment","originalMeteorDebug","_debug","client","promclient","metrics","messagesSent","Counter","RateLimiter","limitFunction","fn","numRequests","timeInterval","matchers","TEST_MODE","rateLimiter","addRule","matcher","increment","rateLimitResult","check","allowed","Math","ceil","timeToReset","seconds","limitMethod","methodName","DDPRateLimiter","LoggerManager","showPackage","showFileAndLine","logLevel","parseInt","setTimeout","enable","PushNotification","getNotificationId","serverId","hash","i","charCodeAt","send","usersTo","payload","badge","category","title","url","defaultUrl","from","sound","text","notId","gcm","style","summaryText","image","apn","Push","emailDomainDefaultBlackList","IMAPIntercepter","POP3Intercepter","POP3Helper","IMAP","POP3","simpleParser","imap","port","tls","connTimeout","keepalive","delete","state","openInbox","getEmails","end","openBox","start","connect","isActive","stop","Function","once","restart","search","newEmails","f","fetch","bodies","struct","markSeen","seqno","stream","headerBuffer","bodyBuffer","chunk","which","toString","body","headers","parseHeader","to","date","seq","addFlags","processDirectEmail","pop3","enabletls","totalMsgCount","currentMsgCount","login","status","msgcount","retr","quit","msgnumber","mail","initialProcess","dele","messageId","running","setInterval","max","clearInterval","_runLoginHandlers","Accounts","methodInvocation","reason","moment","editedAt","abs","diff","incMsgCountById","lastMessage","setLastMessageById","messageContainsHighlight","highlights","has","some","highlight","regexp","escapeRegExp","toAll","toHere","mentionIds","highlightsIds","Users","findUsersByUsernamesWithHighlights","mentions","mention","userHighlights","unreadCountDM","incUnreadForRoomIdExcludingUserId","incGroupMentionsAndUnreadForRoomIdExcludingUserId","incUserMentionsAndUnreadForRoomIdAndUserIds","compact","unique","unreadCount","incUnread","incMsgCountAndSetLastMessageById","setAlertForRoomIdExcludingUserId","reply","EmailReplyParser","sendMessage","sentByEmail","groupable","tsDiff","findOneByEmailAddress","prevMessage","Messages","findOneById","mid","roomInfo","prevMessageLink","findOneByRoomIdAndUserId","blocked","blocker","muted","alias","inc","parse_reply","roomTypesServer","setPublish","setRoomFind","roomFind","getRoomFind","runPublish","scope","getEmailContent","messageContent","lng","userName","channel","file","fileHeader","content","attachments","attachment","getMessageLink","roomPath","divisorMessage","messageHTML","tokens","token","footer","usersToSendEmail","isMentionAll","maxMembersForNotification","findByRoomId","userIds","findByRoomIdAndUserIdsOrAllMessages","disableNotifications","emailNotifications","mentionedUser","userIdsToSendEmail","defaultLink","linkByUser","findByRoomIdAndUserIds","usersOfMention","getUsersToSendOfflineEmail","emailNotificationMode","userEmailPreferenceIsDisabled","directMessageEmailPreference","emailSubject","emails","verified","address","subject","Email","CATEGORY_MESSAGE","CATEGORY_MESSAGE_NOREPLY","replaceMentionedUsernamesWithFullNames","canSendMessageToRoom","parseMessageText","image_type","notifyDesktopUser","duration","UI_Use_Real_Name","Notifications","notifyUser","sender","notifyAudioUser","getBadgeCount","subscriptions","findUnreadByUserId","sendPushNotifications","userIdsToPushNotify","push_room","push_username","push_message","pushUsernames","enabled","userIdToNotify","callJoin","active","runAsUser","alwaysNotifyDesktopUsers","dontNotifyDesktopUsers","alwaysNotifyMobileUsers","dontNotifyMobileUsers","desktopNotificationDurations","alwaysNotifyAudioUsers","dontNotifyAudioUsers","audioNotificationValues","canBeNotified","desktop","mobile","audio","disableAllMessageNotifications","findNotificationPreferencesByRoom","users","findUsersByIds","audioNotifications","desktopNotifications","mobilePushNotifications","audioNotificationValue","desktopNotificationDuration","userIdsForAudio","userIdsToNotify","alwaysNotifyMobileBoolean","usersWithHighlights","userOfMentionId","userOfMention","statusConnection","Sandstorm","desktopMentionIds","union","difference","usersOfDesktopMentions","$in","usersOfMentionItem","pluck","mobileMentionIds","usersOfMobileMentionsQuery","$ne","usersOfMobileMentions","userMobile","audioMentionIds","usersOfAudioMentions","e","without","usersOfMentionId","allUserIdsToNotify","dns","Npm","emailDomainBlackList","emailDomainWhiteList","useDefaultBlackList","useDNSDomainCheck","domain","validateEmailDomain","emailValidation","emailDomain","substr","lastIndexOf","wrapAsync","resolveMx","fs","hasDockerEnv","statSync","hasDockerCGroup","readFileSync","isDocker","addUserToDefaultChannels","silenced","defaultRooms","findByDefaultAndTypes","ro","hasPermission","addUsernameById","createWithRoomAndUser","open","alert","userMentions","groupMentions","createUserJoinWithRoomIdAndUser","addUserToRoom","inviter","createUserAddedWithRoomIdAndUser","archiveRoom","archiveById","archiveByRoomId","checkUsernameAvailability","usernameBlackList","every","restrictedUsername","$regex","checkEmailAvailability","createRoom","owner","members","readOnly","extraData","findOneByUsername","slugifiedRoomName","sysMes","assign","createWithTypeNameUserAndUsernames","member","muteUsernameByRoomId","extra","ls","addUserRoles","deleteMessage","keepHistory","showDeletedStatus","deletedMsg","cloneAndSaveAsHistoryById","setHiddenById","Uploads","update","$set","_hidden","removeById","FileUpload","getStore","deleteById","getLastVisibleMessageSentWithNoTypeByRoomId","setAsDeletedByIdAndUser","notifyRoom","deleteUser","removeByUserId","findByUserId","removeByRoomId","removeByTypeContainingUsername","removeUsernameFromAll","avatarOrigin","deleteByName","Integrations","disableByUserId","getFullUserData","limit","utcOffset","extend","phone","createdAt","lastLogin","services","requirePasswordChange","requirePasswordChangeReason","roles","customFields","sort","findByUsername","filterReg","findByUsernameNameOrEmailAddress","getRoomByNameOrIdWithOptionToJoin","_getRoomByNameOrIdWithOptionToJoin","currentUserId","nameOrId","tryDirectByUserIdOnly","joinChannel","errorOnEmpty","startsWith","substring","findOneByIdOrName","roomUser","$or","isObject","removeUserFromRoom","removeUsernameById","removedUser","createUserLeaveWithRoomIdAndUser","createCommandWithRoomIdAndUser","removeByRoomIdAndUserId","saveUser","userData","existingRoles","getRoles","field","escape","input","createUser","joinDefaultChannels","updateUser","sendWelcomeEmail","gravatarUrl","Gravatar","imageUrl","size","secure","setUserAvatar","setUsername","setRealName","setEmail","setPassword","saveCustomFields","formData","validateCustomFields","saveCustomFieldsWithoutValidation","customFieldsMeta","JSON","setCustomFields","fieldName","modifyRecordField","array","$addToSet","upsert","pick","Match","updated_room","parseUrls","urls","sandstormSessionId","insert","blockedSettings","SETTINGS_BLOCKED","settingId","hiddenSettings","SETTINGS_HIDDEN","_sorter","packageValue","valueSource","hidden","sorter","enableQuery","stringify","i18nDefaultQuery","toLowerCase","processEnvValue","meteorSettingsValue","i18nLabel","i18nDescription","updateOperations","$setOnInsert","force","section","$unset","$exists","existantSetting","Settings","db","addGroup","isFunction","updateById","updateValueAndEditorById","updateValueById","updateOptionsById","clearById","init","observe","added","record","changed","removed","afterInitialLoad","onAfterInitialLoad","dataURI","contentType","service","encoding","setAvatarOrigin","HTTP","npmRequestOptions","response","statusCode","fileData","RocketChatFile","dataURIParse","buffer","Buffer","fileStore","notifyLogged","_setUsername","previousUsername","sendEnrollmentEmail","avatarSuggestions","getAvatarSuggestionForUser","gravatar","avatarData","blob","updateAllUsernamesByUserId","updateUsernameOfEditByUserId","findByMention","updatedMsg","updateUsernameAndMessageOfMentionByIdAndOldUsername","replaceUsername","replaceMutedUsername","replaceUsernameOfUserByUserId","setUserUsernameByUserId","setNameForDirectRoomsWithOldName","model","updateFileNameById","_setRealName","setName","_setEmail","unarchiveRoom","unarchiveById","unarchiveByRoomId","updateMessage","editedBy","tempid","fieldValue","required","maxLength","minLength","streamAll","Streamer","streamLogged","streamRoom","streamRoomUsers","streamUser","allowWrite","eventName","findByRoomIdAndNotUserId","allowRead","warn","notifyAll","unshift","emit","notifyAllInThisInstance","emitWithoutBroadcast","notifyLoggedInThisInstance","notifyRoomInThisInstance","notifyUserInThisInstance","ModelsBaseDb","ModelsBaseCache","_CacheControl","EnvironmentVariable","ModelsBase","nameOrModel","useCache","_db","collectionName","_useCache","cache","bind","getDynamicView","processQueryOptionsOnResult","origin","arrayToCursor","count","setUpdatedAt","findOneByIds","ids","insertOrUpsert","allow","deny","ensureIndex","dropIndex","tryEnsureIndex","tryDropIndex","trashFind","trashFindDeletedAfter","_Base","Avatars","before","doc","instanceId","insertAvatarFileInit","store","complete","uploading","progress","extension","uploadedAt","updateFileComplete","fileId","direct","updateFileCompleteByNameAndUserId","deleteFile","sparse","expireAfterSeconds","findVisibleByMentionAndRoomId","findVisibleByRoomId","findVisibleByRoomIdNotContainingTypes","$nin","findInvisibleByRoomId","findVisibleByRoomIdAfterTimestamp","timestamp","$gt","findForUpdates","_updatedAt","findVisibleByRoomIdBeforeTimestamp","$lt","findVisibleByRoomIdBeforeTimestampInclusive","$lte","findVisibleByRoomIdBetweenTimestamps","afterTimestamp","beforeTimestamp","findVisibleByRoomIdBetweenTimestampsInclusive","$gte","findVisibleByRoomIdBeforeTimestampNotContainingTypes","findVisibleByRoomIdBetweenTimestampsNotContainingTypes","findVisibleCreatedOrEditedAfterTimestamp","findStarredByUserAtRoom","findPinnedByRoom","pinned","findSnippetedByRoom","snippeted","getLastTimestamp","findByRoomIdAndMessageIds","messageIds","findOneBySlackBotIdAndSlackTs","slackBotId","slackTs","findOneBySlackTs","me","parent","reactions","setPinnedByIdAndUserId","pinnedBy","pinnedAt","setSnippetedByIdAndUserId","snippetName","snippetedBy","snippetedAt","setUrlsById","multi","oldUsername","newUsername","newMessage","updateUserStarById","starred","$pull","upgradeEtsToEditAt","ets","$rename","setMessageAttachments","setSlackBotIdAndSlackTs","createWithTypeRoomIdMessageAndUser","createUserRemovedWithRoomIdAndUser","createUserMutedWithRoomIdAndUser","createUserUnmutedWithRoomIdAndUser","createNewModeratorWithRoomIdAndUser","createModeratorRemovedWithRoomIdAndUser","createNewOwnerWithRoomIdAndUser","createOwnerRemovedWithRoomIdAndUser","createNewLeaderWithRoomIdAndUser","createLeaderRemovedWithRoomIdAndUser","createSubscriptionRoleAddedWithRoomIdAndUser","createSubscriptionRoleRemovedWithRoomIdAndUser","getMessageByFileId","fileID","Reports","createWithMessageDescriptionAndUserId","ModelRooms","ignoreUpdatedFields","_idOrName","findOneByImportId","importIds","findOneByNameAndType","findOneByIdContainingUsername","findOneByNameAndTypeNotContainingUsername","findById","findByIds","roomIds","findByType","findByTypes","findBySubscriptionUserId","_room","findBySubscriptionUserIdUpdatedAfter","findByNameContaining","nameRegex","findByNameContainingTypesWithUsername","obj","findContainingTypesWithUsername","findByNameContainingAndTypes","findByNameAndTypeNotDefault","findByNameAndTypesNotContainingUsername","findByNameStartingAndTypes","findByTypeContainingUsername","findByTypeContainingUsernames","$all","findByTypesAndNotUserIdContainingUsername","uid","findByContainingUsername","findByTypeAndName","findByIndex","findByTypeAndNameContainingUsername","findByTypeAndArchivationState","archivationstate","addImportIds","$each","addUsernamesById","addUsernameByName","removeUsernamesById","removeUsernameByName","setNameById","$inc","msgs","lastMessageTimestamp","lm","setJoinCodeById","joinCode","joinCodeRequired","setUserById","setTypeById","setTopicById","topic","setAnnouncementById","announcement","unmuteUsernameByRoomId","saveDefaultById","setTopicAndTagsById","tags","setData","unsetData","isEmpty","tag","createWithIdTypeAndName","ModelSettings","findOneNotHiddenById","findByRole","findPublic","public","findNotHiddenPublic","findNotHiddenPublicUpdatedAfter","updatedAt","findNotHiddenPrivate","findNotHidden","findNotHiddenUpdatedAfter","updateValueNotHiddenById","createWithIdAndValue","_createdAt","ModelSubscriptions","findOneByRoomNameAndUserId","findByUserIdUpdatedAfter","findByRoomIdAndRoles","findByTypeAndUserId","findByTypeNameAndUserId","getLastSeen","hideByRoomIdAndUserId","openByRoomIdAndUserId","setAsReadByRoomIdAndUserId","setAsUnreadByRoomIdAndUserId","firstMessageUnreadTimestamp","setFavoriteByRoomIdAndUserId","favorite","updateNameAndAlertByRoomId","updateNameByRoomId","oldName","incGroup","incUser","setBlockedByRoomId","query2","update2","unsetBlockedByRoomId","updateTypeByRoomId","addRoleById","removeRoleById","setArchivedByUsername","findNotHiddenFilesOfRoom","fileQuery","fileOptions","insertFileInit","ModelUsers","emailAddress","findOneAdmin","admin","findOneByIdAndLoginToken","_hashLoginToken","findUsersNotOffline","findActiveByUsernameOrNameRegexWithExceptions","searchTerm","exceptions","isArray","termRegex","$and","findByActiveUsersExcept","orStmt","acc","el","findUsersByNameOrUsername","nameOrUsername","usernameNameOrEmailAddress","findLDAPUsers","ldap","findCrowdUsers","crowd","getLastLogin","findUsersByUsernames","updateLastLoginById","setServiceId","serviceName","serviceId","serviceIdKey","setEmailVerified","$elemMatch","values","unsetAvatarOrigin","setUserActive","setAllUsersActive","unsetLoginTokens","unsetRequirePasswordChange","resetPasswordAndSetRequirePasswordChange","setLanguage","setProfile","profile","setPreferences","setUtcOffset","saveUserById","phoneNumber","create","usersIds","loki","objectPath","lokiEq","LokiOps","$eq","lokiNe","a","b","lokiIn","subA","subB","findWhere","ignore","traceMethodCalls","target","_stats","property","calls","avg","origMethod","loaded","startTime","round","_getStatsAvg","stats","Adapter","loadDatabase","saveDatabase","deleteDatabase","adapter","indexes","joins","collection","addCollection","hasOne","hasMany","processRemoteJoinInserted","remote","processRemoteJoinRemoved","localRecord","processLocalJoinInserted","local","localRecords","_findByIndex","where","mutableRecord","transform","records","splice","addToAllIndexes","indexName","addToIndex","index","removeFromAllIndexes","removeFromIndex","startSync","updateDiffById","r","direction","valueA","valueB","skip","fieldsToRemove","fieldsToGet","pickFields","picked","omit","processQuery","parentField","and","subValue","observeChanges","_publishCursor","cursor","addDynamicView","updatedFields","updateRecord","topLevelFields","del","$min","curValue","$max","$mul","$pullAll","$pop","shift","pop","valueItem","removeWhere","exportDefault","baseName","trash","Mongo","Collection","_ensureIndex","_deletedAt","isOplogAvailable","MongoInternals","defaultRemoteCollectionDriver","mongo","_oplogHandle","onOplogEntry","isOplogEnabled","baseModel","wrapModel","event","processOplogRecord","_defineTooFarBehind","Number","MAX_SAFE_INTEGER","originals","self","defineSyncStrategy","modifier","cacheAllowedModifiers","notAllowedModifiers","placeholderFields","updateHasPositionalOperator","op","o","oplog","listenerCount","strategy","findOptions","insertedId","_returnObject","__collection__","_dropIndex","deletedAt","AccessTokenServices","registerAccessTokenService","handleAccessTokenRequest","registerLoginHandler","accessToken","ObjectIncluding","ServiceConfiguration","configurations","ConfigError","oauth","serviceNames","LoginCancelledError","numericError","oauthResult","updateOrCreateUserFromExternalService","serviceData","getIdentity","access_token","getScopes","idToken","expiresIn","Integer","Maybe","identity","expiresAt","scopes","Google","whitelistedFields","refreshToken","OAuth","_redirectUri","proxy","StatsTracker","StatsD","dogstatsd","track","hrtime","decrement","histogram","gauge","arr","applyFind","$size","testWebAppInternals","isString","setBundledJsCssPrefix","startEmailIntercepter","debounce","buildMailURL","MAIL_URL","encodeURIComponent","oauth_updated","_OAuthServicesUpdate","clientId","secret","custom","serverURL","tokenPath","identityPath","authorizePath","buttonLabelText","buttonLabelColor","loginStyle","buttonColor","tokenSentVia","identityTokenSentVia","usernameField","mergeUsers","CustomOAuth","appId","consumerKey","OAuthServicesUpdate","OAuthServicesRemove","DEPLOYMENT_ID","readonly","actionText","code","multiline","placeholder","unblock","addOAuthService","capitalize","persistent","refreshOAuthService","addUsersToRoom","userInRoom","newUser","blockUser","subscription2","checkRegistrationSecretURL","cleanChannelHistory","latest","oldest","inclusive","Boolean","createChannel","Optional","createToken","_generateStampedLoginToken","_insertLoginToken","authToken","createPrivateGroup","tokenpass","balance","originalMessage","forceDelete","deleteAllowed","deleteOwn","blockDeleteInMinutes","msgTs","currentTsDiff","deleteUserOwnAccount","bcrypt","_checkPassword","digest","algorithm","Filter","badWordsList","clean","getChannelHistory","unreads","fromUserId","isUndefined","isDate","messages","unreadNotLoaded","firstUnread","firstMsg","unreadMessages","getRoomJoinCode","getRoomRoles","Roles","getServerInfo","getSingleMessage","msgId","getUserRoles","roleIds","findUsersInRoles","intersection","insertOrUpdateUser","joinRoom","balances","updateUserTokenpassBalances","Tokenpass","validateAccess","leaveRoom","hasRole","numOwners","getUsersInRole","removeOAuthService","restart_server","abort","exit","m","saveSetting","OneOf","sendInvitationEmail","rfcMailPattern","validEmails","message_ts","server_ts","getTime","sandstorm","connection","sendSMTPTestEmail","setAdminStatus","param","joinDefaultChannelsSilenced","unblockUser","editAllowed","editOwn","blockEditInMinutes"],"mappings":"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","file":"/packages/rocketchat_lib.js","sourcesContent":["import EventEmitter from 'wolfy87-eventemitter';\nRocketChat = new EventEmitter();\n/*\n* Kick off the global namespace for RocketChat.\n* @namespace RocketChat\n*/\nRocketChat.models = {};\n","export const RoomSettingsEnum = {\n\tNAME: 'roomName',\n\tTOPIC: 'roomTopic',\n\tANNOUNCEMENT: 'roomAnnouncement',\n\tDESCRIPTION: 'roomDescription',\n\tREAD_ONLY: 'readOnly',\n\tREACT_WHEN_READ_ONLY: 'reactWhenReadOnly',\n\tARCHIVE_OR_UNARCHIVE: 'archiveOrUnarchive',\n\tJOIN_CODE: 'joinCode'\n};\n\nexport const UiTextContext = {\n\tCLOSE_WARNING: 'closeWarning',\n\tHIDE_WARNING: 'hideWarning',\n\tLEAVE_WARNING: 'leaveWarning',\n\tNO_ROOMS_SUBSCRIBED: 'noRoomsSubscribed'\n};\n\nexport class RoomTypeRouteConfig {\n\tconstructor({ name, path }) {\n\t\tif (typeof name !== 'undefined' && (typeof name !== 'string' || name.length === 0)) {\n\t\t\tthrow new Error('The name must be a string.');\n\t\t}\n\n\t\tif (typeof path !== 'undefined' && (typeof path !== 'string' || path.length === 0)) {\n\t\t\tthrow new Error('The path must be a string.');\n\t\t}\n\n\t\tthis._name = name;\n\t\tthis._path = path;\n\t}\n\n\tget name() {\n\t\treturn this._name;\n\t}\n\n\tget path() {\n\t\treturn this._path;\n\t}\n}\n\nexport class RoomTypeConfig {\n\tconstructor({\n\t\tidentifier = Random.id(),\n\t\torder,\n\t\ticon,\n\t\theader,\n\t\tlabel,\n\t\troute\n\t}) {\n\t\tif (typeof identifier !== 'string' || identifier.length === 0) {\n\t\t\tthrow new Error('The identifier must be a string.');\n\t\t}\n\n\t\tif (typeof order !== 'number') {\n\t\t\tthrow new Error('The order must be a number.');\n\t\t}\n\n\t\tif (typeof icon !== 'undefined' && (typeof icon !== 'string' || icon.length === 0)) {\n\t\t\tthrow new Error('The icon must be a string.');\n\t\t}\n\n\t\tif (typeof header !== 'undefined' && (typeof header !== 'string' || header.length === 0)) {\n\t\t\tthrow new Error('The header must be a string.');\n\t\t}\n\n\t\tif (typeof label !== 'undefined' && (typeof label !== 'string' || label.length === 0)) {\n\t\t\tthrow new Error('The label must be a string.');\n\t\t}\n\n\t\tif (typeof route !== 'undefined' && !(route instanceof RoomTypeRouteConfig)) {\n\t\t\tthrow new Error('Room\\'s route is not a valid route configuration. Must be an instance of \"RoomTypeRouteConfig\".');\n\t\t}\n\n\t\tthis._identifier = identifier;\n\t\tthis._order = order;\n\t\tthis._icon = icon;\n\t\tthis._header = header;\n\t\tthis._label = label;\n\t\tthis._route = route;\n\t}\n\n\t/**\n\t * The room type's internal identifier.\n\t */\n\tget identifier() {\n\t\treturn this._identifier;\n\t}\n\n\t/**\n\t * The order of this room type for the display.\n\t */\n\tget order() {\n\t\treturn this._order;\n\t}\n\n\t/**\n\t * Sets the order of this room type for the display.\n\t *\n\t * @param {number} order the number value for the order\n\t */\n\tset order(order) {\n\t\tif (typeof order !== 'number') {\n\t\t\tthrow new Error('The order must be a number.');\n\t\t}\n\n\t\tthis._order = order;\n\t}\n\n\t/**\n\t * The icon class, css, to use as the visual aid.\n\t */\n\tget icon() {\n\t\treturn this._icon;\n\t}\n\n\t/**\n\t * The header name of this type.\n\t */\n\tget header() {\n\t\treturn this._header;\n\t}\n\n\t/**\n\t * The i18n label for this room type.\n\t */\n\tget label() {\n\t\treturn this._label;\n\t}\n\n\t/**\n\t * The route config for this room type.\n\t */\n\tget route() {\n\t\treturn this._route;\n\t}\n\n\t/**\n\t * Gets the room's name to display in the UI.\n\t *\n\t * @param {object} room\n\t */\n\tgetDisplayName(room) {\n\t\treturn room.name;\n\t}\n\n\tallowRoomSettingChange(/* room, setting */) {\n\t\treturn true;\n\t}\n\n\tcanBeCreated() {\n\t\treturn Meteor.isServer ?\n\t\t\tRocketChat.authz.hasAtLeastOnePermission(Meteor.userId(), [`create-${ this._identifier }`]) :\n\t\t\tRocketChat.authz.hasAtLeastOnePermission([`create-${ this._identifier }`]);\n\t}\n\n\tcanBeDeleted(room) {\n\t\treturn Meteor.isServer ?\n\t\t\tRocketChat.authz.hasAtLeastOnePermission(Meteor.userId(), [`delete-${ room.t }`], room._id) :\n\t\t\tRocketChat.authz.hasAtLeastOnePermission([`delete-${ room.t }`], room._id);\n\t}\n\n\tsupportMembersList(/* room */) {\n\t\treturn true;\n\t}\n\n\tisGroupChat() {\n\t\treturn false;\n\t}\n\n\tcanAddUser(/* userId, room */) {\n\t\treturn false;\n\t}\n\n\tuserDetailShowAll(/* room */) {\n\t\treturn true;\n\t}\n\n\tuserDetailShowAdmin(/* room */) {\n\t\treturn true;\n\t}\n\n\tpreventRenaming(/* room */) {\n\t\treturn false;\n\t}\n\n\tincludeInRoomSearch() {\n\t\treturn false;\n\t}\n\n\tenableMembersListProfile() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns a text which can be used in generic UIs.\n\t * @param context The role of the text in the UI-Element\n\t * @return {string} A text or a translation key - the consumers of this method will pass the\n\t * returned value to an internationalization library\n\t */\n\tgetUiText(/* context */) {\n\t\treturn '';\n\t}\n}\n","import { RoomTypeConfig } from '../RoomTypeConfig';\n\nexport class ChannelsRoomType extends RoomTypeConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tidentifier: 'channels',\n\t\t\torder: 30,\n\t\t\tlabel: 'Channels'\n\t\t});\n\t}\n\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\tconst roomsListExhibitionMode = RocketChat.getUserPreference(user, 'roomsListExhibitionMode');\n\t\tconst mergeChannels = RocketChat.getUserPreference(user, 'mergeChannels');\n\t\treturn ['unread', 'category'].includes(roomsListExhibitionMode) && mergeChannels;\n\t}\n}\n","import { RoomTypeConfig } from '../RoomTypeConfig';\n\nexport class ConversationRoomType extends RoomTypeConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tidentifier: 'activity',\n\t\t\torder: 30,\n\t\t\tlabel: 'Conversations'\n\t\t});\n\t}\n\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\treturn RocketChat.getUserPreference(user, 'roomsListExhibitionMode') === 'activity';\n\t}\n}\n","/* globals openRoom */\nimport {RoomTypeConfig, RoomTypeRouteConfig, RoomSettingsEnum, UiTextContext} from '../RoomTypeConfig';\n\nexport class DirectMessageRoomRoute extends RoomTypeRouteConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tname: 'direct',\n\t\t\tpath: '/direct/:username'\n\t\t});\n\t}\n\n\taction(params) {\n\t\treturn openRoom('d', params.username);\n\t}\n\n\tlink(sub) {\n\t\treturn {username: sub.name};\n\t}\n}\n\nexport class DirectMessageRoomType extends RoomTypeConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tidentifier: 'd',\n\t\t\torder: 50,\n\t\t\tlabel: 'Direct_Messages',\n\t\t\troute: new DirectMessageRoomRoute()\n\t\t});\n\t}\n\n\tfindRoom(identifier) {\n\t\tconst query = {\n\t\t\tt: 'd',\n\t\t\tname: identifier\n\t\t};\n\n\t\tconst subscription = ChatSubscription.findOne(query);\n\t\tif (subscription && subscription.rid) {\n\t\t\treturn ChatRoom.findOne(subscription.rid);\n\t\t}\n\t}\n\n\troomName(roomData) {\n\t\tconst subscription = ChatSubscription.findOne({rid: roomData._id}, {fields: {name: 1, fname: 1}});\n\t\tif (!subscription) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name') && subscription.fname) {\n\t\t\treturn subscription.fname;\n\t\t}\n\n\t\treturn subscription.name;\n\t}\n\n\tsecondaryRoomName(roomData) {\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\tconst subscription = ChatSubscription.findOne({rid: roomData._id}, {fields: {name: 1}});\n\t\t\treturn subscription && subscription.name;\n\t\t}\n\t}\n\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\tconst roomsListExhibitionMode = RocketChat.getUserPreference(user, 'roomsListExhibitionMode');\n\t\treturn !roomsListExhibitionMode || ['unread', 'category'].includes(roomsListExhibitionMode) && RocketChat.authz.hasAtLeastOnePermission(['view-d-room', 'view-joined-room']);\n\t}\n\n\tgetUserStatus(roomId) {\n\t\tconst subscription = RocketChat.models.Subscriptions.findOne({rid: roomId});\n\t\tif (subscription == null) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn Session.get(`user_${ subscription.name }_status`);\n\t}\n\n\tgetDisplayName(room) {\n\t\treturn room.usernames.join(' x ');\n\t}\n\n\tallowRoomSettingChange(room, setting) {\n\t\tswitch (setting) {\n\t\t\tcase RoomSettingsEnum.NAME:\n\t\t\tcase RoomSettingsEnum.DESCRIPTION:\n\t\t\tcase RoomSettingsEnum.READ_ONLY:\n\t\t\tcase RoomSettingsEnum.REACT_WHEN_READ_ONLY:\n\t\t\tcase RoomSettingsEnum.ARCHIVE_OR_UNARCHIVE:\n\t\t\tcase RoomSettingsEnum.JOIN_CODE:\n\t\t\t\treturn false;\n\t\t\tdefault:\n\t\t\t\treturn true;\n\t\t}\n\t}\n\n\tenableMembersListProfile() {\n\t\treturn true;\n\t}\n\n\tgetUiText(context) {\n\t\tswitch (context) {\n\t\t\tcase UiTextContext.HIDE_WARNING:\n\t\t\t\treturn 'Hide_Private_Warning';\n\t\t\tcase UiTextContext.LEAVE_WARNING:\n\t\t\t\treturn 'Leave_Private_Warning';\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n}\n","import { RoomTypeConfig } from '../RoomTypeConfig';\n\nexport class FavoriteRoomType extends RoomTypeConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tidentifier: 'f',\n\t\t\torder: 20,\n\t\t\theader: 'favorite',\n\t\t\ticon: 'star',\n\t\t\tlabel: 'Favorites'\n\t\t});\n\t}\n}\n","import { ChannelsRoomType } from './channels';\nimport { ConversationRoomType } from './conversation';\nimport { DirectMessageRoomType } from './direct';\nimport { FavoriteRoomType } from './favorite';\nimport { PrivateRoomType } from './private';\nimport { PublicRoomType } from './public';\nimport { UnreadRoomType } from './unread';\n\nexport {\n\tChannelsRoomType,\n\tConversationRoomType,\n\tDirectMessageRoomType,\n\tFavoriteRoomType,\n\tPrivateRoomType,\n\tPublicRoomType,\n\tUnreadRoomType\n};\n","/* globals openRoom */\nimport {RoomSettingsEnum, RoomTypeConfig, RoomTypeRouteConfig, UiTextContext} from '../RoomTypeConfig';\n\nexport class PrivateRoomRoute extends RoomTypeRouteConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tname: 'group',\n\t\t\tpath: '/group/:name'\n\t\t});\n\t}\n\n\taction(params) {\n\t\treturn openRoom('p', params.name);\n\t}\n}\n\nexport class PrivateRoomType extends RoomTypeConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tidentifier: 'p',\n\t\t\torder: 40,\n\t\t\ticon: 'lock',\n\t\t\tlabel: 'Private_Groups',\n\t\t\troute: new PrivateRoomRoute()\n\t\t});\n\t}\n\n\tfindRoom(identifier) {\n\t\tconst query = {\n\t\t\tt: 'p',\n\t\t\tname: identifier\n\t\t};\n\n\t\treturn ChatRoom.findOne(query);\n\t}\n\n\troomName(roomData) {\n\t\tif (RocketChat.settings.get('UI_Allow_room_names_with_special_chars')) {\n\t\t\treturn roomData.fname || roomData.name;\n\t\t}\n\n\t\treturn roomData.name;\n\t}\n\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\tconst roomsListExhibitionMode = RocketChat.getUserPreference(user, 'roomsListExhibitionMode');\n\t\tconst mergeChannels = RocketChat.getUserPreference(user, 'mergeChannels');\n\t\treturn !roomsListExhibitionMode || ['unread', 'category'].includes(roomsListExhibitionMode) && !mergeChannels && RocketChat.authz.hasAllPermission('view-p-room');\n\t}\n\n\tisGroupChat() {\n\t\treturn true;\n\t}\n\n\tcanAddUser(room) {\n\t\treturn RocketChat.authz.hasAtLeastOnePermission(['add-user-to-any-p-room', 'add-user-to-joined-room'], room._id);\n\t}\n\n\tallowRoomSettingChange(room, setting) {\n\t\tswitch (setting) {\n\t\t\tcase RoomSettingsEnum.JOIN_CODE:\n\t\t\t\treturn false;\n\t\t\tdefault:\n\t\t\t\treturn true;\n\t\t}\n\t}\n\n\tenableMembersListProfile() {\n\t\treturn true;\n\t}\n\n\tgetUiText(context) {\n\t\tswitch (context) {\n\t\t\tcase UiTextContext.HIDE_WARNING:\n\t\t\t\treturn 'Hide_Group_Warning';\n\t\t\tcase UiTextContext.LEAVE_WARNING:\n\t\t\t\treturn 'Leave_Group_Warning';\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n}\n","/* globals openRoom */\nimport {RoomTypeConfig, RoomTypeRouteConfig, UiTextContext} from '../RoomTypeConfig';\n\nexport class PublicRoomRoute extends RoomTypeRouteConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tname: 'channel',\n\t\t\tpath: '/channel/:name'\n\t\t});\n\t}\n\n\taction(params) {\n\t\treturn openRoom('c', params.name);\n\t}\n}\n\nexport class PublicRoomType extends RoomTypeConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tidentifier: 'c',\n\t\t\torder: 30,\n\t\t\ticon: 'hashtag',\n\t\t\tlabel: 'Channels',\n\t\t\troute: new PublicRoomRoute()\n\t\t});\n\t}\n\n\tfindRoom(identifier) {\n\t\tconst query = {\n\t\t\tt: 'c',\n\t\t\tname: identifier\n\t\t};\n\t\treturn ChatRoom.findOne(query);\n\t}\n\n\troomName(roomData) {\n\t\tif (RocketChat.settings.get('UI_Allow_room_names_with_special_chars')) {\n\t\t\treturn roomData.fname || roomData.name;\n\t\t}\n\t\treturn roomData.name;\n\t}\n\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\tconst roomsListExhibitionMode = RocketChat.getUserPreference(user, 'roomsListExhibitionMode');\n\t\tconst mergeChannels = RocketChat.getUserPreference(user, 'mergeChannels');\n\t\treturn !roomsListExhibitionMode || ['unread', 'category'].includes(roomsListExhibitionMode) && !mergeChannels && (RocketChat.authz.hasAtLeastOnePermission(['view-c-room', 'view-joined-room']) || RocketChat.settings.get('Accounts_AllowAnonymousRead') === true);\n\t}\n\n\tshowJoinLink(roomId) {\n\t\treturn !!ChatRoom.findOne({_id: roomId, t: 'c'});\n\t}\n\n\tincludeInRoomSearch() {\n\t\treturn true;\n\t}\n\n\tisGroupChat() {\n\t\treturn true;\n\t}\n\n\tcanAddUser(room) {\n\t\treturn RocketChat.authz.hasAtLeastOnePermission(['add-user-to-any-c-room', 'add-user-to-joined-room'], room._id);\n\t}\n\n\tallowRoomSettingChange() {\n\t\treturn true;\n\t}\n\n\tenableMembersListProfile() {\n\t\treturn true;\n\t}\n\n\tgetUiText(context) {\n\t\tswitch (context) {\n\t\t\tcase UiTextContext.HIDE_WARNING:\n\t\t\t\treturn 'Hide_Room_Warning';\n\t\t\tcase UiTextContext.LEAVE_WARNING:\n\t\t\t\treturn 'Leave_Room_Warning';\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n}\n","import { RoomTypeConfig } from '../RoomTypeConfig';\n\nexport class UnreadRoomType extends RoomTypeConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tidentifier: 'unread',\n\t\t\torder: 10,\n\t\t\tlabel: 'Unread'\n\t\t});\n\n\t\tthis.unread = true;\n\t}\n\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\treturn RocketChat.getUserPreference(user, 'roomsListExhibitionMode') === 'unread';\n\t}\n}\n","import s from 'underscore.string';\n\nRocketChat.getURL = (path, { cdn = true, full = false } = {}) => {\n\tconst cdnPrefix = s.rtrim(s.trim(RocketChat.settings.get('CDN_PREFIX') || ''), '/');\n\tconst pathPrefix = s.rtrim(s.trim(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX || ''), '/');\n\n\tlet basePath;\n\n\tconst finalPath = s.ltrim(s.trim(path), '/');\n\n\tif (cdn && cdnPrefix !== '') {\n\t\tbasePath = cdnPrefix + pathPrefix;\n\t} else if (full || Meteor.isCordova) {\n\t\treturn Meteor.absoluteUrl(finalPath);\n\t} else {\n\t\tbasePath = pathPrefix;\n\t}\n\n\treturn `${ basePath }/${ finalPath }`;\n};\n","import _ from 'underscore';\n\n/*\n* RocketChat.settings holds all packages settings\n* @namespace RocketChat.settings\n*/\nRocketChat.settings = {\n\tcallbacks: {},\n\tregexCallbacks: {},\n\tts: new Date,\n\tget(_id, callback) {\n\t\tif (callback != null) {\n\t\t\tRocketChat.settings.onload(_id, callback);\n\t\t\tif (!Meteor.settings) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_id === '*') {\n\t\t\t\treturn Object.keys(Meteor.settings).forEach(key => {\n\t\t\t\t\tconst value = Meteor.settings[key];\n\t\t\t\t\tcallback(key, value);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (_.isRegExp(_id) && Meteor.settings) {\n\t\t\t\treturn Object.keys(Meteor.settings).forEach(key => {\n\t\t\t\t\tif (!_id.test(key)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst value = Meteor.settings[key];\n\t\t\t\t\tcallback(key, value);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Meteor.settings[_id] != null && callback(_id, Meteor.settings[_id]);\n\t\t} else {\n\t\t\tif (!Meteor.settings) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_.isRegExp(_id)) {\n\t\t\t\treturn Object.keys(Meteor.settings).reduce((items, key) => {\n\t\t\t\t\tconst value = Meteor.settings[key];\n\t\t\t\t\tif (_id.test(key)) {\n\t\t\t\t\t\titems.push({\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\tvalue\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn items;\n\t\t\t\t}, []);\n\t\t\t}\n\t\t\treturn Meteor.settings && Meteor.settings[_id];\n\t\t}\n\t},\n\tset(_id, value, callback) {\n\t\treturn Meteor.call('saveSetting', _id, value, callback);\n\t},\n\tbatchSet(settings, callback) {\n\t\t// async -> sync\n\t\t// http://daemon.co.za/2012/04/simple-async-with-only-underscore/\n\t\tconst save = function(setting) {\n\t\t\treturn function(callback) {\n\t\t\t\treturn Meteor.call('saveSetting', setting._id, setting.value, setting.editor, callback);\n\t\t\t};\n\t\t};\n\t\tconst actions = _.map(settings, (setting) => save(setting));\n\t\treturn _(actions).reduceRight(_.wrap, (err, success) => callback(err, success))();\n\t},\n\tload(key, value, initialLoad) {\n\t\t['*', key].forEach(item => {\n\t\t\tif (RocketChat.settings.callbacks[item]) {\n\t\t\t\tRocketChat.settings.callbacks[item].forEach(callback => callback(key, value, initialLoad));\n\t\t\t}\n\t\t});\n\t\tObject.keys(RocketChat.settings.regexCallbacks).forEach(cbKey => {\n\t\t\tconst cbValue = RocketChat.settings.regexCallbacks[cbKey];\n\t\t\tif (!cbValue.regex.test(key)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcbValue.callbacks.forEach(callback => callback(key, value, initialLoad));\n\t\t});\n\t},\n\tonload(key, callback) {\n\t\t// if key is '*'\n\t\t// \tfor key, value in Meteor.settings\n\t\t// \t\tcallback key, value, false\n\t\t// else if Meteor.settings?[_id]?\n\t\t// \tcallback key, Meteor.settings[_id], false\n\t\tconst keys = [].concat(key);\n\t\tkeys.forEach(k => {\n\t\t\tif (_.isRegExp(k)) {\n\t\t\t\tRocketChat.settings.regexCallbacks[name = k.source] = RocketChat.settings.regexCallbacks[name = k.source] || {\n\t\t\t\t\tregex: k,\n\t\t\t\t\tcallbacks: []\n\t\t\t\t};\n\t\t\t\tRocketChat.settings.regexCallbacks[k.source].callbacks.push(callback);\n\t\t\t} else {\n\t\t\t\tRocketChat.settings.callbacks[k] = RocketChat.settings.callbacks[k] || [];\n\t\t\t\tRocketChat.settings.callbacks[k].push(callback);\n\t\t\t}\n\t\t});\n\t}\n};\n","import _ from 'underscore';\n\n/*\n* Callback hooks provide an easy way to add extra steps to common operations.\n* @namespace RocketChat.callbacks\n*/\n\nRocketChat.callbacks = {};\n\nif (Meteor.isServer) {\n\tRocketChat.callbacks.showTime = true;\n\tRocketChat.callbacks.showTotalTime = true;\n} else {\n\tRocketChat.callbacks.showTime = false;\n\tRocketChat.callbacks.showTotalTime = false;\n}\n\n\n/*\n* Callback priorities\n*/\n\nRocketChat.callbacks.priority = {\n\tHIGH: -1000,\n\tMEDIUM: 0,\n\tLOW: 1000\n};\n\n\n/*\n* Add a callback function to a hook\n* @param {String} hook - The name of the hook\n* @param {Function} callback - The callback function\n*/\n\nRocketChat.callbacks.add = function(hook, callback, priority, id) {\n\tif (priority == null) {\n\t\tpriority = RocketChat.callbacks.priority.MEDIUM;\n\t}\n\tif (!_.isNumber(priority)) {\n\t\tpriority = RocketChat.callbacks.priority.MEDIUM;\n\t}\n\tcallback.priority = priority;\n\tcallback.id = id || Random.id();\n\tRocketChat.callbacks[hook] = RocketChat.callbacks[hook] || [];\n\tif (RocketChat.callbacks.showTime === true) {\n\t\tconst err = new Error;\n\t\tcallback.stack = err.stack;\n\t}\n\tif (RocketChat.callbacks[hook].find((cb) => cb.id === callback.id)) {\n\t\treturn;\n\t}\n\tRocketChat.callbacks[hook].push(callback);\n};\n\n\n/*\n* Remove a callback from a hook\n* @param {string} hook - The name of the hook\n* @param {string} id - The callback's id\n*/\n\nRocketChat.callbacks.remove = function(hookName, id) {\n\tRocketChat.callbacks[hookName] = _.reject(RocketChat.callbacks[hookName], (callback) => callback.id === id);\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n* @returns {Object} Returns the item after it's been through all the callbacks for this hook\n*/\n\nRocketChat.callbacks.run = function(hook, item, constant) {\n\tconst callbacks = RocketChat.callbacks[hook];\n\tif (callbacks && callbacks.length) {\n\t\tlet totalTime = 0;\n\t\tconst result = _.sortBy(callbacks, function(callback) {\n\t\t\treturn callback.priority || RocketChat.callbacks.priority.MEDIUM;\n\t\t}).reduce(function(result, callback) {\n\t\t\tlet time = 0;\n\t\t\tif (RocketChat.callbacks.showTime === true || RocketChat.callbacks.showTotalTime === true) {\n\t\t\t\ttime = Date.now();\n\t\t\t}\n\t\t\tconst callbackResult = callback(result, constant);\n\t\t\tif (RocketChat.callbacks.showTime === true || RocketChat.callbacks.showTotalTime === true) {\n\t\t\t\tconst currentTime = Date.now() - time;\n\t\t\t\ttotalTime += currentTime;\n\t\t\t\tif (RocketChat.callbacks.showTime === true) {\n\t\t\t\t\tif (Meteor.isServer) {\n\t\t\t\t\t\tRocketChat.statsTracker.timing('callbacks.time', currentTime, [`hook:${ hook }`, `callback:${ callback.id }`]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet stack = callback.stack && typeof callback.stack.split === 'function' && callback.stack.split('\\n');\n\t\t\t\t\t\tstack = stack && stack[2] && (stack[2].match(/\\(.+\\)/)||[])[0];\n\t\t\t\t\t\tconsole.log(String(currentTime), hook, callback.id, stack);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn (typeof callbackResult === 'undefined') ? result : callbackResult;\n\t\t}, item);\n\t\tif (RocketChat.callbacks.showTotalTime === true) {\n\t\t\tif (Meteor.isServer) {\n\t\t\t\tRocketChat.statsTracker.timing('callbacks.totalTime', totalTime, [`hook:${ hook }`]);\n\t\t\t} else {\n\t\t\t\tconsole.log(`${ hook }:`, totalTime);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t} else {\n\t\treturn item;\n\t}\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item, in async mode (only works on server)\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n*/\n\nRocketChat.callbacks.runAsync = function(hook, item, constant) {\n\tconst callbacks = RocketChat.callbacks[hook];\n\tif (Meteor.isServer && callbacks && callbacks.length) {\n\t\tMeteor.defer(function() {\n\t\t\t_.sortBy(callbacks, (callback) => callback.priority || RocketChat.callbacks.priority.MEDIUM).forEach((callback) => callback(item, constant));\n\t\t});\n\t} else {\n\t\treturn item;\n\t}\n};\n","import _ from 'underscore';\n\nRocketChat.fileUploadMediaWhiteList = function() {\n\tconst mediaTypeWhiteList = RocketChat.settings.get('FileUpload_MediaTypeWhiteList');\n\n\tif (!mediaTypeWhiteList || mediaTypeWhiteList === '*') {\n\t\treturn;\n\t}\n\treturn _.map(mediaTypeWhiteList.split(','), function(item) {\n\t\treturn item.trim();\n\t});\n};\n\nRocketChat.fileUploadIsValidContentType = function(type) {\n\tconst list = RocketChat.fileUploadMediaWhiteList();\n\tif (!list) {\n\t\treturn true;\n\t}\n\n\tif (!type) {\n\t\treturn false;\n\t}\n\n\tif (_.contains(list, type)) {\n\t\treturn true;\n\t} else {\n\t\tconst wildCardGlob = '/*';\n\t\tconst wildcards = _.filter(list, function(item) {\n\t\t\treturn item.indexOf(wildCardGlob) > 0;\n\t\t});\n\t\tif (_.contains(wildcards, type.replace(/(\\/.*)$/, wildCardGlob))) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n};\n","const colors = ['#F44336', '#E91E63', '#9C27B0', '#673AB7', '#3F51B5', '#2196F3', '#03A9F4', '#00BCD4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFC107', '#FF9800', '#FF5722', '#795548', '#9E9E9E', '#607D8B'];\n\nRocketChat.getAvatarColor = function(name) {\n\treturn colors[name.length % colors.length];\n};\n","import s from 'underscore.string';\n\nRocketChat.getValidRoomName = function getValidRoomName(displayName, rid = '') {\n\tlet slugifiedName = displayName;\n\n\tif (RocketChat.settings.get('UI_Allow_room_names_with_special_chars')) {\n\t\tconst room = RocketChat.models.Rooms.findOneByDisplayName(displayName);\n\t\tif (room && room._id !== rid) {\n\t\t\tif (room.archived) {\n\t\t\t\tthrow new Meteor.Error('error-archived-duplicate-name', `There's an archived channel with name ${ displayName }`, { function: 'RocketChat.getValidRoomName', channel_name: displayName });\n\t\t\t} else {\n\t\t\t\tthrow new Meteor.Error('error-duplicate-channel-name', `A channel with name '${ displayName }' exists`, { function: 'RocketChat.getValidRoomName', channel_name: displayName });\n\t\t\t}\n\t\t}\n\t\tslugifiedName = s.slugify(displayName);\n\t}\n\n\tlet nameValidation;\n\ttry {\n\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t} catch (error) {\n\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t}\n\tif (!nameValidation.test(slugifiedName)) {\n\t\tthrow new Meteor.Error('error-invalid-room-name', `${ slugifiedName } is not a valid room name.`, {\n\t\t\t'function': 'RocketChat.getValidRoomName',\n\t\t\tchannel_name: slugifiedName\n\t\t});\n\t}\n\n\tconst room = RocketChat.models.Rooms.findOneByName(slugifiedName);\n\tif (room && room._id !== rid) {\n\t\tif (RocketChat.settings.get('UI_Allow_room_names_with_special_chars')) {\n\t\t\tlet tmpName = slugifiedName;\n\t\t\tlet next = 0;\n\t\t\twhile (RocketChat.models.Rooms.findOneByNameAndNotId(tmpName, rid)) {\n\t\t\t\ttmpName = `${ slugifiedName }-${ ++next }`;\n\t\t\t}\n\t\t\tslugifiedName = tmpName;\n\t\t} else if (room.archived) {\n\t\t\tthrow new Meteor.Error('error-archived-duplicate-name', `There's an archived channel with name ${ slugifiedName }`, { function: 'RocketChat.getValidRoomName', channel_name: slugifiedName });\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-duplicate-channel-name', `A channel with name '${ slugifiedName }' exists`, { function: 'RocketChat.getValidRoomName', channel_name: slugifiedName });\n\t\t}\n\t}\n\n\treturn slugifiedName;\n};\n","import s from 'underscore.string';\n\nRocketChat.placeholders = {};\n\nRocketChat.placeholders.replace = function(str, data) {\n\tif (!str) {\n\t\treturn '';\n\t}\n\n\tstr = str.replace(/\\[Site_Name\\]/g, RocketChat.settings.get('Site_Name') || '');\n\tstr = str.replace(/\\[Site_URL\\]/g, RocketChat.settings.get('Site_Url') || '');\n\n\tif (data) {\n\t\tstr = str.replace(/\\[name\\]/g, data.name || '');\n\t\tstr = str.replace(/\\[fname\\]/g, s.strLeft(data.name, ' ') || '');\n\t\tstr = str.replace(/\\[lname\\]/g, s.strRightBack(data.name, ' ') || '');\n\t\tstr = str.replace(/\\[email\\]/g, data.email || '');\n\t\tstr = str.replace(/\\[password\\]/g, data.password || '');\n\t\tstr = str.replace(/\\[User\\]/g, data.user || '');\n\t\tstr = str.replace(/\\[Room\\]/g, data.room || '');\n\n\t\tif (data.unsubscribe) {\n\t\t\tstr = str.replace(/\\[unsubscribe\\]/g, data.unsubscribe);\n\t\t}\n\t}\n\n\tstr = str.replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1' + '<br>' + '$2');\n\n\n\treturn str;\n};\n","import _ from 'underscore';\n\n/*\n* Callback hooks provide an easy way to add extra steps to common operations.\n* @namespace RocketChat.promises\n*/\n\nRocketChat.promises = {};\n\n\n/*\n* Callback priorities\n*/\n\nRocketChat.promises.priority = {\n\tHIGH: -1000,\n\tMEDIUM: 0,\n\tLOW: 1000\n};\n\n\n/*\n* Add a callback function to a hook\n* @param {String} hook - The name of the hook\n* @param {Function} callback - The callback function\n*/\n\nRocketChat.promises.add = function(hook, callback, p = RocketChat.promises.priority.MEDIUM, id) {\n\tconst priority = !_.isNumber(p) ? RocketChat.promises.priority.MEDIUM : p;\n\tcallback.priority = priority;\n\tcallback.id = id || Random.id();\n\tRocketChat.promises[hook] = RocketChat.promises[hook] || [];\n\tif (RocketChat.promises[hook].find(cb => cb.id === callback.id)) {\n\t\treturn;\n\t}\n\tRocketChat.promises[hook].push(callback);\n};\n\n\n/*\n* Remove a callback from a hook\n* @param {string} hook - The name of the hook\n* @param {string} id - The callback's id\n*/\n\nRocketChat.promises.remove = function(hookName, id) {\n\tRocketChat.promises[hookName] = _.reject(RocketChat.promises[hookName], (callback) => callback.id === id);\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n* @returns {Object} Returns the item after it's been through all the callbacks for this hook\n*/\n\nRocketChat.promises.run = function(hook, item, constant) {\n\tlet callbacks = RocketChat.promises[hook];\n\tif (callbacks == null || callbacks.length === 0) {\n\t\treturn Promise.resolve(item);\n\t}\n\tcallbacks = _.sortBy(callbacks, (callback) => callback.priority || RocketChat.promises.priority.MEDIUM);\n\treturn callbacks.reduce(function(previousPromise, callback) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\treturn previousPromise.then((result) => callback(result, constant).then(resolve, reject));\n\t\t});\n\t}, Promise.resolve(item));\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item, in async mode (only works on server)\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n*/\n\nRocketChat.promises.runAsync = function(hook, item, constant) {\n\tconst callbacks = RocketChat.promises[hook];\n\tif (!Meteor.isServer || callbacks == null || callbacks.length === 0) {\n\t\treturn item;\n\t}\n\tMeteor.defer(() => {\n\t\t_.sortBy(callbacks, (callback) => callback.priority || RocketChat.promises.priority.MEDIUM).forEach(function(callback) {\n\t\t\tcallback(item, constant);\n\t\t});\n\t});\n};\n","/* globals roomExit */\nimport { RoomTypeConfig } from './RoomTypeConfig';\n\nexport class RoomTypesCommon {\n\tconstructor() {\n\t\tthis.roomTypes = {};\n\t\tthis.roomTypesOrder = [];\n\t\tthis.mainOrder = 1;\n\t}\n\n\t/**\n\t * Adds a room type to the application.\n\t *\n\t * @param {RoomTypeConfig} roomConfig\n\t * @returns {void}\n\t */\n\tadd(roomConfig) {\n\t\tif (!(roomConfig instanceof RoomTypeConfig)) {\n\t\t\tthrow new Error('Invalid Room Configuration object, it must extend \"RoomTypeConfig\"');\n\t\t}\n\n\t\tif (this.roomTypes[roomConfig.identifier]) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!roomConfig.order) {\n\t\t\troomConfig.order = this.mainOrder + 10;\n\t\t\tthis.mainOrder += 10;\n\t\t}\n\n\t\tthis.roomTypesOrder.push({\n\t\t\tidentifier: roomConfig.identifier,\n\t\t\torder: roomConfig.order\n\t\t});\n\n\t\tthis.roomTypes[roomConfig.identifier] = roomConfig;\n\n\t\tif (roomConfig.route && roomConfig.route.path && roomConfig.route.name && roomConfig.route.action) {\n\t\t\tconst routeConfig = {\n\t\t\t\tname: roomConfig.route.name,\n\t\t\t\taction: roomConfig.route.action\n\t\t\t};\n\n\t\t\tif (Meteor.isClient) {\n\t\t\t\trouteConfig.triggersExit = [roomExit];\n\t\t\t}\n\n\t\t\treturn FlowRouter.route(roomConfig.route.path, routeConfig);\n\t\t}\n\t}\n\n\thasCustomLink(roomType) {\n\t\treturn this.roomTypes[roomType] && this.roomTypes[roomType].route && this.roomTypes[roomType].route.link != null;\n\t}\n\n\t/**\n\t * @param {string} roomType room type (e.g.: c (for channels), d (for direct channels))\n\t * @param {object} subData the user's subscription data\n\t */\n\tgetRouteLink(roomType, subData) {\n\t\tif (!this.roomTypes[roomType]) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet routeData = {};\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].route && this.roomTypes[roomType].route.link) {\n\t\t\trouteData = this.roomTypes[roomType].route.link(subData);\n\t\t} else if (subData && subData.name) {\n\t\t\trouteData = {\n\t\t\t\tname: subData.name\n\t\t\t};\n\t\t}\n\n\t\treturn FlowRouter.path(this.roomTypes[roomType].route.name, routeData);\n\t}\n\n\topenRouteLink(roomType, subData, queryParams) {\n\t\tif (!this.roomTypes[roomType]) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet routeData = {};\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].route && this.roomTypes[roomType].route.link) {\n\t\t\trouteData = this.roomTypes[roomType].route.link(subData);\n\t\t} else if (subData && subData.name) {\n\t\t\trouteData = {\n\t\t\t\tname: subData.name\n\t\t\t};\n\t\t}\n\n\t\treturn FlowRouter.go(this.roomTypes[roomType].route.name, routeData, queryParams);\n\t}\n}\n","RocketChat.slashCommands = {\n\tcommands: {}\n};\n\nRocketChat.slashCommands.add = function(command, callback, options = {}, result) {\n\tRocketChat.slashCommands.commands[command] = {\n\t\tcommand,\n\t\tcallback,\n\t\tparams: options.params,\n\t\tdescription: options.description,\n\t\tclientOnly: options.clientOnly || false,\n\t\tresult\n\t};\n};\n\nRocketChat.slashCommands.run = function(command, params, item) {\n\tif (RocketChat.slashCommands.commands[command] && RocketChat.slashCommands.commands[command].callback) {\n\t\treturn RocketChat.slashCommands.commands[command].callback(command, params, item);\n\t}\n};\n\nMeteor.methods({\n\tslashCommand(command) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'slashCommand'\n\t\t\t});\n\t\t}\n\t\treturn RocketChat.slashCommands.run(command.cmd, command.params, command.msg);\n\t}\n});\n","import s from 'underscore.string';\n\nRocketChat.Message = {\n\tparse(msg, language) {\n\t\tconst messageType = RocketChat.MessageTypes.getType(msg);\n\t\tif (messageType) {\n\t\t\tif (messageType.render) {\n\t\t\t\treturn messageType.render(msg);\n\t\t\t} else if (messageType.template) {\n\t\t\t\t// Render message\n\t\t\t\treturn;\n\t\t\t} else if (messageType.message) {\n\t\t\t\tif (!language && typeof localStorage !== 'undefined') {\n\t\t\t\t\tlanguage = localStorage.getItem('userLanguage');\n\t\t\t\t}\n\t\t\t\tconst data = (typeof messageType.data === 'function' && messageType.data(msg)) || {};\n\t\t\t\treturn TAPi18n.__(messageType.message, data, language);\n\t\t\t}\n\t\t}\n\t\tif (msg.u && msg.u.username === RocketChat.settings.get('Chatops_Username')) {\n\t\t\tmsg.html = msg.msg;\n\t\t\treturn msg.html;\n\t\t}\n\t\tmsg.html = msg.msg;\n\t\tif (s.trim(msg.html) !== '') {\n\t\t\tmsg.html = s.escapeHTML(msg.html);\n\t\t}\n\t\tmsg.html = msg.html.replace(/\\n/gm, '<br/>');\n\t\treturn msg.html;\n\t}\n};\n","RocketChat.messageBox = {};\n\nRocketChat.messageBox.actions = new class {\n\tconstructor() {\n\t\tthis.actions = {};\n\t}\n\n\t/* Add a action to messagebox\n\t@param group\n\t@param label\n\t@param config\n\ticon: icon class\n\taction: action function\n\tcondition: condition to display the action\n\t*/\n\n\tadd(group, label, config) {\n\t\tif (!group && !label && !config) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.actions[group]) {\n\t\t\tthis.actions[group] = [];\n\t\t}\n\n\t\tconst actionExists = this.actions[group].find((action) => {\n\t\t\treturn action.label === label;\n\t\t});\n\n\t\tif (actionExists) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.actions[group].push({...config, label});\n\t}\n\n\tget(group) {\n\t\tif (!group) {\n\t\t\treturn Object.keys(this.actions).reduce((ret, key) => {\n\t\t\t\tconst actions = this.actions[key].filter(action => !action.condition || action.condition());\n\t\t\t\tif (actions.length) {\n\t\t\t\t\tret[key] = actions;\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t\t}, {});\n\t\t}\n\n\t\treturn this.actions[group].filter(action => !action.condition || action.condition());\n\t}\n\n\tgetById(id) {\n\t\tconst messageActions = this.actions;\n\t\tlet actions = [];\n\t\tObject.keys(messageActions).forEach(function(action) {\n\t\t\tactions = actions.concat(messageActions[action]);\n\t\t});\n\n\t\treturn actions.filter(action => action.id === id);\n\t}\n};\n","RocketChat.MessageTypes = new class {\n\tconstructor() {\n\t\tthis.types = {};\n\t}\n\n\tregisterType(options) {\n\t\treturn this.types[options.id] = options;\n\t}\n\n\tgetType(message) {\n\t\treturn this.types[message && message.t];\n\t}\n\n\tisSystemMessage(message) {\n\t\tconst type = this.types[message && message.t];\n\t\treturn type && type.system;\n\t}\n\n};\n\nMeteor.startup(function() {\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'r',\n\t\tsystem: true,\n\t\tmessage: 'Room_name_changed',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\troom_name: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'au',\n\t\tsystem: true,\n\t\tmessage: 'User_added_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_added: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'ru',\n\t\tsystem: true,\n\t\tmessage: 'User_removed_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_removed: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'ul',\n\t\tsystem: true,\n\t\tmessage: 'User_left',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_left: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'uj',\n\t\tsystem: true,\n\t\tmessage: 'User_joined_channel',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'wm',\n\t\tsystem: true,\n\t\tmessage: 'Welcome',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'rm',\n\t\tsystem: true,\n\t\tmessage: 'Message_removed',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'rtc',\n\t\trender(message) {\n\t\t\treturn RocketChat.callbacks.run('renderRtcMessage', message);\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'user-muted',\n\t\tsystem: true,\n\t\tmessage: 'User_muted_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_muted: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'user-unmuted',\n\t\tsystem: true,\n\t\tmessage: 'User_unmuted_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_unmuted: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'subscription-role-added',\n\t\tsystem: true,\n\t\tmessage: '__username__was_set__role__by__user_by_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.msg,\n\t\t\t\trole: message.role,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'subscription-role-removed',\n\t\tsystem: true,\n\t\tmessage: '__username__is_no_longer__role__defined_by__user_by_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.msg,\n\t\t\t\trole: message.role,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'room-archived',\n\t\tsystem: true,\n\t\tmessage: 'This_room_has_been_archived_by__username_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'room-unarchived',\n\t\tsystem: true,\n\t\tmessage: 'This_room_has_been_unarchived_by__username_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.u.username\n\t\t\t};\n\t\t}\n\t});\n});\n","let logger;\n\nif (Meteor.isServer) {\n\tlogger = new Logger('TemplateVarHandler', {});\n}\n\nRocketChat.templateVarHandler = function(variable, object) {\n\n\tconst templateRegex = /#{([\\w\\-]+)}/gi;\n\tlet match = templateRegex.exec(variable);\n\tlet tmpVariable = variable;\n\n\tif (match == null) {\n\t\tif (!object.hasOwnProperty(variable)) {\n\t\t\tlogger && logger.debug(`user does not have attribute: ${ variable }`);\n\t\t\treturn;\n\t\t}\n\t\treturn object[variable];\n\t} else {\n\t\tlogger && logger.debug('template found. replacing values');\n\t\twhile (match != null) {\n\t\t\tconst tmplVar = match[0];\n\t\t\tconst tmplAttrName = match[1];\n\n\t\t\tif (!object.hasOwnProperty(tmplAttrName)) {\n\t\t\t\tlogger && logger.debug(`user does not have attribute: ${ tmplAttrName }`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst attrVal = object[tmplAttrName];\n\t\t\tlogger && logger.debug(`replacing template var: ${ tmplVar } with value: ${ attrVal }`);\n\t\t\ttmpVariable = tmpVariable.replace(tmplVar, attrVal);\n\t\t\tmatch = templateRegex.exec(variable);\n\t\t}\n\t\treturn tmpVariable;\n\t}\n};\n","/**\n * Tries to retrieve the user preference falling back to a default system\n * value or to a default value if it is passed as argument\n*/\nRocketChat.getUserPreference = function(user, key, defaultValue=undefined) {\n\tlet preference;\n\n\tif (user && user.settings && user.settings.preferences &&\n\t\tuser.settings.preferences.hasOwnProperty(key)) {\n\t\tpreference = user.settings.preferences[key];\n\t} else if (defaultValue === undefined) {\n\t\tpreference = RocketChat.settings.get(`Accounts_Default_User_Preferences_${ key }`);\n\t}\n\n\treturn preference !== undefined ? preference : defaultValue;\n};\n","/* globals WebAppInternals */\nRocketChat.settings.get('Site_Url', function(key, value) {\n\tif (value == null || value.trim() === '') {\n\t\treturn;\n\t}\n\tlet host = value.replace(/\\/$/, '');\n\t// let prefix = '';\n\tconst match = value.match(/([^\\/]+\\/{2}[^\\/]+)(\\/.+)/);\n\tif (match != null) {\n\t\thost = match[1];\n\t\t// prefix = match[2].replace(/\\/$/, '');\n\t}\n\t__meteor_runtime_config__.ROOT_URL = value;\n\n\tif (Meteor.absoluteUrl.defaultOptions && Meteor.absoluteUrl.defaultOptions.rootUrl) {\n\t\tMeteor.absoluteUrl.defaultOptions.rootUrl = value;\n\t}\n\tif (Meteor.isServer) {\n\t\tRocketChat.hostname = host.replace(/^https?:\\/\\//, '');\n\t\tprocess.env.MOBILE_ROOT_URL = host;\n\t\tprocess.env.MOBILE_DDP_URL = host;\n\t\tif (typeof WebAppInternals !== 'undefined' && WebAppInternals.generateBoilerplate) {\n\t\t\treturn WebAppInternals.generateBoilerplate();\n\t\t}\n\t}\n});\n","/* global InstanceStatus */\nimport _ from 'underscore';\n\nconst logger = new Logger('Meteor', {\n\tmethods: {\n\t\tmethod: {\n\t\t\ttype: 'debug'\n\t\t},\n\t\tpublish: {\n\t\t\ttype: 'debug'\n\t\t}\n\t}\n});\n\nconst wrapMethods = function(name, originalHandler, methodsMap) {\n\tmethodsMap[name] = function() {\n\t\tconst args = name === 'ufsWrite' ? Array.prototype.slice.call(arguments, 1) : arguments;\n\t\tlogger.method(name, '-> userId:', Meteor.userId(), ', arguments: ', args);\n\n\t\treturn originalHandler.apply(this, arguments);\n\t};\n};\n\nconst originalMeteorMethods = Meteor.methods;\n\nMeteor.methods = function(methodMap) {\n\t_.each(methodMap, function(handler, name) {\n\t\twrapMethods(name, handler, methodMap);\n\t});\n\toriginalMeteorMethods(methodMap);\n};\n\nconst originalMeteorPublish = Meteor.publish;\n\nMeteor.publish = function(name, func) {\n\treturn originalMeteorPublish(name, function() {\n\t\tlogger.publish(name, '-> userId:', this.userId, ', arguments: ', arguments);\n\n\t\treturn func.apply(this, arguments);\n\t});\n};\n\nWebApp.rawConnectHandlers.use(function(req, res, next) {\n\tres.setHeader('X-Instance-ID', InstanceStatus.id());\n\treturn next();\n});\n","import bugsnag from 'bugsnag';\n\nRocketChat.bugsnag = bugsnag;\n\nRocketChat.settings.get('Bugsnag_api_key', (key, value) => {\n\tif (value) {\n\t\tbugsnag.register(value);\n\t}\n});\n\nconst notify = function(message, stack) {\n\tif (typeof stack === 'string') {\n\t\tmessage += ` ${ stack }`;\n\t}\n\tlet options = {};\n\tif (RocketChat.Info) {\n\t\toptions = { app: { version: RocketChat.Info.version, info: RocketChat.Info } };\n\t}\n\tconst error = new Error(message);\n\terror.stack = stack;\n\tRocketChat.bugsnag.notify(error, options);\n};\n\nprocess.on('uncaughtException', Meteor.bindEnvironment((error) => {\n\tnotify(error.message, error.stack);\n\tthrow error;\n}));\n\nconst originalMeteorDebug = Meteor._debug;\nMeteor._debug = function() {\n\tnotify(...arguments);\n\treturn originalMeteorDebug(...arguments);\n};\n","const client = require('prom-client');\n\nRocketChat.promclient = client;\n\nRocketChat.metrics = {};\n\n// one sample metrics only - a counter\n\nRocketChat.metrics.messagesSent = new client.Counter('messages_sent', 'cumulated number of messages sent');\n","/* globals RateLimiter */\nimport _ from 'underscore';\n\nRocketChat.RateLimiter = new class {\n\tlimitFunction(fn, numRequests, timeInterval, matchers) {\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\treturn fn;\n\t\t}\n\t\tconst rateLimiter = new RateLimiter();\n\t\trateLimiter.addRule(matchers, numRequests, timeInterval);\n\t\treturn function(...args) {\n\t\t\tconst match = {};\n\t\t\t_.each(matchers, function(matcher, key) {\n\t\t\t\treturn match[key] = args[key];\n\t\t\t});\n\t\t\trateLimiter.increment(match);\n\t\t\tconst rateLimitResult = rateLimiter.check(match);\n\t\t\tif (rateLimitResult.allowed) {\n\t\t\t\treturn fn.apply(null, arguments);\n\t\t\t} else {\n\t\t\t\tthrow new Meteor.Error('error-too-many-requests', `Error, too many requests. Please slow down. You must wait ${ Math.ceil(rateLimitResult.timeToReset / 1000) } seconds before trying again.`, {\n\t\t\t\t\ttimeToReset: rateLimitResult.timeToReset,\n\t\t\t\t\tseconds: Math.ceil(rateLimitResult.timeToReset / 1000)\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\tlimitMethod(methodName, numRequests, timeInterval, matchers) {\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\treturn;\n\t\t}\n\t\tconst match = {\n\t\t\ttype: 'method',\n\t\t\tname: methodName\n\t\t};\n\t\t_.each(matchers, function(matcher, key) {\n\t\t\treturn match[key] = matchers[key];\n\t\t});\n\t\treturn DDPRateLimiter.addRule(match, numRequests, timeInterval);\n\t}\n\n};\n","/* globals LoggerManager */\nRocketChat.settings.get('Log_Package', function(key, value) {\n\treturn LoggerManager.showPackage = value;\n});\n\nRocketChat.settings.get('Log_File', function(key, value) {\n\treturn LoggerManager.showFileAndLine = value;\n});\n\nRocketChat.settings.get('Log_Level', function(key, value) {\n\tif (value != null) {\n\t\tLoggerManager.logLevel = parseInt(value);\n\t\tMeteor.setTimeout(() => {\n\t\t\treturn LoggerManager.enable(true);\n\t\t}, 200);\n\t}\n});\n","/* globals Push */\nclass PushNotification {\n\tgetNotificationId(roomId) {\n\t\tconst serverId = RocketChat.settings.get('uniqueID');\n\t\treturn this.hash(`${ serverId }|${ roomId }`); // hash\n\t}\n\n\thash(str) {\n\t\tlet hash = 0;\n\t\tlet i = str.length;\n\n\t\twhile (i) {\n\t\t\thash = ((hash << 5) - hash) + str.charCodeAt(--i);\n\t\t\thash = hash & hash; // Convert to 32bit integer\n\t\t}\n\t\treturn hash;\n\t}\n\n\tsend({ roomName, roomId, username, message, usersTo, payload, badge = 1, category }) {\n\t\tlet title;\n\t\tif (roomName && roomName !== '') {\n\t\t\ttitle = `${ roomName }`;\n\t\t\tmessage = `${ username }: ${ message }`;\n\t\t} else {\n\t\t\ttitle = `${ username }`;\n\t\t}\n\t\tconst icon = RocketChat.settings.get('Assets_favicon_192').url || RocketChat.settings.get('Assets_favicon_192').defaultUrl;\n\t\tconst config = {\n\t\t\tfrom: 'push',\n\t\t\tbadge,\n\t\t\tsound: 'default',\n\t\t\ttitle,\n\t\t\ttext: message,\n\t\t\tpayload,\n\t\t\tquery: usersTo,\n\t\t\tnotId: this.getNotificationId(roomId),\n\t\t\tgcm: {\n\t\t\t\tstyle: 'inbox',\n\t\t\t\tsummaryText: '%n% new messages',\n\t\t\t\timage: RocketChat.getURL(icon, { full: true })\n\t\t\t}\n\t\t};\n\n\t\tif (category !== '') {\n\t\t\tconfig.apn = {\n\t\t\t\tcategory\n\t\t\t};\n\t\t}\n\n\t\treturn Push.send(config);\n\t}\n}\n\nRocketChat.PushNotification = new PushNotification();\n","RocketChat.emailDomainDefaultBlackList = [\n\t'0-mail.com',\n\t'0815.ru',\n\t'0815.su',\n\t'0clickemail.com',\n\t'0wnd.net',\n\t'0wnd.org',\n\t'10mail.org',\n\t'10minut.com.pl',\n\t'10minutemail.co.za',\n\t'10minutemail.com',\n\t'10minutemail.de',\n\t'123-m.com',\n\t'1chuan.com',\n\t'1fsdfdsfsdf.tk',\n\t'1pad.de',\n\t'1zhuan.com',\n\t'20email.eu',\n\t'20mail.eu',\n\t'20mail.it',\n\t'20minutemail.com',\n\t'21cn.com',\n\t'2fdgdfgdfgdf.tk',\n\t'2prong.com',\n\t'30minutemail.com',\n\t'33mail.com',\n\t'3d-painting.com',\n\t'3trtretgfrfe.tk',\n\t'4gfdsgfdgfd.tk',\n\t'4warding.com',\n\t'4warding.net',\n\t'4warding.org',\n\t'5ghgfhfghfgh.tk',\n\t'60minutemail.com',\n\t'675hosting.com',\n\t'675hosting.net',\n\t'675hosting.org',\n\t'6hjgjhgkilkj.tk',\n\t'6ip.us',\n\t'6paq.com',\n\t'6url.com',\n\t'75hosting.com',\n\t'75hosting.net',\n\t'75hosting.org',\n\t'7days-printing.com',\n\t'7tags.com',\n\t'99experts.com',\n\t'9ox.net',\n\t'a-bc.net',\n\t'a45.in',\n\t'abcmail.email',\n\t'abyssmail.com',\n\t'acentri.com',\n\t'advantimo.com',\n\t'afrobacon.com',\n\t'ag.us.to',\n\t'agedmail.com',\n\t'ahk.jp',\n\t'ajaxapp.net',\n\t'alivance.com',\n\t'ama-trade.de',\n\t'amail.com',\n\t'amilegit.com',\n\t'amiri.net',\n\t'amiriindustries.com',\n\t'anappthat.com',\n\t'ano-mail.net',\n\t'anonbox.net',\n\t'anonmails.de',\n\t'anonymail.dk',\n\t'anonymbox.com',\n\t'antichef.com',\n\t'antichef.net',\n\t'antireg.ru',\n\t'antispam.de',\n\t'antispammail.de',\n\t'appixie.com',\n\t'armyspy.com',\n\t'artman-conception.com',\n\t'aver.com',\n\t'azmeil.tk',\n\t'baxomale.ht.cx',\n\t'beddly.com',\n\t'beefmilk.com',\n\t'bigprofessor.so',\n\t'bigstring.com',\n\t'binkmail.com',\n\t'bio-muesli.net',\n\t'blogmyway.org',\n\t'bobmail.info',\n\t'bofthew.com',\n\t'bootybay.de',\n\t'boun.cr',\n\t'bouncr.com',\n\t'boxformail.in',\n\t'breakthru.com',\n\t'brefmail.com',\n\t'brennendesreich.de',\n\t'broadbandninja.com',\n\t'bsnow.net',\n\t'bspamfree.org',\n\t'bu.mintemail.com',\n\t'buffemail.com',\n\t'bugmenot.com',\n\t'bumpymail.com',\n\t'bund.us',\n\t'bundes-li.ga',\n\t'burnthespam.info',\n\t'burstmail.info',\n\t'buymoreplays.com',\n\t'buyusedlibrarybooks.org',\n\t'byom.de',\n\t'c2.hu',\n\t'cachedot.net',\n\t'card.zp.ua',\n\t'casualdx.com',\n\t'cbair.com',\n\t'cek.pm',\n\t'cellurl.com',\n\t'centermail.com',\n\t'centermail.net',\n\t'chammy.info',\n\t'cheatmail.de',\n\t'childsavetrust.org',\n\t'chogmail.com',\n\t'choicemail1.com',\n\t'chong-mail.com',\n\t'chong-mail.net',\n\t'chong-mail.org',\n\t'clixser.com',\n\t'cmail.com',\n\t'cmail.net',\n\t'cmail.org',\n\t'coldemail.info',\n\t'consumerriot.com',\n\t'cool.fr.nf',\n\t'correo.blogos.net',\n\t'cosmorph.com',\n\t'courriel.fr.nf',\n\t'courrieltemporaire.com',\n\t'crapmail.org',\n\t'crazymailing.com',\n\t'cubiclink.com',\n\t'curryworld.de',\n\t'cust.in',\n\t'cuvox.de',\n\t'd3p.dk',\n\t'dacoolest.com',\n\t'daintly.com',\n\t'dandikmail.com',\n\t'dayrep.com',\n\t'dbunker.com',\n\t'dcemail.com',\n\t'deadaddress.com',\n\t'deadspam.com',\n\t'deagot.com',\n\t'dealja.com',\n\t'delikkt.de',\n\t'despam.it',\n\t'despammed.com',\n\t'devnullmail.com',\n\t'dfgh.net',\n\t'digitalsanctuary.com',\n\t'dingbone.com',\n\t'discard.email',\n\t'discardmail.com',\n\t'discardmail.de',\n\t'disposableaddress.com',\n\t'disposableemailaddresses.com',\n\t'disposableemailaddresses.emailmiser.com',\n\t'disposableinbox.com',\n\t'dispose.it',\n\t'disposeamail.com',\n\t'disposemail.com',\n\t'dispostable.com',\n\t'dlemail.ru',\n\t'dm.w3internet.co.uk',\n\t'dm.w3internet.co.ukexample.com',\n\t'dodgeit.com',\n\t'dodgit.com',\n\t'dodgit.org',\n\t'doiea.com',\n\t'domozmail.com',\n\t'donemail.ru',\n\t'dontreg.com',\n\t'dontsendmespam.de',\n\t'dotmsg.com',\n\t'drdrb.com',\n\t'drdrb.net',\n\t'droplar.com',\n\t'dropmail.me',\n\t'dt.com',\n\t'duam.net',\n\t'dudmail.com',\n\t'dump-email.info',\n\t'dumpandjunk.com',\n\t'dumpmail.de',\n\t'dumpyemail.com',\n\t'duskmail.com',\n\t'e-mail.com',\n\t'e-mail.org',\n\t'e4ward.com',\n\t'easytrashmail.com',\n\t'einmalmail.de',\n\t'einrot.com',\n\t'einrot.de',\n\t'eintagsmail.de',\n\t'email60.com',\n\t'emaildienst.de',\n\t'emailgo.de',\n\t'emailias.com',\n\t'emailigo.de',\n\t'emailinfive.com',\n\t'emaillime.com',\n\t'emailmiser.com',\n\t'emailproxsy.com',\n\t'emailsensei.com',\n\t'emailtemporanea.com',\n\t'emailtemporanea.net',\n\t'emailtemporar.ro',\n\t'emailtemporario.com.br',\n\t'emailthe.net',\n\t'emailtmp.com',\n\t'emailto.de',\n\t'emailwarden.com',\n\t'emailx.at.hm',\n\t'emailxfer.com',\n\t'emeil.in',\n\t'emeil.ir',\n\t'emil.com',\n\t'emz.net',\n\t'enterto.com',\n\t'ephemail.net',\n\t'ero-tube.org',\n\t'etranquil.com',\n\t'etranquil.net',\n\t'etranquil.org',\n\t'evopo.com',\n\t'explodemail.com',\n\t'express.net.ua',\n\t'eyepaste.com',\n\t'fakeinbox.com',\n\t'fakeinformation.com',\n\t'fakemail.fr',\n\t'fakemailz.com',\n\t'fammix.com',\n\t'fansworldwide.de',\n\t'fantasymail.de',\n\t'fastacura.com',\n\t'fastchevy.com',\n\t'fastchrysler.com',\n\t'fastkawasaki.com',\n\t'fastmazda.com',\n\t'fastmitsubishi.com',\n\t'fastnissan.com',\n\t'fastsubaru.com',\n\t'fastsuzuki.com',\n\t'fasttoyota.com',\n\t'fastyamaha.com',\n\t'fatflap.com',\n\t'fdfdsfds.com',\n\t'fightallspam.com',\n\t'figjs.com',\n\t'fiifke.de',\n\t'filzmail.com',\n\t'fivemail.de',\n\t'fixmail.tk',\n\t'fizmail.com',\n\t'fleckens.hu',\n\t'flemail.ru',\n\t'flyspam.com',\n\t'footard.com',\n\t'forgetmail.com',\n\t'fr33mail.info',\n\t'frapmail.com',\n\t'freundin.ru',\n\t'friendlymail.co.uk',\n\t'front14.org',\n\t'fuckingduh.com',\n\t'fudgerub.com',\n\t'fux0ringduh.com',\n\t'fyii.de',\n\t'garliclife.com',\n\t'gehensiemirnichtaufdensack.de',\n\t'gelitik.in',\n\t'get1mail.com',\n\t'get2mail.fr',\n\t'getairmail.com',\n\t'getmails.eu',\n\t'getonemail.com',\n\t'getonemail.net',\n\t'ghosttexter.de',\n\t'giantmail.de',\n\t'girlsundertheinfluence.com',\n\t'gishpuppy.com',\n\t'gmial.com',\n\t'goemailgo.com',\n\t'gorillaswithdirtyarmpits.com',\n\t'gotmail.com',\n\t'gotmail.net',\n\t'gotmail.org',\n\t'gotti.otherinbox.com',\n\t'gowikibooks.com',\n\t'gowikicampus.com',\n\t'gowikicars.com',\n\t'gowikifilms.com',\n\t'gowikigames.com',\n\t'gowikimusic.com',\n\t'gowikimusic.great-host.in',\n\t'gowikinetwork.com',\n\t'gowikitravel.com',\n\t'gowikitv.com',\n\t'grandmamail.com',\n\t'grandmasmail.com',\n\t'great-host.in',\n\t'greensloth.com',\n\t'grr.la',\n\t'gsrv.co.uk',\n\t'guerillamail.biz',\n\t'guerillamail.com',\n\t'guerillamail.net',\n\t'guerillamail.org',\n\t'guerrillamail.biz',\n\t'guerrillamail.com',\n\t'guerrillamail.de',\n\t'guerrillamail.info',\n\t'guerrillamail.net',\n\t'guerrillamail.org',\n\t'guerrillamailblock.com',\n\t'gustr.com',\n\t'h.mintemail.com',\n\t'h8s.org',\n\t'hacccc.com',\n\t'haltospam.com',\n\t'harakirimail.com',\n\t'hartbot.de',\n\t'hat-geld.de',\n\t'hatespam.org',\n\t'hellodream.mobi',\n\t'herp.in',\n\t'hidemail.de',\n\t'hidzz.com',\n\t'hmamail.com',\n\t'hochsitze.com',\n\t'hopemail.biz',\n\t'hotpop.com',\n\t'hulapla.de',\n\t'iaoss.com',\n\t'ieatspam.eu',\n\t'ieatspam.info',\n\t'ieh-mail.de',\n\t'ihateyoualot.info',\n\t'iheartspam.org',\n\t'ikbenspamvrij.nl',\n\t'imails.info',\n\t'imgof.com',\n\t'imstations.com',\n\t'inbax.tk',\n\t'inbox.si',\n\t'inboxalias.com',\n\t'inboxclean.com',\n\t'inboxclean.org',\n\t'inboxproxy.com',\n\t'incognitomail.com',\n\t'incognitomail.net',\n\t'incognitomail.org',\n\t'infocom.zp.ua',\n\t'inoutmail.de',\n\t'inoutmail.eu',\n\t'inoutmail.info',\n\t'inoutmail.net',\n\t'insorg-mail.info',\n\t'instant-mail.de',\n\t'ip6.li',\n\t'ipoo.org',\n\t'irish2me.com',\n\t'iwi.net',\n\t'jamit.com.au',\n\t'jetable.com',\n\t'jetable.fr.nf',\n\t'jetable.net',\n\t'jetable.org',\n\t'jnxjn.com',\n\t'jourrapide.com',\n\t'jsrsolutions.com',\n\t'junk1e.com',\n\t'kasmail.com',\n\t'kaspop.com',\n\t'keepmymail.com',\n\t'killmail.com',\n\t'killmail.net',\n\t'kimsdisk.com',\n\t'kingsq.ga',\n\t'kir.ch.tc',\n\t'klassmaster.com',\n\t'klassmaster.net',\n\t'klzlk.com',\n\t'kook.ml',\n\t'koszmail.pl',\n\t'kulturbetrieb.info',\n\t'kurzepost.de',\n\t'l33r.eu',\n\t'lackmail.net',\n\t'lags.us',\n\t'lawlita.com',\n\t'lazyinbox.com',\n\t'letthemeatspam.com',\n\t'lhsdv.com',\n\t'lifebyfood.com',\n\t'link2mail.net',\n\t'litedrop.com',\n\t'loadby.us',\n\t'login-email.ml',\n\t'lol.ovpn.to',\n\t'lolfreak.net',\n\t'lookugly.com',\n\t'lopl.co.cc',\n\t'lortemail.dk',\n\t'lovemeleaveme.com',\n\t'lr78.com',\n\t'lroid.com',\n\t'lukop.dk',\n\t'm21.cc',\n\t'm4ilweb.info',\n\t'maboard.com',\n\t'mail-filter.com',\n\t'mail-temporaire.fr',\n\t'mail.by',\n\t'mail.mezimages.net',\n\t'mail.zp.ua',\n\t'mail114.net',\n\t'mail1a.de',\n\t'mail21.cc',\n\t'mail2rss.org',\n\t'mail333.com',\n\t'mail4trash.com',\n\t'mailbidon.com',\n\t'mailbiz.biz',\n\t'mailblocks.com',\n\t'mailbucket.org',\n\t'mailcat.biz',\n\t'mailcatch.com',\n\t'mailde.de',\n\t'mailde.info',\n\t'maildrop.cc',\n\t'maildx.com',\n\t'maileater.com',\n\t'mailed.ro',\n\t'maileimer.de',\n\t'mailexpire.com',\n\t'mailfa.tk',\n\t'mailforspam.com',\n\t'mailfreeonline.com',\n\t'mailfs.com',\n\t'mailguard.me',\n\t'mailimate.com',\n\t'mailin8r.com',\n\t'mailinater.com',\n\t'mailinator.com',\n\t'mailinator.net',\n\t'mailinator.org',\n\t'mailinator.us',\n\t'mailinator2.com',\n\t'mailincubator.com',\n\t'mailismagic.com',\n\t'mailmate.com',\n\t'mailme.ir',\n\t'mailme.lv',\n\t'mailme24.com',\n\t'mailmetrash.com',\n\t'mailmetrash.comilzilla.org',\n\t'mailmoat.com',\n\t'mailms.com',\n\t'mailnator.com',\n\t'mailnesia.com',\n\t'mailnull.com',\n\t'mailorg.org',\n\t'mailpick.biz',\n\t'mailproxsy.com',\n\t'mailquack.com',\n\t'mailrock.biz',\n\t'mailscrap.com',\n\t'mailshell.com',\n\t'mailsiphon.com',\n\t'mailslapping.com',\n\t'mailslite.com',\n\t'mailtemp.info',\n\t'mailtome.de',\n\t'mailtothis.com',\n\t'mailtrash.net',\n\t'mailtv.net',\n\t'mailtv.tv',\n\t'mailzilla.com',\n\t'mailzilla.org',\n\t'mailzilla.orgmbx.cc',\n\t'makemetheking.com',\n\t'manifestgenerator.com',\n\t'manybrain.com',\n\t'mbx.cc',\n\t'mega.zik.dj',\n\t'meinspamschutz.de',\n\t'meltmail.com',\n\t'messagebeamer.de',\n\t'mezimages.net',\n\t'mierdamail.com',\n\t'migumail.com',\n\t'ministry-of-silly-walks.de',\n\t'mintemail.com',\n\t'misterpinball.de',\n\t'mjukglass.nu',\n\t'mmailinater.com',\n\t'moakt.com',\n\t'mobi.web.id',\n\t'mobileninja.co.uk',\n\t'moburl.com',\n\t'mohmal.com',\n\t'moncourrier.fr.nf',\n\t'monemail.fr.nf',\n\t'monmail.fr.nf',\n\t'monumentmail.com',\n\t'msa.minsmail.com',\n\t'mt2009.com',\n\t'mt2014.com',\n\t'mx0.wwwnew.eu',\n\t'my10minutemail.com',\n\t'mycard.net.ua',\n\t'mycleaninbox.net',\n\t'myemailboxy.com',\n\t'mymail-in.net',\n\t'mymailoasis.com',\n\t'mynetstore.de',\n\t'mypacks.net',\n\t'mypartyclip.de',\n\t'myphantomemail.com',\n\t'mysamp.de',\n\t'myspaceinc.com',\n\t'myspaceinc.net',\n\t'myspaceinc.org',\n\t'myspacepimpedup.com',\n\t'myspamless.com',\n\t'mytemp.email',\n\t'mytempemail.com',\n\t'mytempmail.com',\n\t'mytrashmail.com',\n\t'nabuma.com',\n\t'neomailbox.com',\n\t'nepwk.com',\n\t'nervmich.net',\n\t'nervtmich.net',\n\t'netmails.com',\n\t'netmails.net',\n\t'netzidiot.de',\n\t'neverbox.com',\n\t'nice-4u.com',\n\t'nincsmail.com',\n\t'nincsmail.hu',\n\t'nnh.com',\n\t'no-spam.ws',\n\t'noblepioneer.com',\n\t'nobulk.com',\n\t'noclickemail.com',\n\t'nogmailspam.info',\n\t'nomail.pw',\n\t'nomail.xl.cx',\n\t'nomail2me.com',\n\t'nomorespamemails.com',\n\t'nonspam.eu',\n\t'nonspammer.de',\n\t'noref.in',\n\t'nospam.ze.tc',\n\t'nospam4.us',\n\t'nospamfor.us',\n\t'nospammail.net',\n\t'nospamthanks.info',\n\t'notmailinator.com',\n\t'notsharingmy.info',\n\t'nowhere.org',\n\t'nowmymail.com',\n\t'nurfuerspam.de',\n\t'nus.edu.sg',\n\t'nwldx.com',\n\t'objectmail.com',\n\t'obobbo.com',\n\t'odaymail.com',\n\t'odnorazovoe.ru',\n\t'one-time.email',\n\t'oneoffemail.com',\n\t'oneoffmail.com',\n\t'onewaymail.com',\n\t'onlatedotcom.info',\n\t'online.ms',\n\t'oopi.org',\n\t'opayq.com',\n\t'ordinaryamerican.net',\n\t'otherinbox.codupmyspace.com',\n\t'otherinbox.com',\n\t'ourklips.com',\n\t'outlawspam.com',\n\t'ovpn.to',\n\t'owlpic.com',\n\t'pancakemail.com',\n\t'paplease.com',\n\t'pcusers.otherinbox.com',\n\t'pepbot.com',\n\t'pfui.ru',\n\t'pimpedupmyspace.com',\n\t'pjjkp.com',\n\t'plexolan.de',\n\t'poczta.onet.pl',\n\t'politikerclub.de',\n\t'pooae.com',\n\t'poofy.org',\n\t'pookmail.com',\n\t'privacy.net',\n\t'privatdemail.net',\n\t'privy-mail.com',\n\t'privymail.de',\n\t'proxymail.eu',\n\t'prtnx.com',\n\t'prtz.eu',\n\t'punkass.com',\n\t'putthisinyourspamdatabase.com',\n\t'pwrby.com',\n\t'quickinbox.com',\n\t'quickmail.nl',\n\t'rcpt.at',\n\t'reallymymail.com',\n\t'realtyalerts.ca',\n\t'recode.me',\n\t'recursor.net',\n\t'recyclemail.dk',\n\t'regbypass.com',\n\t'regbypass.comsafe-mail.net',\n\t'rejectmail.com',\n\t'reliable-mail.com',\n\t'rhyta.com',\n\t'rklips.com',\n\t'rmqkr.net',\n\t'royal.net',\n\t'rppkn.com',\n\t'rtrtr.com',\n\t's0ny.net',\n\t'safe-mail.net',\n\t'safersignup.de',\n\t'safetymail.info',\n\t'safetypost.de',\n\t'sandelf.de',\n\t'saynotospams.com',\n\t'schafmail.de',\n\t'schrott-email.de',\n\t'secretemail.de',\n\t'secure-mail.biz',\n\t'selfdestructingmail.com',\n\t'selfdestructingmail.org',\n\t'sendspamhere.com',\n\t'sendspamhere.com',\n\t'senseless-entertainment.com',\n\t'services391.com',\n\t'sharedmailbox.org',\n\t'sharklasers.com',\n\t'shieldedmail.com',\n\t'shieldemail.com',\n\t'shiftmail.com',\n\t'shitmail.me',\n\t'shitmail.org',\n\t'shitware.nl',\n\t'shmeriously.com',\n\t'shortmail.net',\n\t'shotmail.ru',\n\t'showslow.de',\n\t'sibmail.com',\n\t'sinnlos-mail.de',\n\t'siteposter.net',\n\t'skeefmail.com',\n\t'slapsfromlastnight.com',\n\t'slaskpost.se',\n\t'slipry.net',\n\t'slopsbox.com',\n\t'slushmail.com',\n\t'smashmail.de',\n\t'smellfear.com',\n\t'smellrear.com',\n\t'snakemail.com',\n\t'sneakemail.com',\n\t'sneakmail.de',\n\t'snkmail.com',\n\t'sofimail.com',\n\t'sofort-mail.de',\n\t'softpls.asia',\n\t'sogetthis.com',\n\t'sohu.com',\n\t'solvemail.info',\n\t'soodonims.com',\n\t'spa.com',\n\t'spaereplease.com',\n\t'spam.la',\n\t'spam.su',\n\t'spam4.me',\n\t'spamail.de',\n\t'spamarrest.com',\n\t'spamavert.com',\n\t'spambob.com',\n\t'spambob.net',\n\t'spambob.org',\n\t'spambog.com',\n\t'spambog.de',\n\t'spambog.net',\n\t'spambog.ru',\n\t'spambox.info',\n\t'spambox.irishspringrealty.com',\n\t'spambox.us',\n\t'spamcannon.com',\n\t'spamcannon.net',\n\t'spamcero.com',\n\t'spamcon.org',\n\t'spamcorptastic.com',\n\t'spamcowboy.com',\n\t'spamcowboy.net',\n\t'spamcowboy.org',\n\t'spamday.com',\n\t'spamex.com',\n\t'spamfree.eu',\n\t'spamfree24.com',\n\t'spamfree24.de',\n\t'spamfree24.eu',\n\t'spamfree24.info',\n\t'spamfree24.net',\n\t'spamfree24.org',\n\t'spamgoes.in',\n\t'spamgourmet.com',\n\t'spamgourmet.net',\n\t'spamgourmet.org',\n\t'spamherelots.com',\n\t'spamhereplease.com',\n\t'spamhole.com',\n\t'spamify.com',\n\t'spaminator.de',\n\t'spamkill.info',\n\t'spaml.com',\n\t'spaml.de',\n\t'spammotel.com',\n\t'spamobox.com',\n\t'spamoff.de',\n\t'spamsalad.in',\n\t'spamslicer.com',\n\t'spamspot.com',\n\t'spamstack.net',\n\t'spamthis.co.uk',\n\t'spamthisplease.com',\n\t'spamtrail.com',\n\t'spamtroll.net',\n\t'speed.1s.fr',\n\t'spikio.com',\n\t'spoofmail.de',\n\t'squizzy.de',\n\t'ssoia.com',\n\t'startkeys.com',\n\t'stinkefinger.net',\n\t'stop-my-spam.com',\n\t'stuffmail.de',\n\t'super-auswahl.de',\n\t'supergreatmail.com',\n\t'supermailer.jp',\n\t'superrito.com',\n\t'superstachel.de',\n\t'suremail.info',\n\t'svk.jp',\n\t'sweetxxx.de',\n\t'tagyourself.com',\n\t'talkinator.com',\n\t'tapchicuoihoi.com',\n\t'teewars.org',\n\t'teleosaurs.xyz',\n\t'teleworm.com',\n\t'teleworm.us',\n\t'temp-mail.org',\n\t'temp-mail.ru',\n\t'temp.emeraldwebmail.com',\n\t'temp.headstrong.de',\n\t'tempalias.com',\n\t'tempe-mail.com',\n\t'tempemail.biz',\n\t'tempemail.co.za',\n\t'tempemail.com',\n\t'tempemail.net',\n\t'tempemail.net',\n\t'tempinbox.co.uk',\n\t'tempinbox.com',\n\t'tempmail.eu',\n\t'tempmail.it',\n\t'tempmail2.com',\n\t'tempmaildemo.com',\n\t'tempmailer.com',\n\t'tempmailer.de',\n\t'tempomail.fr',\n\t'temporarily.de',\n\t'temporarioemail.com.br',\n\t'temporaryemail.net',\n\t'temporaryemail.us',\n\t'temporaryforwarding.com',\n\t'temporaryinbox.com',\n\t'temporarymailaddress.com',\n\t'tempsky.com',\n\t'tempthe.net',\n\t'tempymail.com',\n\t'thanksnospam.info',\n\t'thankyou2010.com',\n\t'thc.st',\n\t'thecloudindex.com',\n\t'thelimestones.com',\n\t'thisisnotmyrealemail.com',\n\t'thismail.net',\n\t'thrma.com',\n\t'throwawayemailaddress.com',\n\t'tilien.com',\n\t'tittbit.in',\n\t'tizi.com',\n\t'tmail.ws',\n\t'tmailinator.com',\n\t'toiea.com',\n\t'toomail.biz',\n\t'topranklist.de',\n\t'tradermail.info',\n\t'trash-amil.com',\n\t'trash-mail.at',\n\t'trash-mail.com',\n\t'trash-mail.de',\n\t'trash2009.com',\n\t'trash2010.com',\n\t'trash2011.com',\n\t'trashdevil.com',\n\t'trashdevil.de',\n\t'trashemail.de',\n\t'trashmail.at',\n\t'trashmail.com',\n\t'trashmail.de',\n\t'trashmail.me',\n\t'trashmail.net',\n\t'trashmail.org',\n\t'trashmail.ws',\n\t'trashmailer.com',\n\t'trashymail.com',\n\t'trashymail.net',\n\t'trbvm.com',\n\t'trbvn.com',\n\t'trialmail.de',\n\t'trillianpro.com',\n\t'tryalert.com',\n\t'turual.com',\n\t'twinmail.de',\n\t'twoweirdtricks.com',\n\t'tyldd.com',\n\t'uggsrock.com',\n\t'umail.net',\n\t'upliftnow.com',\n\t'uplipht.com',\n\t'uroid.com',\n\t'us.af',\n\t'username.e4ward.com',\n\t'venompen.com',\n\t'veryrealemail.com',\n\t'vidchart.com',\n\t'viditag.com',\n\t'viewcastmedia.com',\n\t'viewcastmedia.net',\n\t'viewcastmedia.org',\n\t'viewcastmediae',\n\t'viralplays.com',\n\t'vkcode.ru',\n\t'vomoto.com',\n\t'vpn.st',\n\t'vsimcard.com',\n\t'vubby.com',\n\t'walala.org',\n\t'walkmail.net',\n\t'walkmail.ru',\n\t'wasteland.rfc822.org',\n\t'webemail.me',\n\t'webm4il.info',\n\t'webuser.in',\n\t'wee.my',\n\t'weg-werf-email.de',\n\t'wegwerf-email-addressen.de',\n\t'wegwerf-emails.de',\n\t'wegwerfadresse.de',\n\t'wegwerfemail.com',\n\t'wegwerfemail.de',\n\t'wegwerfmail.de',\n\t'wegwerfmail.info',\n\t'wegwerfmail.net',\n\t'wegwerfmail.org',\n\t'wetrainbayarea.com',\n\t'wetrainbayarea.org',\n\t'wh4f.org',\n\t'whatiaas.com',\n\t'whatpaas.com',\n\t'whatsaas.com',\n\t'whopy.com',\n\t'whtjddn.33mail.com',\n\t'whyspam.me',\n\t'wilemail.com',\n\t'willhackforfood.biz',\n\t'willselfdestruct.com',\n\t'winemaven.info',\n\t'wronghead.com',\n\t'wuzup.net',\n\t'wuzupmail.net',\n\t'www.e4ward.com',\n\t'www.gishpuppy.com',\n\t'www.mailinator.com',\n\t'wwwnew.eu',\n\t'x.ip6.li',\n\t'xagloo.com',\n\t'xemaps.com',\n\t'xents.com',\n\t'xmaily.com',\n\t'xoxy.net',\n\t'xyzfree.net',\n\t'yapped.net',\n\t'yeah.net',\n\t'yep.it',\n\t'yogamaven.com',\n\t'yomail.info',\n\t'yopmail.com',\n\t'yopmail.fr',\n\t'yopmail.net',\n\t'yourdomain.com',\n\t'ypmail.webarnak.fr.eu.org',\n\t'yuurok.com',\n\t'z1p.biz',\n\t'za.com',\n\t'zehnminuten.de',\n\t'zehnminutenmail.de',\n\t'zetmail.com',\n\t'zippymail.info',\n\t'zoaxe.com',\n\t'zoemail.com',\n\t'zoemail.net',\n\t'zoemail.org',\n\t'zomg.info',\n\t'zxcv.com',\n\t'zxcvbnm.com',\n\t'zzz.com'\n];\n\n","import IMAP from 'imap';\nimport POP3 from 'poplib';\nimport { simpleParser } from 'mailparser-node4';\n\nexport class IMAPIntercepter {\n\tconstructor() {\n\t\tthis.imap = new IMAP({\n\t\t\tuser: RocketChat.settings.get('Direct_Reply_Username'),\n\t\t\tpassword: RocketChat.settings.get('Direct_Reply_Password'),\n\t\t\thost: RocketChat.settings.get('Direct_Reply_Host'),\n\t\t\tport: RocketChat.settings.get('Direct_Reply_Port'),\n\t\t\tdebug: RocketChat.settings.get('Direct_Reply_Debug') ? console.log : false,\n\t\t\ttls: !RocketChat.settings.get('Direct_Reply_IgnoreTLS'),\n\t\t\tconnTimeout: 30000,\n\t\t\tkeepalive: true\n\t\t});\n\n\t\tthis.delete = RocketChat.settings.get('Direct_Reply_Delete') ? RocketChat.settings.get('Direct_Reply_Delete') : true;\n\n\t\t// On successfully connected.\n\t\tthis.imap.on('ready', Meteor.bindEnvironment(() => {\n\t\t\tif (this.imap.state !== 'disconnected') {\n\t\t\t\tthis.openInbox(Meteor.bindEnvironment((err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tthrow err;\n\t\t\t\t\t}\n\t\t\t\t\t// fetch new emails & wait [IDLE]\n\t\t\t\t\tthis.getEmails();\n\n\t\t\t\t\t// If new message arrived, fetch them\n\t\t\t\t\tthis.imap.on('mail', Meteor.bindEnvironment(() => {\n\t\t\t\t\t\tthis.getEmails();\n\t\t\t\t\t}));\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tconsole.log('IMAP didnot connected.');\n\t\t\t\tthis.imap.end();\n\t\t\t}\n\t\t}));\n\n\t\tthis.imap.on('error', (err) => {\n\t\t\tconsole.log('Error occurred ...');\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\topenInbox(cb) {\n\t\tthis.imap.openBox('INBOX', false, cb);\n\t}\n\n\tstart() {\n\t\tthis.imap.connect();\n\t}\n\n\tisActive() {\n\t\tif (this.imap && this.imap.state && this.imap.state === 'disconnected') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tstop(callback = new Function) {\n\t\tthis.imap.end();\n\t\tthis.imap.once('end', callback);\n\t}\n\n\trestart() {\n\t\tthis.stop(() => {\n\t\t\tconsole.log('Restarting IMAP ....');\n\t\t\tthis.start();\n\t\t});\n\t}\n\n\t// Fetch all UNSEEN messages and pass them for further processing\n\tgetEmails() {\n\t\tthis.imap.search(['UNSEEN'], Meteor.bindEnvironment((err, newEmails) => {\n\t\t\tif (err) {\n\t\t\t\tconsole.log(err);\n\t\t\t\tthrow err;\n\t\t\t}\n\n\t\t\t// newEmails => array containing serials of unseen messages\n\t\t\tif (newEmails.length > 0) {\n\t\t\t\tconst f = this.imap.fetch(newEmails, {\n\t\t\t\t\t// fetch headers & first body part.\n\t\t\t\t\tbodies: ['HEADER.FIELDS (FROM TO DATE MESSAGE-ID)', '1'],\n\t\t\t\t\tstruct: true,\n\t\t\t\t\tmarkSeen: true\n\t\t\t\t});\n\n\t\t\t\tf.on('message', Meteor.bindEnvironment((msg, seqno) => {\n\t\t\t\t\tconst email = {};\n\n\t\t\t\t\tmsg.on('body', (stream, info) => {\n\t\t\t\t\t\tlet headerBuffer = '';\n\t\t\t\t\t\tlet bodyBuffer = '';\n\n\t\t\t\t\t\tstream.on('data', (chunk) => {\n\t\t\t\t\t\t\tif (info.which === '1') {\n\t\t\t\t\t\t\t\tbodyBuffer += chunk.toString('utf8');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\theaderBuffer += chunk.toString('utf8');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tstream.once('end', () => {\n\t\t\t\t\t\t\tif (info.which === '1') {\n\t\t\t\t\t\t\t\temail.body = bodyBuffer;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// parse headers\n\t\t\t\t\t\t\t\temail.headers = IMAP.parseHeader(headerBuffer);\n\n\t\t\t\t\t\t\t\temail.headers.to = email.headers.to[0];\n\t\t\t\t\t\t\t\temail.headers.date = email.headers.date[0];\n\t\t\t\t\t\t\t\temail.headers.from = email.headers.from[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t// On fetched each message, pass it further\n\t\t\t\t\tmsg.once('end', Meteor.bindEnvironment(() => {\n\t\t\t\t\t\t// delete message from inbox\n\t\t\t\t\t\tif (this.delete) {\n\t\t\t\t\t\t\tthis.imap.seq.addFlags(seqno, 'Deleted', (err) => {\n\t\t\t\t\t\t\t\tif (err) { console.log(`Mark deleted error: ${ err }`); }\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tRocketChat.processDirectEmail(email);\n\t\t\t\t\t}));\n\t\t\t\t}));\n\t\t\t\tf.once('error', (err) => {\n\t\t\t\t\tconsole.log(`Fetch error: ${ err }`);\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\t}\n}\n\nexport class POP3Intercepter {\n\tconstructor() {\n\t\tthis.pop3 = new POP3(RocketChat.settings.get('Direct_Reply_Port'), RocketChat.settings.get('Direct_Reply_Host'), {\n\t\t\tenabletls: !RocketChat.settings.get('Direct_Reply_IgnoreTLS'),\n\t\t\tdebug: RocketChat.settings.get('Direct_Reply_Debug') ? console.log : false\n\t\t});\n\n\t\tthis.totalMsgCount = 0;\n\t\tthis.currentMsgCount = 0;\n\n\t\tthis.pop3.on('connect', Meteor.bindEnvironment(() => {\n\t\t\tthis.pop3.login(RocketChat.settings.get('Direct_Reply_Username'), RocketChat.settings.get('Direct_Reply_Password'));\n\t\t}));\n\n\t\tthis.pop3.on('login', Meteor.bindEnvironment((status) => {\n\t\t\tif (status) {\n\t\t\t\t// run on start\n\t\t\t\tthis.pop3.list();\n\t\t\t} else {\n\t\t\t\tconsole.log('Unable to Log-in ....');\n\t\t\t}\n\t\t}));\n\n\t\t// on getting list of all emails\n\t\tthis.pop3.on('list', Meteor.bindEnvironment((status, msgcount) => {\n\t\t\tif (status) {\n\t\t\t\tif (msgcount > 0) {\n\t\t\t\t\tthis.totalMsgCount = msgcount;\n\t\t\t\t\tthis.currentMsgCount = 1;\n\t\t\t\t\t// Retrieve email\n\t\t\t\t\tthis.pop3.retr(this.currentMsgCount);\n\t\t\t\t} else {\n\t\t\t\t\tthis.pop3.quit();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log('Cannot Get Emails ....');\n\t\t\t}\n\t\t}));\n\n\t\t// on retrieved email\n\t\tthis.pop3.on('retr', Meteor.bindEnvironment((status, msgnumber, data) => {\n\t\t\tif (status) {\n\t\t\t\t// parse raw email data to  JSON object\n\t\t\t\tsimpleParser(data, Meteor.bindEnvironment((err, mail) => {\n\t\t\t\t\tthis.initialProcess(mail);\n\t\t\t\t}));\n\n\t\t\t\tthis.currentMsgCount += 1;\n\n\t\t\t\t// delete email\n\t\t\t\tthis.pop3.dele(msgnumber);\n\t\t\t} else {\n\t\t\t\tconsole.log('Cannot Retrieve Message ....');\n\t\t\t}\n\t\t}));\n\n\t\t// on email deleted\n\t\tthis.pop3.on('dele', Meteor.bindEnvironment((status) => {\n\t\t\tif (status) {\n\t\t\t\t// get next email\n\t\t\t\tif (this.currentMsgCount <= this.totalMsgCount) {\n\t\t\t\t\tthis.pop3.retr(this.currentMsgCount);\n\t\t\t\t} else {\n\t\t\t\t\t// parsed all messages.. so quitting\n\t\t\t\t\tthis.pop3.quit();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log('Cannot Delete Message....');\n\t\t\t}\n\t\t}));\n\n\t\t// invalid server state\n\t\tthis.pop3.on('invalid-state', function(cmd) {\n\t\t\tconsole.log(`Invalid state. You tried calling ${ cmd }`);\n\t\t});\n\n\t\t// locked => command already running, not finished yet\n\t\tthis.pop3.on('locked', function(cmd) {\n\t\t\tconsole.log(`Current command has not finished yet. You tried calling ${ cmd }`);\n\t\t});\n\t}\n\n\tinitialProcess(mail) {\n\t\tconst email = {\n\t\t\theaders: {\n\t\t\t\tfrom: mail.from.text,\n\t\t\t\tto: mail.to.text,\n\t\t\t\tdate: mail.date,\n\t\t\t\t'message-id': mail.messageId\n\t\t\t},\n\t\t\tbody: mail.text\n\t\t};\n\n\t\tRocketChat.processDirectEmail(email);\n\t}\n}\n\nexport class POP3Helper {\n\tconstructor() {\n\t\tthis.running = false;\n\t}\n\n\tstart() {\n\t\t// run every x-minutes\n\t\tif (RocketChat.settings.get('Direct_Reply_Frequency')) {\n\t\t\tRocketChat.POP3 = new POP3Intercepter();\n\n\t\t\tthis.running = Meteor.setInterval(() => {\n\t\t\t\t// get new emails and process\n\t\t\t\tRocketChat.POP3 = new POP3Intercepter();\n\t\t\t}, Math.max(RocketChat.settings.get('Direct_Reply_Frequency')*60*1000, 2*60*1000));\n\t\t}\n\t}\n\n\tisActive() {\n\t\treturn this.running;\n\t}\n\n\tstop(callback = new Function) {\n\t\tif (this.isActive()) {\n\t\t\tMeteor.clearInterval(this.running);\n\t\t}\n\t\tcallback();\n\t}\n}\n","// Do not disclose if user exists when password is invalid\nconst _runLoginHandlers = Accounts._runLoginHandlers;\nAccounts._runLoginHandlers = function(methodInvocation, options) {\n\tconst result = _runLoginHandlers.call(Accounts, methodInvocation, options);\n\n\tif (result.error && result.error.reason === 'Incorrect password') {\n\t\tresult.error = new Meteor.Error(403, 'User not found');\n\t}\n\n\treturn result;\n};\n","import _ from 'underscore';\nimport s from 'underscore.string';\nimport moment from 'moment';\n\nRocketChat.callbacks.add('afterSaveMessage', function(message, room) {\n\t// skips this callback if the message was edited and increments it if the edit was way in the past (aka imported)\n\tif (message.editedAt && Math.abs(moment(message.editedAt).diff()) > 60000) {\n\t\t//TODO: Review as I am not sure how else to get around this as the incrementing of the msgs count shouldn't be in this callback\n\t\tRocketChat.models.Rooms.incMsgCountById(message.rid, 1);\n\t\treturn message;\n\t} else if (message.editedAt) {\n\n\t\t// only updates last message if it was edited (skip rest of callback)\n\t\tif (RocketChat.settings.get('Store_Last_Message') && (!room.lastMessage || room.lastMessage._id === message._id)) {\n\t\t\tRocketChat.models.Rooms.setLastMessageById(message.rid, message);\n\t\t}\n\t\treturn message;\n\t}\n\n\tif (message.ts && Math.abs(moment(message.ts).diff()) > 60000) {\n\t\tRocketChat.models.Rooms.incMsgCountById(message.rid, 1);\n\t\treturn message;\n\t}\n\n\t/**\n\t * Chechs if a messages contains a user highlight\n\t *\n\t * @param {string} message\n\t * @param {array|undefined} highlights\n\t *\n\t * @returns {boolean}\n     */\n\tfunction messageContainsHighlight(message, highlights) {\n\t\tif (! highlights || highlights.length === 0) { return false; }\n\n\t\tlet has = false;\n\t\thighlights.some(function(highlight) {\n\t\t\tconst regexp = new RegExp(s.escapeRegExp(highlight), 'i');\n\t\t\tif (regexp.test(message.msg)) {\n\t\t\t\thas = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\n\t\treturn has;\n\t}\n\n\tif (room != null) {\n\t\tlet toAll = false;\n\t\tlet toHere = false;\n\t\tconst mentionIds = [];\n\t\tconst highlightsIds = [];\n\t\tconst highlights = RocketChat.models.Users.findUsersByUsernamesWithHighlights(room.usernames, { fields: { '_id': 1, 'settings.preferences.highlights': 1 }}).fetch();\n\n\t\tif (message.mentions != null) {\n\t\t\tmessage.mentions.forEach(function(mention) {\n\t\t\t\tif (!toAll && mention._id === 'all') {\n\t\t\t\t\ttoAll = true;\n\t\t\t\t}\n\t\t\t\tif (!toHere && mention._id === 'here') {\n\t\t\t\t\ttoHere = true;\n\t\t\t\t}\n\t\t\t\tif (mention._id !== message.u._id) {\n\t\t\t\t\tmentionIds.push(mention._id);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\thighlights.forEach(function(user) {\n\t\t\tconst userHighlights = RocketChat.getUserPreference(user, 'highlights');\n\t\t\tif (userHighlights && messageContainsHighlight(message, userHighlights)) {\n\t\t\t\tif (user._id !== message.u._id) {\n\t\t\t\t\thighlightsIds.push(user._id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (room.t === 'd') {\n\t\t\tconst unreadCountDM = RocketChat.settings.get('Unread_Count_DM');\n\n\t\t\tif (unreadCountDM === 'all_messages') {\n\t\t\t\tRocketChat.models.Subscriptions.incUnreadForRoomIdExcludingUserId(room._id, message.u._id);\n\t\t\t} else if (toAll || toHere) {\n\t\t\t\tRocketChat.models.Subscriptions.incGroupMentionsAndUnreadForRoomIdExcludingUserId(room._id, message.u._id, 1, 1);\n\t\t\t} else if ((mentionIds && mentionIds.length > 0) || (highlightsIds && highlightsIds.length > 0)) {\n\t\t\t\tRocketChat.models.Subscriptions.incUserMentionsAndUnreadForRoomIdAndUserIds(room._id, _.compact(_.unique(mentionIds.concat(highlightsIds))), 1, 1);\n\t\t\t}\n\t\t} else {\n\t\t\tconst unreadCount = RocketChat.settings.get('Unread_Count');\n\n\t\t\tif (toAll || toHere) {\n\t\t\t\tlet incUnread = 0;\n\t\t\t\tif (['all_messages', 'group_mentions_only', 'user_and_group_mentions_only'].includes(unreadCount)) {\n\t\t\t\t\tincUnread = 1;\n\t\t\t\t}\n\t\t\t\tRocketChat.models.Subscriptions.incGroupMentionsAndUnreadForRoomIdExcludingUserId(room._id, message.u._id, 1, incUnread);\n\t\t\t} else if ((mentionIds && mentionIds.length > 0) || (highlightsIds && highlightsIds.length > 0)) {\n\t\t\t\tlet incUnread = 0;\n\t\t\t\tif (['all_messages', 'user_mentions_only', 'user_and_group_mentions_only'].includes(unreadCount)) {\n\t\t\t\t\tincUnread = 1;\n\t\t\t\t}\n\t\t\t\tRocketChat.models.Subscriptions.incUserMentionsAndUnreadForRoomIdAndUserIds(room._id, _.compact(_.unique(mentionIds.concat(highlightsIds))), 1, incUnread);\n\t\t\t} else if (unreadCount === 'all_messages') {\n\t\t\t\tRocketChat.models.Subscriptions.incUnreadForRoomIdExcludingUserId(room._id, message.u._id);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Update all the room activity tracker fields\n\tRocketChat.models.Rooms.incMsgCountAndSetLastMessageById(message.rid, 1, message.ts, RocketChat.settings.get('Store_Last_Message') && message);\n\n\t// Update all other subscriptions to alert their owners but witout incrementing\n\t// the unread counter, as it is only for mentions and direct messages\n\tRocketChat.models.Subscriptions.setAlertForRoomIdExcludingUserId(message.rid, message.u._id);\n\n\treturn message;\n\n}, RocketChat.callbacks.priority.LOW, 'notifyUsersOnMessage');\n","import {EmailReplyParser as reply} from 'emailreplyparser';\nimport moment from 'moment';\n\nRocketChat.processDirectEmail = function(email) {\n\tfunction sendMessage(email) {\n\t\tconst message = {\n\t\t\tts: new Date(email.headers.date),\n\t\t\tmsg: email.body,\n\t\t\tsentByEmail: true,\n\t\t\tgroupable: false\n\t\t};\n\n\t\tif (message.ts) {\n\t\t\tconst tsDiff = Math.abs(moment(message.ts).diff());\n\t\t\tif (tsDiff > 10000) {\n\t\t\t\tmessage.ts = new Date();\n\t\t\t}\n\t\t} else {\n\t\t\tmessage.ts = new Date();\n\t\t}\n\n\t\tif (message.msg && message.msg.length > RocketChat.settings.get('Message_MaxAllowedSize')) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// reduce new lines in multiline message\n\t\tmessage.msg = message.msg.split('\\n\\n').join('\\n');\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email.headers.from, {\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tname: 1\n\t\t\t}\n\t\t});\n\t\tif (!user) {\n\t\t\t// user not found\n\t\t\treturn false;\n\t\t}\n\n\t\tconst prevMessage = RocketChat.models.Messages.findOneById(email.headers.mid, {\n\t\t\trid: 1,\n\t\t\tu: 1\n\t\t});\n\t\tif (!prevMessage) {\n\t\t\t// message doesn't exist anymore\n\t\t\treturn false;\n\t\t}\n\t\tmessage.rid = prevMessage.rid;\n\n\t\tconst room = Meteor.call('canAccessRoom', message.rid, user._id);\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst roomInfo = RocketChat.models.Rooms.findOneById(message.rid, {\n\t\t\tt: 1,\n\t\t\tname: 1\n\t\t});\n\n\t\t// check mention\n\t\tif (message.msg.indexOf(`@${ prevMessage.u.username }`) === -1 && roomInfo.t !== 'd') {\n\t\t\tmessage.msg = `@${ prevMessage.u.username } ${ message.msg }`;\n\t\t}\n\n\t\t// reply message link\n\t\tlet prevMessageLink = `[ ](${ Meteor.absoluteUrl().replace(/\\/$/, '') }`;\n\t\tif (roomInfo.t === 'c') {\n\t\t\tprevMessageLink += `/channel/${ roomInfo.name }?msg=${ email.headers.mid }) `;\n\t\t} else if (roomInfo.t === 'd') {\n\t\t\tprevMessageLink += `/direct/${ prevMessage.u.username }?msg=${ email.headers.mid }) `;\n\t\t} else if (roomInfo.t === 'p') {\n\t\t\tprevMessageLink += `/group/${ roomInfo.name }?msg=${ email.headers.mid }) `;\n\t\t}\n\t\t// add reply message link\n\t\tmessage.msg = prevMessageLink + message.msg;\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(message.rid, user._id);\n\t\tif (subscription && subscription.blocked || subscription.blocker) {\n\t\t\t// room is blocked\n\t\t\treturn false;\n\t\t}\n\n\t\tif ((room.muted || []).includes(user.username)) {\n\t\t\t// room is muted\n\t\t\treturn false;\n\t\t}\n\n\t\tif (message.alias == null && RocketChat.settings.get('Message_SetNameToAliasEnabled')) {\n\t\t\tmessage.alias = user.name;\n\t\t}\n\n\t\tRocketChat.metrics.messagesSent.inc(); // TODO This line needs to be moved to it's proper place. See the comments on: https://github.com/RocketChat/Rocket.Chat/pull/5736\n\n\t\treturn RocketChat.sendMessage(user, message, room);\n\t}\n\n\t// Extract/parse reply from email body\n\temail.body = reply.parse_reply(email.body);\n\n\t// if 'To' email format is \"Name <username@domain>\"\n\tif (email.headers.to.indexOf('<') >= 0 && email.headers.to.indexOf('>') >= 0) {\n\t\temail.headers.to = email.headers.to.split('<')[1].split('>')[0];\n\t}\n\n\t// if 'From' email format is \"Name <username@domain>\"\n\tif (email.headers.from.indexOf('<') >= 0 && email.headers.from.indexOf('>') >= 0) {\n\t\temail.headers.from = email.headers.from.split('<')[1].split('>')[0];\n\t}\n\n\t// 'To' email format \"username+messageId@domain\"\n\tif (email.headers.to.indexOf('+') >= 0) {\n\t\t// Valid 'To' format\n\t\temail.headers.mid = email.headers.to.split('@')[0].split('+')[1];\n\t\tsendMessage(email);\n\t} else {\n\t\tconsole.log('Invalid Email....If not. Please report it.');\n\t}\n};\n","import { RoomTypesCommon } from '../../lib/RoomTypesCommon';\n\nRocketChat.roomTypes = new class roomTypesServer extends RoomTypesCommon {\n\t/**\n\t * Add a publish for a room type\n\t *\n\t * @param {string} roomType room type (e.g.: c (for channels), d (for direct channels))\n\t * @param {function} callback function that will return the publish's data\n\t*/\n\tsetPublish(roomType, callback) {\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].publish != null) {\n\t\t\tthrow new Meteor.Error('route-publish-exists', 'Publish for the given type already exists');\n\t\t}\n\t\tif (this.roomTypes[roomType] == null) {\n\t\t\tthis.roomTypes[roomType] = {};\n\t\t}\n\t\treturn this.roomTypes[roomType].publish = callback;\n\t}\n\n\tsetRoomFind(roomType, callback) {\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].roomFind != null) {\n\t\t\tthrow new Meteor.Error('room-find-exists', 'Room find for the given type already exists');\n\t\t}\n\t\tif (this.roomTypes[roomType] == null) {\n\t\t\tthis.roomTypes[roomType] = {};\n\t\t}\n\t\treturn this.roomTypes[roomType].roomFind = callback;\n\t}\n\n\tgetRoomFind(roomType) {\n\t\treturn this.roomTypes[roomType] && this.roomTypes[roomType].roomFind;\n\t}\n\n\n\t/**\n\t * Run the publish for a room type\n\t *\n\t * @param scope Meteor publish scope\n\t * @param {string} roomType room type (e.g.: c (for channels), d (for direct channels))\n\t * @param identifier identifier of the room\n\t*/\n\trunPublish(scope, roomType, identifier) {\n\t\treturn this.roomTypes[roomType] && this.roomTypes[roomType].publish && this.roomTypes[roomType].publish.call(scope, identifier);\n\t}\n\n};\n","import moment from 'moment';\nimport s from 'underscore.string';\n\nfunction getEmailContent({ messageContent, message, user, room }) {\n\tconst lng = user && user.language || RocketChat.settings.get('language') || 'en';\n\n\tconst roomName = `#${ RocketChat.settings.get('UI_Allow_room_names_with_special_chars') ? room.fname || room.name : room.name }`;\n\n\tconst userName = RocketChat.settings.get('UI_Use_Real_Name') ? message.u.name || message.u.username : message.u.username;\n\n\tconst header = TAPi18n.__(room.t === 'd' ? 'User_sent_a_message_to_you' : 'User_sent_a_message_on_channel', {\n\t\tusername: userName,\n\t\tchannel: roomName,\n\t\tlng\n\t});\n\n\tif (messageContent) {\n\t\treturn `${ header }<br/><br/>${ messageContent }`;\n\t}\n\n\tif (message.file) {\n\t\tconst fileHeader = TAPi18n.__(room.t === 'd' ? 'User_uploaded_a_file_to_you' : 'User_uploaded_a_file_on_channel', {\n\t\t\tusername: userName,\n\t\t\tchannel: roomName,\n\t\t\tlng\n\t\t});\n\n\t\tlet content = `${ TAPi18n.__('Attachment_File_Uploaded') }: ${ message.file.name }`;\n\n\t\tif (message.attachments && message.attachments.length === 1 && message.attachments[0].description !== '') {\n\t\t\tcontent += `<br/><br/>${ message.attachments[0].description }`;\n\t\t}\n\n\t\treturn `${ fileHeader }<br/><br/>${ content }`;\n\t}\n\n\tif (message.attachments.length > 0) {\n\t\tconst [ attachment ] = message.attachments;\n\n\t\tlet content = '';\n\n\t\tif (attachment.title) {\n\t\t\tcontent += `${ attachment.title }<br/>`;\n\t\t}\n\t\tif (attachment.text) {\n\t\t\tcontent += `${ attachment.text }<br/>`;\n\t\t}\n\n\t\treturn `${ header }<br/><br/>${ content }`;\n\t}\n\n\treturn header;\n}\n\nRocketChat.callbacks.add('afterSaveMessage', function(message, room) {\n\t// skips this callback if the message was edited\n\tif (message.editedAt) {\n\t\treturn message;\n\t}\n\n\tif (message.ts && Math.abs(moment(message.ts).diff()) > 60000) {\n\t\treturn message;\n\t}\n\n\tconst getMessageLink = (room, sub) => {\n\t\tconst roomPath = RocketChat.roomTypes.getRouteLink(room.t, sub);\n\t\tconst path = Meteor.absoluteUrl(roomPath ? roomPath.replace(/^\\//, '') : '');\n\t\tconst style = [\n\t\t\t'color: #fff;',\n\t\t\t'padding: 9px 12px;',\n\t\t\t'border-radius: 4px;',\n\t\t\t'background-color: #04436a;',\n\t\t\t'text-decoration: none;'\n\t\t].join(' ');\n\t\tconst message = TAPi18n.__('Offline_Link_Message');\n\t\treturn `<p style=\"text-align:center;margin-bottom:8px;\"><a style=\"${ style }\" href=\"${ path }\">${ message }</a>`;\n\t};\n\n\tconst divisorMessage = '<hr style=\"margin: 20px auto; border: none; border-bottom: 1px solid #dddddd;\">';\n\n\tlet messageHTML;\n\n\tif (message.msg !== '') {\n\t\tmessageHTML = s.escapeHTML(message.msg);\n\t\tmessage = RocketChat.callbacks.run('renderMessage', message);\n\t\tif (message.tokens && message.tokens.length > 0) {\n\t\t\tmessage.tokens.forEach((token) => {\n\t\t\t\ttoken.text = token.text.replace(/([^\\$])(\\$[^\\$])/gm, '$1$$$2');\n\t\t\t\tmessageHTML = messageHTML.replace(token.token, token.text);\n\t\t\t});\n\t\t}\n\t\tmessageHTML = messageHTML.replace(/\\n/gm, '<br/>');\n\t}\n\n\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\tlet footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\tconst usersToSendEmail = {};\n\tif (room.t === 'd') {\n\t\tusersToSendEmail[message.rid.replace(message.u._id, '')] = 'direct';\n\t} else {\n\t\tlet isMentionAll = message.mentions.find(mention => mention._id === 'all');\n\n\t\tif (isMentionAll) {\n\t\t\tconst maxMembersForNotification = RocketChat.settings.get('Notifications_Max_Room_Members');\n\t\t\tif (maxMembersForNotification !== 0 && room.usernames.length > maxMembersForNotification) {\n\t\t\t\tisMentionAll = undefined;\n\t\t\t}\n\t\t}\n\n\t\tlet query;\n\t\tif (isMentionAll) {\n\t\t\t// Query all users in room limited by the max room members setting\n\t\t\tquery = RocketChat.models.Subscriptions.findByRoomId(room._id);\n\t\t} else {\n\t\t\t// Query only mentioned users, will be always a few users\n\t\t\tconst userIds = message.mentions.map(mention => mention._id);\n\t\t\tquery = RocketChat.models.Subscriptions.findByRoomIdAndUserIdsOrAllMessages(room._id, userIds);\n\t\t}\n\n\t\tquery.forEach((sub) => {\n\t\t\tif (sub.disableNotifications) {\n\t\t\t\treturn delete usersToSendEmail[sub.u._id];\n\t\t\t}\n\n\t\t\tconst emailNotifications = sub.emailNotifications;\n\n\t\t\tif (emailNotifications === 'nothing') {\n\t\t\t\treturn delete usersToSendEmail[sub.u._id];\n\t\t\t}\n\n\t\t\tconst mentionedUser = isMentionAll || message.mentions.find(mention => mention._id === sub.u._id);\n\n\t\t\tif (emailNotifications === 'default' || emailNotifications == null) {\n\t\t\t\tif (mentionedUser) {\n\t\t\t\t\treturn usersToSendEmail[sub.u._id] = 'default';\n\t\t\t\t}\n\t\t\t\treturn delete usersToSendEmail[sub.u._id];\n\t\t\t}\n\n\t\t\tif (emailNotifications === 'mentions' && mentionedUser) {\n\t\t\t\treturn usersToSendEmail[sub.u._id] = 'mention';\n\t\t\t}\n\n\t\t\tif (emailNotifications === 'all') {\n\t\t\t\treturn usersToSendEmail[sub.u._id] = 'all';\n\t\t\t}\n\t\t});\n\t}\n\tconst userIdsToSendEmail = Object.keys(usersToSendEmail);\n\n\tlet defaultLink;\n\n\tconst linkByUser = {};\n\tif (RocketChat.roomTypes.hasCustomLink(room.t)) {\n\t\tRocketChat.models.Subscriptions.findByRoomIdAndUserIds(room._id, userIdsToSendEmail).forEach((sub) => {\n\t\t\tlinkByUser[sub.u._id] = getMessageLink(room, sub);\n\t\t});\n\t} else {\n\t\tdefaultLink = getMessageLink(room, {\n\t\t\tname: room.name\n\t\t});\n\t}\n\n\tif (userIdsToSendEmail.length > 0) {\n\t\tconst usersOfMention = RocketChat.models.Users.getUsersToSendOfflineEmail(userIdsToSendEmail).fetch();\n\n\t\tif (usersOfMention && usersOfMention.length > 0) {\n\t\t\tusersOfMention.forEach((user) => {\n\t\t\t\tconst emailNotificationMode = RocketChat.getUserPreference(user, 'emailNotificationMode');\n\t\t\t\tif (usersToSendEmail[user._id] === 'default') {\n\t\t\t\t\tif (emailNotificationMode === 'all') { //Mention/DM\n\t\t\t\t\t\tusersToSendEmail[user._id] = 'mention';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (usersToSendEmail[user._id] === 'direct') {\n\t\t\t\t\tconst userEmailPreferenceIsDisabled = emailNotificationMode === 'disabled';\n\t\t\t\t\tconst directMessageEmailPreference = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(message.rid, message.rid.replace(message.u._id, '')).emailNotifications;\n\n\t\t\t\t\tif (directMessageEmailPreference === 'nothing') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((directMessageEmailPreference === 'default' || directMessageEmailPreference == null) && userEmailPreferenceIsDisabled) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Checks if user is in the room he/she is mentioned (unless it's public channel)\n\t\t\t\tif (room.t !== 'c' && room.usernames.indexOf(user.username) === -1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Footer in case direct reply is enabled.\n\t\t\t\tif (RocketChat.settings.get('Direct_Reply_Enable')) {\n\t\t\t\t\tfooter = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer_Direct_Reply') || '');\n\t\t\t\t}\n\n\t\t\t\tlet emailSubject;\n\t\t\t\tconst username = RocketChat.settings.get('UI_Use_Real_Name') ? message.u.name : message.u.username;\n\t\t\t\tconst roomName = RocketChat.settings.get('UI_Allow_room_names_with_special_chars') ? room.fname : room.name;\n\t\t\t\tswitch (usersToSendEmail[user._id]) {\n\t\t\t\t\tcase 'all':\n\t\t\t\t\t\temailSubject = RocketChat.placeholders.replace(RocketChat.settings.get('Offline_Mention_All_Email'), {\n\t\t\t\t\t\t\tuser: username,\n\t\t\t\t\t\t\troom: roomName || room.label\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'direct':\n\t\t\t\t\t\temailSubject = RocketChat.placeholders.replace(RocketChat.settings.get('Offline_DM_Email'), {\n\t\t\t\t\t\t\tuser: username,\n\t\t\t\t\t\t\troom: roomName\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'mention':\n\t\t\t\t\t\temailSubject = RocketChat.placeholders.replace(RocketChat.settings.get('Offline_Mention_Email'), {\n\t\t\t\t\t\t\tuser: username,\n\t\t\t\t\t\t\troom: roomName\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tuser.emails.some((email) => {\n\t\t\t\t\tif (email.verified) {\n\t\t\t\t\t\tconst content = getEmailContent({\n\t\t\t\t\t\t\tmessageContent: messageHTML,\n\t\t\t\t\t\t\tmessage,\n\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\troom\n\t\t\t\t\t\t});\n\t\t\t\t\t\temail = {\n\t\t\t\t\t\t\tto: email.address,\n\t\t\t\t\t\t\tsubject: emailSubject,\n\t\t\t\t\t\t\thtml: header + content + divisorMessage + (linkByUser[user._id] || defaultLink) + footer\n\t\t\t\t\t\t};\n\t\t\t\t\t\t// using user full-name/channel name in from address\n\t\t\t\t\t\tif (room.t === 'd') {\n\t\t\t\t\t\t\temail.from = `${ message.u.name } <${ RocketChat.settings.get('From_Email') }>`;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\temail.from = `${ room.name } <${ RocketChat.settings.get('From_Email') }>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// If direct reply enabled, email content with headers\n\t\t\t\t\t\tif (RocketChat.settings.get('Direct_Reply_Enable')) {\n\t\t\t\t\t\t\temail.headers = {\n\t\t\t\t\t\t\t\t// Reply-To header with format \"username+messageId@domain\"\n\t\t\t\t\t\t\t\t'Reply-To': `${ RocketChat.settings.get('Direct_Reply_Username').split('@')[0].split(RocketChat.settings.get('Direct_Reply_Separator'))[0] }${ RocketChat.settings.get('Direct_Reply_Separator') }${ message._id }@${ RocketChat.settings.get('Direct_Reply_Username').split('@')[1] }`\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tMeteor.defer(() => {\n\t\t\t\t\t\t\tEmail.send(email);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\treturn message;\n\n}, RocketChat.callbacks.priority.LOW, 'sendEmailOnMessage');\n","/* globals Push */\nimport _ from 'underscore';\nimport s from 'underscore.string';\nimport moment from 'moment';\n\nconst CATEGORY_MESSAGE = 'MESSAGE';\nconst CATEGORY_MESSAGE_NOREPLY = 'MESSAGE_NOREPLY';\n\n/**\n * Replaces @username with full name\n *\n * @param {string} message The message to replace\n * @param {object[]} mentions Array of mentions used to make replacements\n *\n * @returns {string}\n */\nfunction replaceMentionedUsernamesWithFullNames(message, mentions) {\n\tif (!mentions || !mentions.length) {\n\t\treturn message;\n\t}\n\tmentions.forEach((mention) => {\n\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\tif (user && user.name) {\n\t\t\tmessage = message.replace(`@${ mention.username }`, user.name);\n\t\t}\n\t});\n\treturn message;\n}\n\nfunction canSendMessageToRoom(room, username) {\n\treturn !((room.muted || []).includes(username));\n}\n\n/**\n * This function returns a string ready to be shown in the notification\n *\n * @param {object} message the message to be parsed\n */\nfunction parseMessageText(message, userId) {\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\tconst lng = user && user.language || RocketChat.settings.get('language') || 'en';\n\n\tif (!message.msg && message.attachments && message.attachments[0]) {\n\t\tmessage.msg = message.attachments[0].image_type ? TAPi18n.__('User_uploaded_image', {lng}) : TAPi18n.__('User_uploaded_file', {lng});\n\t}\n\tmessage.msg = RocketChat.callbacks.run('beforeNotifyUser', message.msg);\n\n\treturn message.msg;\n}\n/**\n * Send notification to user\n *\n * @param {string} userId The user to notify\n * @param {object} user The sender\n * @param {object} room The room send from\n * @param {number} duration Duration of notification\n */\nfunction notifyDesktopUser(userId, user, message, room, duration) {\n\n\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\tmessage.msg = parseMessageText(message, userId);\n\n\tif (UI_Use_Real_Name) {\n\t\tmessage.msg = replaceMentionedUsernamesWithFullNames(message.msg, message.mentions);\n\t}\n\tlet title = UI_Use_Real_Name ? user.name : `@${ user.username }`;\n\tif (room.t !== 'd' && room.name) {\n\t\ttitle += ` @ #${ room.name }`;\n\t}\n\tRocketChat.Notifications.notifyUser(userId, 'notification', {\n\t\ttitle,\n\t\ttext: message.msg,\n\t\tduration,\n\t\tpayload: {\n\t\t\t_id: message._id,\n\t\t\trid: message.rid,\n\t\t\tsender: message.u,\n\t\t\ttype: room.t,\n\t\t\tname: room.name\n\t\t}\n\t});\n}\n\nfunction notifyAudioUser(userId, message, room) {\n\tRocketChat.Notifications.notifyUser(userId, 'audioNotification', {\n\t\tpayload: {\n\t\t\t_id: message._id,\n\t\t\trid: message.rid,\n\t\t\tsender: message.u,\n\t\t\ttype: room.t,\n\t\t\tname: room.name\n\t\t}\n\t});\n}\n\n/**\n * Checks if a message contains a user highlight\n *\n * @param {string} message\n * @param {array|undefined} highlights\n *\n * @returns {boolean}\n */\nfunction messageContainsHighlight(message, highlights) {\n\tif (! highlights || highlights.length === 0) { return false; }\n\n\tlet has = false;\n\thighlights.some(function(highlight) {\n\t\tconst regexp = new RegExp(s.escapeRegExp(highlight), 'i');\n\t\tif (regexp.test(message.msg)) {\n\t\t\thas = true;\n\t\t\treturn true;\n\t\t}\n\t});\n\n\treturn has;\n}\n\nfunction getBadgeCount(userId) {\n\tconst subscriptions = RocketChat.models.Subscriptions.findUnreadByUserId(userId).fetch();\n\n\treturn subscriptions.reduce((unread, sub) => {\n\t\treturn sub.unread + unread;\n\t}, 0);\n}\n\nconst sendPushNotifications = (userIdsToPushNotify = [], message, room, push_room, push_username, push_message, pushUsernames) => {\n\tif (userIdsToPushNotify.length > 0 && Push.enabled === true) {\n\t\t// send a push notification for each user individually (to get his/her badge count)\n\t\tuserIdsToPushNotify.forEach((userIdToNotify) => {\n\t\t\tRocketChat.PushNotification.send({\n\t\t\t\troomId: message.rid,\n\t\t\t\troomName: push_room,\n\t\t\t\tusername: push_username,\n\t\t\t\tmessage: push_message,\n\t\t\t\tbadge: getBadgeCount(userIdToNotify),\n\t\t\t\tpayload: {\n\t\t\t\t\thost: Meteor.absoluteUrl(),\n\t\t\t\t\trid: message.rid,\n\t\t\t\t\tsender: message.u,\n\t\t\t\t\ttype: room.t,\n\t\t\t\t\tname: room.name\n\t\t\t\t},\n\t\t\t\tusersTo: {\n\t\t\t\t\tuserId: userIdToNotify\n\t\t\t\t},\n\t\t\t\tcategory: canSendMessageToRoom(room, pushUsernames[userIdToNotify]) ? CATEGORY_MESSAGE : CATEGORY_MESSAGE_NOREPLY\n\t\t\t});\n\t\t});\n\t}\n};\n\nconst callJoin = (user, rid) => user.active && Meteor.runAsUser(user._id, () => Meteor.call('joinRoom', rid));\nRocketChat.callbacks.add('afterSaveMessage', function(message, room, userId) {\n\n\t// skips this callback if the message was edited\n\tif (message.editedAt) {\n\t\treturn message;\n\t}\n\n\tif (message.ts && Math.abs(moment(message.ts).diff()) > 60000) {\n\t\treturn message;\n\t}\n\n\tconst pushUsernames = {};\n\n\tconst user = RocketChat.models.Users.findOneById(message.u._id);\n\n\t/*\n\tIncrement unread couter if direct messages\n\t */\n\tconst settings = {\n\t\talwaysNotifyDesktopUsers: [],\n\t\tdontNotifyDesktopUsers: [],\n\t\talwaysNotifyMobileUsers: [],\n\t\tdontNotifyMobileUsers: [],\n\t\tdesktopNotificationDurations: {},\n\t\talwaysNotifyAudioUsers: [],\n\t\tdontNotifyAudioUsers: [],\n\t\taudioNotificationValues: {}\n\t};\n\n\t/**\n\t * Checks if a given user can be notified\n\t *\n\t * @param {string} id\n\t * @param {string} type - mobile|desktop\n\t *\n\t * @returns {boolean}\n     */\n\tfunction canBeNotified(id, type) {\n\t\tconst types = {\n\t\t\tdesktop: [ 'dontNotifyDesktopUsers', 'alwaysNotifyDesktopUsers' ],\n\t\t\tmobile: [ 'dontNotifyMobileUsers', 'alwaysNotifyMobileUsers' ],\n\t\t\taudio: [ 'dontNotifyAudioUsers', 'alwaysNotifyAudioUsers' ]\n\t\t};\n\n\t\treturn (settings[types[type][0]].indexOf(id) === -1 || settings[types[type][1]].indexOf(id) !== -1);\n\t}\n\n\t// Don't fetch all users if room exceeds max members\n\tconst maxMembersForNotification = RocketChat.settings.get('Notifications_Max_Room_Members');\n\tconst disableAllMessageNotifications = room.usernames.length > maxMembersForNotification && maxMembersForNotification !== 0;\n\tconst subscriptions = RocketChat.models.Subscriptions.findNotificationPreferencesByRoom(room._id, disableAllMessageNotifications);\n\tconst userIds = [];\n\tsubscriptions.forEach((s) => {\n\t\tuserIds.push(s.u._id);\n\t});\n\tconst users = {};\n\tRocketChat.models.Users.findUsersByIds(userIds, { fields: { 'settings.preferences': 1 } }).forEach((user) => {\n\t\tusers[user._id] = user;\n\t});\n\n\tsubscriptions.forEach(subscription => {\n\t\tif (subscription.disableNotifications) {\n\t\t\tsettings.dontNotifyDesktopUsers.push(subscription.u._id);\n\t\t\tsettings.dontNotifyMobileUsers.push(subscription.u._id);\n\t\t\tsettings.dontNotifyAudioUsers.push(subscription.u._id);\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\taudioNotifications = RocketChat.getUserPreference(users[subscription.u._id], 'audioNotifications'),\n\t\t\tdesktopNotifications = RocketChat.getUserPreference(users[subscription.u._id], 'desktopNotifications'),\n\t\t\tmobilePushNotifications = RocketChat.getUserPreference(users[subscription.u._id], 'mobileNotifications')\n\t\t} = subscription;\n\n\t\tif (audioNotifications === 'all' && !disableAllMessageNotifications) {\n\t\t\tsettings.alwaysNotifyAudioUsers.push(subscription.u._id);\n\t\t}\n\t\tif (desktopNotifications === 'all' && !disableAllMessageNotifications) {\n\t\t\tsettings.alwaysNotifyDesktopUsers.push(subscription.u._id);\n\t\t} else if (desktopNotifications === 'nothing') {\n\t\t\tsettings.dontNotifyDesktopUsers.push(subscription.u._id);\n\t\t}\n\t\tif (mobilePushNotifications === 'all' && !disableAllMessageNotifications) {\n\t\t\tsettings.alwaysNotifyMobileUsers.push(subscription.u._id);\n\t\t} else if (mobilePushNotifications === 'nothing') {\n\t\t\tsettings.dontNotifyMobileUsers.push(subscription.u._id);\n\t\t}\n\n\t\tsettings.audioNotificationValues[subscription.u._id] = subscription.audioNotificationValue;\n\t\tsettings.desktopNotificationDurations[subscription.u._id] = subscription.desktopNotificationDuration;\n\t});\n\tlet userIdsForAudio = [];\n\tlet userIdsToNotify = [];\n\tlet userIdsToPushNotify = [];\n\tconst mentions = [];\n\tconst alwaysNotifyMobileBoolean = RocketChat.settings.get('Notifications_Always_Notify_Mobile');\n\n\tconst usersWithHighlights = RocketChat.models.Users.findUsersByUsernamesWithHighlights(room.usernames, { fields: { '_id': 1, 'settings.preferences.highlights': 1 }}).fetch()\n\t\t.filter(user => messageContainsHighlight(message, user.settings.preferences.highlights));\n\n\tlet push_message = ' ';\n\t//Set variables depending on Push Notification settings\n\tif (RocketChat.settings.get('Push_show_message')) {\n\t\tpush_message = parseMessageText(message, userId);\n\t}\n\n\tlet push_username = '';\n\tlet push_room = '';\n\tif (RocketChat.settings.get('Push_show_username_room')) {\n\t\tpush_username = user.username;\n\t\tpush_room = `#${ room.name }`;\n\t}\n\n\tif (room.t == null || room.t === 'd') {\n\t\tconst userOfMentionId = message.rid.replace(message.u._id, '');\n\t\tconst userOfMention = RocketChat.models.Users.findOne({\n\t\t\t_id: userOfMentionId\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tstatusConnection: 1\n\t\t\t}\n\t\t});\n\n\t\t// Always notify Sandstorm\n\t\tif (userOfMention != null) {\n\t\t\tRocketChat.Sandstorm.notify(message, [userOfMention._id],\n\t\t\t\t`@${ user.username }: ${ message.msg }`, 'privateMessage');\n\n\t\t\tif (canBeNotified(userOfMentionId, 'desktop')) {\n\t\t\t\tconst duration = settings.desktopNotificationDurations[userOfMention._id];\n\t\t\t\tnotifyDesktopUser(userOfMention._id, user, message, room, duration);\n\t\t\t}\n\n\t\t\tif (canBeNotified(userOfMentionId, 'mobile')) {\n\t\t\t\tif (Push.enabled === true && (userOfMention.statusConnection !== 'online' || alwaysNotifyMobileBoolean === true)) {\n\t\t\t\t\tRocketChat.PushNotification.send({\n\t\t\t\t\t\troomId: message.rid,\n\t\t\t\t\t\tusername: push_username,\n\t\t\t\t\t\tmessage: push_message,\n\t\t\t\t\t\tbadge: getBadgeCount(userOfMention._id),\n\t\t\t\t\t\tpayload: {\n\t\t\t\t\t\t\thost: Meteor.absoluteUrl(),\n\t\t\t\t\t\t\trid: message.rid,\n\t\t\t\t\t\t\tsender: message.u,\n\t\t\t\t\t\t\ttype: room.t,\n\t\t\t\t\t\t\tname: room.name\n\t\t\t\t\t\t},\n\t\t\t\t\t\tusersTo: {\n\t\t\t\t\t\t\tuserId: userOfMention._id\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcategory: canSendMessageToRoom(room, userOfMention.username) ? CATEGORY_MESSAGE : CATEGORY_MESSAGE_NOREPLY\n\t\t\t\t\t});\n\t\t\t\t\treturn message;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t} else {\n\t\tconst mentionIds = (message.mentions || []).map(({_id}) => _id);\n\t\tconst toAll = mentionIds.includes('all');\n\t\tconst toHere = mentionIds.includes('here');\n\n\t\tif (mentionIds.length + settings.alwaysNotifyDesktopUsers.length > 0) {\n\t\t\tlet desktopMentionIds = _.union(mentionIds, settings.alwaysNotifyDesktopUsers);\n\t\t\tdesktopMentionIds = _.difference(desktopMentionIds, settings.dontNotifyDesktopUsers);\n\n\t\t\tlet usersOfDesktopMentions = RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: desktopMentionIds\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1,\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tactive: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\t\t\tmentions.push(...usersOfDesktopMentions);\n\t\t\tif (room.t !== 'c') {\n\t\t\t\tusersOfDesktopMentions = _.reject(usersOfDesktopMentions, (usersOfMentionItem) => {\n\t\t\t\t\treturn room.usernames.indexOf(usersOfMentionItem.username) === -1;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tuserIdsToNotify = _.pluck(usersOfDesktopMentions, '_id');\n\t\t}\n\n\t\tif (mentionIds.length + settings.alwaysNotifyMobileUsers.length > 0) {\n\t\t\tlet mobileMentionIds = _.union(mentionIds, settings.alwaysNotifyMobileUsers);\n\t\t\tmobileMentionIds = _.difference(mobileMentionIds, settings.dontNotifyMobileUsers);\n\n\t\t\tconst usersOfMobileMentionsQuery = {\n\t\t\t\t_id: {\n\t\t\t\t\t$in: mobileMentionIds\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (alwaysNotifyMobileBoolean !== true) {\n\t\t\t\tusersOfMobileMentionsQuery.statusConnection = { $ne: 'online' };\n\t\t\t}\n\n\t\t\tlet usersOfMobileMentions = RocketChat.models.Users.find(usersOfMobileMentionsQuery, {\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1,\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tstatusConnection: 1,\n\t\t\t\t\tactive: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\n\t\t\tmentions.push(...usersOfMobileMentions);\n\t\t\tif (room.t !== 'c') {\n\t\t\t\tusersOfMobileMentions = _.reject(usersOfMobileMentions, usersOfMentionItem => !room.usernames.includes(usersOfMentionItem.username));\n\t\t\t}\n\n\t\t\tuserIdsToPushNotify = usersOfMobileMentions.map(userMobile => {\n\t\t\t\tpushUsernames[userMobile._id] = userMobile.username;\n\t\t\t\treturn userMobile._id;\n\t\t\t});\n\t\t}\n\n\t\tif (mentionIds.length + settings.alwaysNotifyAudioUsers.length > 0) {\n\t\t\tlet audioMentionIds = _.union(mentionIds, settings.alwaysNotifyAudioUsers);\n\t\t\taudioMentionIds = _.difference(audioMentionIds, userIdsToNotify);\n\n\t\t\tlet usersOfAudioMentions = RocketChat.models.Users.find({ _id: { $in: audioMentionIds }, statusConnection: {\n\t\t\t\t$ne:'offline'\n\t\t\t} }, {\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1,\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tactive: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\t\t\tmentions.push(...usersOfAudioMentions);\n\t\t\tif (room.t !== 'c') {\n\t\t\t\tusersOfAudioMentions = _.reject(usersOfAudioMentions, (usersOfMentionItem) => {\n\t\t\t\t\treturn room.usernames.indexOf(usersOfMentionItem.username) === -1;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tuserIdsForAudio = _.pluck(usersOfAudioMentions, '_id');\n\t\t}\n\n\t\tif (room.t === 'c') {\n\t\t\tmentions.filter(user => !room.usernames.includes(user.username))\n\t\t\t\t.forEach(user =>callJoin(user, room._id));\n\t\t}\n\n\t\tif ([toAll, toHere].some(e => e) && room.usernames && room.usernames.length > 0) {\n\t\t\tRocketChat.models.Users.find({\n\t\t\t\tusername: { $in: room.usernames },\n\t\t\t\t_id: { $ne: user._id }\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1,\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tstatus: 1,\n\t\t\t\t\tstatusConnection: 1\n\t\t\t\t}\n\t\t\t}).forEach(function(user) {\n\t\t\t\tif (['online', 'away', 'busy'].includes(user.status) && !(settings.dontNotifyDesktopUsers || []).includes(user._id)) {\n\t\t\t\t\tuserIdsToNotify.push(user._id);\n\t\t\t\t\tuserIdsForAudio.push(user._id);\n\t\t\t\t}\n\t\t\t\tif (toAll && user.statusConnection !== 'online' && !(settings.dontNotifyMobileUsers || []).includes(user._id)) {\n\t\t\t\t\tpushUsernames[user._id] = user.username;\n\t\t\t\t\treturn userIdsToPushNotify.push(user._id);\n\t\t\t\t}\n\t\t\t\tif (toAll && user.statusConnection !== 'online') {\n\t\t\t\t\tuserIdsForAudio.push(user._id);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (usersWithHighlights.length > 0) {\n\t\t\tconst highlightsIds = _.pluck(usersWithHighlights, '_id');\n\t\t\tuserIdsForAudio = userIdsForAudio.concat(highlightsIds);\n\t\t\tuserIdsToNotify = userIdsToNotify.concat(highlightsIds);\n\t\t\tuserIdsToPushNotify = userIdsToPushNotify.concat(highlightsIds);\n\t\t}\n\n\t\tuserIdsToNotify = _.without(_.compact(_.unique(userIdsToNotify)), message.u._id);\n\t\tuserIdsToPushNotify = _.without(_.compact(_.unique(userIdsToPushNotify)), message.u._id);\n\t\tuserIdsForAudio = _.without(_.compact(_.unique(userIdsForAudio)), message.u._id);\n\n\t\tfor (const usersOfMentionId of userIdsToNotify) {\n\t\t\tconst duration = settings.desktopNotificationDurations[usersOfMentionId];\n\t\t\tnotifyDesktopUser(usersOfMentionId, user, message, room, duration);\n\t\t}\n\t\tfor (const usersOfMentionId of userIdsForAudio) {\n\t\t\tnotifyAudioUser(usersOfMentionId, message, room);\n\t\t}\n\t\tsendPushNotifications(userIdsToPushNotify, message, room, push_room, push_username, push_message, pushUsernames);\n\n\t\tconst allUserIdsToNotify = _.unique(userIdsToNotify.concat(userIdsToPushNotify));\n\t\tRocketChat.Sandstorm.notify(message, allUserIdsToNotify,\n\t\t\t`@${ user.username }: ${ message.msg }`, room.t === 'p' ? 'privateMessage' : 'message');\n\t}\n\n\treturn message;\n\n}, RocketChat.callbacks.priority.LOW, 'sendNotificationOnMessage');\n","import _ from 'underscore';\nconst dns = Npm.require('dns');\n\nlet emailDomainBlackList = [];\nlet emailDomainWhiteList = [];\nlet useDefaultBlackList = false;\nlet useDNSDomainCheck = false;\n\nRocketChat.settings.get('Accounts_BlockedDomainsList', function(key, value) {\n\temailDomainBlackList = _.map(value.split(','), (domain) => domain.trim());\n});\nRocketChat.settings.get('Accounts_AllowedDomainsList', function(key, value) {\n\temailDomainWhiteList = _.map(value.split(','), (domain) => domain.trim());\n});\nRocketChat.settings.get('Accounts_UseDefaultBlockedDomainsList', function(key, value) {\n\tuseDefaultBlackList = value;\n});\nRocketChat.settings.get('Accounts_UseDNSDomainCheck', function(key, value) {\n\tuseDNSDomainCheck = value;\n});\n\nRocketChat.validateEmailDomain = function(email) {\n\tconst emailValidation = /^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n\tif (!emailValidation.test(email)) {\n\t\tthrow new Meteor.Error('error-invalid-email', `Invalid email ${ email }`, { function: 'RocketChat.validateEmailDomain', email });\n\t}\n\n\tconst emailDomain = email.substr(email.lastIndexOf('@') + 1);\n\n\t// if not in whitelist\n\tif (emailDomainWhiteList.indexOf(emailDomain) === -1) {\n\t\tif (emailDomainBlackList.indexOf(emailDomain) !== -1 || (useDefaultBlackList && RocketChat.emailDomainDefaultBlackList.indexOf(emailDomain) !== -1)) {\n\t\t\tthrow new Meteor.Error('error-email-domain-blacklisted', 'The email domain is blacklisted', { function: 'RocketChat.validateEmailDomain' });\n\t\t}\n\t}\n\n\tif (useDNSDomainCheck) {\n\t\ttry {\n\t\t\tMeteor.wrapAsync(dns.resolveMx)(emailDomain);\n\t\t} catch (e) {\n\t\t\tthrow new Meteor.Error('error-invalid-domain', 'Invalid domain', { function: 'RocketChat.validateEmailDomain' });\n\t\t}\n\t}\n};\n","/*\n\tWhat is this file? Great question! To make Rocket.Chat more \"modular\"\n\tand to make the \"rocketchat:lib\" package more of a core package\n\twith the libraries, this index file contains the exported members\n\tfor the *server* pieces of code which does include the shared\n\tlibrary files.\n*/\n\nimport { RoomSettingsEnum, RoomTypeConfig, RoomTypeRouteConfig } from '../../lib/RoomTypeConfig';\n\nexport {\n\tRoomSettingsEnum,\n\tRoomTypeConfig,\n\tRoomTypeRouteConfig\n};\n","import fs from 'fs';\n\nfunction hasDockerEnv() {\n\ttry {\n\t\tfs.statSync('/.dockerenv');\n\t\treturn true;\n\t} catch (err) {\n\t\treturn false;\n\t}\n}\n\nfunction hasDockerCGroup() {\n\ttry {\n\t\treturn fs.readFileSync('/proc/self/cgroup', 'utf8').indexOf('docker') !== -1;\n\t} catch (err) {\n\t\treturn false;\n\t}\n}\n\nfunction check() {\n\treturn hasDockerEnv() || hasDockerCGroup();\n}\n\nlet isDocker;\nRocketChat.isDocker = function() {\n\tif (isDocker === undefined) {\n\t\tisDocker = check();\n\t}\n\n\treturn isDocker;\n};\n","RocketChat.addUserToDefaultChannels = function(user, silenced) {\n\tRocketChat.callbacks.run('beforeJoinDefaultChannels', user);\n\tconst defaultRooms = RocketChat.models.Rooms.findByDefaultAndTypes(true, ['c', 'p'], {fields: {usernames: 0}}).fetch();\n\tdefaultRooms.forEach((room) => {\n\n\t\t// put user in default rooms\n\t\tconst muted = room.ro && !RocketChat.authz.hasPermission(user._id, 'post-readonly');\n\t\tRocketChat.models.Rooms.addUsernameById(room._id, user.username, muted);\n\n\t\tif (!RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, user._id)) {\n\n\t\t\t// Add a subscription to this user\n\t\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\t\t\tts: new Date(),\n\t\t\t\topen: true,\n\t\t\t\talert: true,\n\t\t\t\tunread: 1,\n\t\t\t\tuserMentions: 1,\n\t\t\t\tgroupMentions: 0\n\t\t\t});\n\n\t\t\t// Insert user joined message\n\t\t\tif (!silenced) {\n\t\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(room._id, user);\n\t\t\t}\n\t\t}\n\t});\n};\n","RocketChat.addUserToRoom = function(rid, user, inviter, silenced) {\n\tconst now = new Date();\n\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t// Check if user is already in room\n\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\tif (subscription) {\n\t\treturn;\n\t}\n\n\tif (room.t === 'c' || room.t === 'p') {\n\t\tRocketChat.callbacks.run('beforeJoinRoom', user, room);\n\t}\n\n\tconst muted = room.ro && !RocketChat.authz.hasPermission(user._id, 'post-readonly');\n\tRocketChat.models.Rooms.addUsernameById(rid, user.username, muted);\n\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\tts: now,\n\t\topen: true,\n\t\talert: true,\n\t\tunread: 1,\n\t\tuserMentions: 1,\n\t\tgroupMentions: 0\n\t});\n\n\tif (!silenced) {\n\t\tif (inviter) {\n\t\t\tRocketChat.models.Messages.createUserAddedWithRoomIdAndUser(rid, user, {\n\t\t\t\tts: now,\n\t\t\t\tu: {\n\t\t\t\t\t_id: inviter._id,\n\t\t\t\t\tusername: inviter.username\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(rid, user, { ts: now });\n\t\t}\n\t}\n\n\tif (room.t === 'c' || room.t === 'p') {\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterJoinRoom', user, room);\n\t\t});\n\t}\n\n\treturn true;\n};\n","RocketChat.archiveRoom = function(rid) {\n\tRocketChat.models.Rooms.archiveById(rid);\n\tRocketChat.models.Subscriptions.archiveByRoomId(rid);\n\n\tRocketChat.callbacks.run('afterRoomArchived', RocketChat.models.Rooms.findOneById(rid), Meteor.user());\n};\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nRocketChat.checkUsernameAvailability = function(username) {\n\treturn RocketChat.settings.get('Accounts_BlockedUsernameList', function(key, value) {\n\t\tconst usernameBlackList = _.map(value.split(','), function(username) {\n\t\t\treturn username.trim();\n\t\t});\n\t\tif (usernameBlackList.length !== 0) {\n\t\t\tif (usernameBlackList.every(restrictedUsername => {\n\t\t\t\tconst regex = new RegExp(`^${ s.escapeRegExp(restrictedUsername) }$`, 'i');\n\t\t\t\treturn !regex.test(s.trim(s.escapeRegExp(username)));\n\t\t\t})) {\n\t\t\t\treturn !Meteor.users.findOne({\n\t\t\t\t\tusername: {\n\t\t\t\t\t\t$regex: new RegExp(`^${ s.trim(s.escapeRegExp(username)) }$`, 'i')\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t});\n};\n","import s from 'underscore.string';\n\nRocketChat.checkEmailAvailability = function(email) {\n\treturn !Meteor.users.findOne({ 'emails.address': { $regex : new RegExp(`^${ s.trim(s.escapeRegExp(email)) }$`, 'i') } });\n};\n","/* globals RocketChat */\nimport _ from 'underscore';\nimport s from 'underscore.string';\n\nRocketChat.createRoom = function(type, name, owner, members, readOnly, extraData={}) {\n\tname = s.trim(name);\n\towner = s.trim(owner);\n\tmembers = [].concat(members);\n\n\tif (!name) {\n\t\tthrow new Meteor.Error('error-invalid-name', 'Invalid name', { function: 'RocketChat.createRoom' });\n\t}\n\n\towner = RocketChat.models.Users.findOneByUsername(owner, { fields: { username: 1 }});\n\tif (!owner) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { function: 'RocketChat.createRoom' });\n\t}\n\n\tconst slugifiedRoomName = RocketChat.getValidRoomName(name);\n\n\tconst now = new Date();\n\tif (!_.contains(members, owner.username)) {\n\t\tmembers.push(owner.username);\n\t}\n\n\tif (type === 'c') {\n\t\tRocketChat.callbacks.run('beforeCreateChannel', owner, {\n\t\t\tt: 'c',\n\t\t\tname: slugifiedRoomName,\n\t\t\tfname: name,\n\t\t\tts: now,\n\t\t\tro: readOnly === true,\n\t\t\tsysMes: readOnly !== true,\n\t\t\tusernames: members,\n\t\t\tu: {\n\t\t\t\t_id: owner._id,\n\t\t\t\tusername: owner.username\n\t\t\t}\n\t\t});\n\t}\n\n\textraData = Object.assign({}, extraData, {\n\t\tts: now,\n\t\tro: readOnly === true,\n\t\tsysMes: readOnly !== true\n\t});\n\n\tconst room = RocketChat.models.Rooms.createWithTypeNameUserAndUsernames(type, slugifiedRoomName, name, owner, members, extraData);\n\n\tfor (const username of members) {\n\t\tconst member = RocketChat.models.Users.findOneByUsername(username, { fields: { username: 1 }});\n\t\tif (!member) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// make all room members muted by default, unless they have the post-readonly permission\n\t\tif (readOnly === true && !RocketChat.authz.hasPermission(member._id, 'post-readonly')) {\n\t\t\tRocketChat.models.Rooms.muteUsernameByRoomId(room._id, username);\n\t\t}\n\n\t\tconst extra = { open: true };\n\n\t\tif (username === owner.username) {\n\t\t\textra.ls = now;\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, member, extra);\n\t}\n\n\tRocketChat.authz.addUserRoles(owner._id, ['owner'], room._id);\n\n\tif (type === 'c') {\n\t\tMeteor.defer(() => {\n\t\t\tRocketChat.callbacks.run('afterCreateChannel', owner, room);\n\t\t});\n\t} else if (type === 'p') {\n\t\tMeteor.defer(() => {\n\t\t\tRocketChat.callbacks.run('afterCreatePrivateGroup', owner, room);\n\t\t});\n\t}\n\n\treturn {\n\t\trid: room._id,\n\t\tname: slugifiedRoomName\n\t};\n};\n","/* globals FileUpload */\nRocketChat.deleteMessage = function(message, user) {\n\tconst keepHistory = RocketChat.settings.get('Message_KeepHistory');\n\tconst showDeletedStatus = RocketChat.settings.get('Message_ShowDeletedStatus');\n\tlet deletedMsg;\n\n\tif (keepHistory) {\n\t\tif (showDeletedStatus) {\n\t\t\tRocketChat.models.Messages.cloneAndSaveAsHistoryById(message._id);\n\t\t} else {\n\t\t\tRocketChat.models.Messages.setHiddenById(message._id, true);\n\t\t}\n\n\t\tif (message.file && message.file._id) {\n\t\t\tRocketChat.models.Uploads.update(message.file._id, { $set: { _hidden: true } });\n\t\t}\n\t} else {\n\t\tif (!showDeletedStatus) {\n\t\t\tdeletedMsg = RocketChat.models.Messages.findOneById(message._id);\n\t\t\tRocketChat.models.Messages.removeById(message._id);\n\t\t}\n\n\t\tif (message.file && message.file._id) {\n\t\t\tFileUpload.getStore('Uploads').deleteById(message.file._id);\n\t\t}\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterDeleteMessage', deletedMsg);\n\t\t});\n\t}\n\n\t// update last message\n\tif (RocketChat.settings.get('Store_Last_Message')) {\n\t\tconst room = RocketChat.models.Rooms.findOneById(message.rid, { fields: { lastMessage: 1 } });\n\t\tif (!room.lastMessage || room.lastMessage._id === message._id) {\n\t\t\tconst lastMessage = RocketChat.models.Messages.getLastVisibleMessageSentWithNoTypeByRoomId(message.rid, message._id);\n\t\t\tRocketChat.models.Rooms.setLastMessageById(message.rid, lastMessage);\n\t\t}\n\t}\n\n\tif (showDeletedStatus) {\n\t\tRocketChat.models.Messages.setAsDeletedByIdAndUser(message._id, user);\n\t} else {\n\t\tRocketChat.Notifications.notifyRoom(message.rid, 'deleteMessage', { _id: message._id });\n\t}\n};\n","RocketChat.deleteUser = function(userId) {\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\tRocketChat.models.Messages.removeByUserId(userId); // Remove user messages\n\tRocketChat.models.Subscriptions.findByUserId(userId).forEach((subscription) => {\n\t\tconst room = RocketChat.models.Rooms.findOneById(subscription.rid);\n\t\tif (room) {\n\t\t\tif (room.t !== 'c' && room.usernames.length === 1) {\n\t\t\t\tRocketChat.models.Rooms.removeById(subscription.rid); // Remove non-channel rooms with only 1 user (the one being deleted)\n\t\t\t}\n\t\t\tif (room.t === 'd') {\n\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId(subscription.rid);\n\t\t\t\tRocketChat.models.Messages.removeByRoomId(subscription.rid);\n\t\t\t}\n\t\t}\n\t});\n\n\tRocketChat.models.Subscriptions.removeByUserId(userId); // Remove user subscriptions\n\tRocketChat.models.Rooms.removeByTypeContainingUsername('d', user.username); // Remove direct rooms with the user\n\tRocketChat.models.Rooms.removeUsernameFromAll(user.username); // Remove user from all other rooms\n\n\t// removes user's avatar\n\tif (user.avatarOrigin === 'upload' || user.avatarOrigin === 'url') {\n\t\tFileUpload.getStore('Avatars').deleteByName(user.username);\n\t}\n\n\tRocketChat.models.Integrations.disableByUserId(userId); // Disables all the integrations which rely on the user being deleted.\n\n\tRocketChat.models.Users.removeById(userId); // Remove user from users database\n};\n","/* globals RocketChat */\nimport _ from 'underscore';\nimport s from 'underscore.string';\n\nRocketChat.getFullUserData = function({userId, filter, limit}) {\n\tlet fields = {\n\t\tname: 1,\n\t\tusername: 1,\n\t\tstatus: 1,\n\t\tutcOffset: 1,\n\t\ttype: 1,\n\t\tactive: 1\n\t};\n\n\tif (RocketChat.authz.hasPermission(userId, 'view-full-other-user-info')) {\n\t\tfields = _.extend(fields, {\n\t\t\temails: 1,\n\t\t\tphone: 1,\n\t\t\tstatusConnection: 1,\n\t\t\tcreatedAt: 1,\n\t\t\tlastLogin: 1,\n\t\t\tservices: 1,\n\t\t\trequirePasswordChange: 1,\n\t\t\trequirePasswordChangeReason: 1,\n\t\t\troles: 1,\n\t\t\tcustomFields: 1\n\t\t});\n\t} else if (limit !== 0) {\n\t\tlimit = 1;\n\t}\n\n\tfilter = s.trim(filter);\n\n\tif (!filter && limit === 1) {\n\t\treturn undefined;\n\t}\n\n\tconst options = {\n\t\tfields,\n\t\tlimit,\n\t\tsort: { username: 1 }\n\t};\n\n\tif (filter) {\n\t\tif (limit === 1) {\n\t\t\treturn RocketChat.models.Users.findByUsername(filter, options);\n\t\t} else {\n\t\t\tconst filterReg = new RegExp(s.escapeRegExp(filter), 'i');\n\t\t\treturn RocketChat.models.Users.findByUsernameNameOrEmailAddress(filterReg, options);\n\t\t}\n\t}\n\n\treturn RocketChat.models.Users.find({}, options);\n};\n","/* globals RocketChat */\nimport _ from 'underscore';\n\nRocketChat.getRoomByNameOrIdWithOptionToJoin = function _getRoomByNameOrIdWithOptionToJoin({ currentUserId, nameOrId, type='', tryDirectByUserIdOnly=false, joinChannel=true, errorOnEmpty=true }) {\n\tlet room;\n\n\t//If the nameOrId starts with #, then let's try to find a channel or group\n\tif (nameOrId.startsWith('#')) {\n\t\tnameOrId = nameOrId.substring(1);\n\t\troom = RocketChat.models.Rooms.findOneByIdOrName(nameOrId);\n\t} else if (nameOrId.startsWith('@') || type === 'd') {\n\t\t//If the nameOrId starts with @ OR type is 'd', then let's try just a direct message\n\t\tnameOrId = nameOrId.replace('@', '');\n\n\t\tlet roomUser;\n\t\tif (tryDirectByUserIdOnly) {\n\t\t\troomUser = RocketChat.models.Users.findOneById(nameOrId);\n\t\t} else {\n\t\t\troomUser = RocketChat.models.Users.findOne({\n\t\t\t\t$or: [{ _id: nameOrId }, { username: nameOrId }]\n\t\t\t});\n\t\t}\n\n\t\tconst rid = _.isObject(roomUser) ? [currentUserId, roomUser._id].sort().join('') : nameOrId;\n\t\troom = RocketChat.models.Rooms.findOneById(rid);\n\n\t\t//If the room hasn't been found yet, let's try some more\n\t\tif (!_.isObject(room)) {\n\t\t\t//If the roomUser wasn't found, then there's no destination to point towards\n\t\t\t//so return out based upon errorOnEmpty\n\t\t\tif (!_.isObject(roomUser)) {\n\t\t\t\tif (errorOnEmpty) {\n\t\t\t\t\tthrow new Meteor.Error('invalid-channel');\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\troom = Meteor.runAsUser(currentUserId, function() {\n\t\t\t\tconst {rid} = Meteor.call('createDirectMessage', roomUser.username);\n\t\t\t\treturn RocketChat.models.Rooms.findOneById(rid);\n\t\t\t});\n\t\t}\n\t} else {\n\t\t//Otherwise, we'll treat this as a channel or group.\n\t\troom = RocketChat.models.Rooms.findOneByIdOrName(nameOrId);\n\t}\n\n\t//If no room was found, handle the room return based upon errorOnEmpty\n\tif (!room && errorOnEmpty) {\n\t\tthrow new Meteor.Error('invalid-channel');\n\t} else if (!room) {\n\t\treturn;\n\t}\n\n\t//If a room was found and they provided a type to search, then check\n\t//and if the type found isn't what we're looking for then handle\n\t//the return based upon errorOnEmpty\n\tif (type && room.t !== type) {\n\t\tif (errorOnEmpty) {\n\t\t\tthrow new Meteor.Error('invalid-channel');\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t}\n\n\t//If the room type is channel and joinChannel has been passed, try to join them\n\t//if they can't join the room, this will error out!\n\tif (room.t === 'c' && joinChannel) {\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, currentUserId);\n\n\t\tif (!sub) {\n\t\t\tMeteor.runAsUser(currentUserId, function() {\n\t\t\t\treturn Meteor.call('joinRoom', room._id);\n\t\t\t});\n\t\t}\n\t}\n\n\treturn room;\n};\n","RocketChat.removeUserFromRoom = function(rid, user) {\n\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\tif (room) {\n\t\tRocketChat.callbacks.run('beforeLeaveRoom', user, room);\n\t\tRocketChat.models.Rooms.removeUsernameById(rid, user.username);\n\n\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\tconst removedUser = user;\n\t\t\tRocketChat.models.Messages.createUserLeaveWithRoomIdAndUser(rid, removedUser);\n\t\t}\n\n\t\tif (room.t === 'l') {\n\t\t\tRocketChat.models.Messages.createCommandWithRoomIdAndUser('survey', rid, user);\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeByRoomIdAndUserId(rid, user._id);\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterLeaveRoom', user, room);\n\t\t});\n\t}\n};\n","/* globals Gravatar */\nimport _ from 'underscore';\nimport s from 'underscore.string';\n\nRocketChat.saveUser = function(userId, userData) {\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\tconst existingRoles = _.pluck(RocketChat.authz.getRoles(), '_id');\n\n\tif (userData._id && userId !== userData._id && !RocketChat.authz.hasPermission(userId, 'edit-other-user-info')) {\n\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing user is not allowed', { method: 'insertOrUpdateUser', action: 'Editing_user' });\n\t}\n\n\tif (!userData._id && !RocketChat.authz.hasPermission(userId, 'create-user')) {\n\t\tthrow new Meteor.Error('error-action-not-allowed', 'Adding user is not allowed', { method: 'insertOrUpdateUser', action: 'Adding_user' });\n\t}\n\n\tif (userData.roles && _.difference(userData.roles, existingRoles).length > 0) {\n\t\tthrow new Meteor.Error('error-action-not-allowed', 'The field Roles consist invalid role name', { method: 'insertOrUpdateUser', action: 'Assign_role' });\n\t}\n\n\tif (userData.roles && _.indexOf(userData.roles, 'admin') >= 0 && !RocketChat.authz.hasPermission(userId, 'assign-admin-role')) {\n\t\tthrow new Meteor.Error('error-action-not-allowed', 'Assigning admin is not allowed', { method: 'insertOrUpdateUser', action: 'Assign_admin' });\n\t}\n\n\tif (!userData._id && !s.trim(userData.name)) {\n\t\tthrow new Meteor.Error('error-the-field-is-required', 'The field Name is required', { method: 'insertOrUpdateUser', field: 'Name' });\n\t}\n\n\tif (!userData._id && !s.trim(userData.username)) {\n\t\tthrow new Meteor.Error('error-the-field-is-required', 'The field Username is required', { method: 'insertOrUpdateUser', field: 'Username' });\n\t}\n\n\tlet nameValidation;\n\n\ttry {\n\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t} catch (e) {\n\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t}\n\n\tif (userData.username && !nameValidation.test(userData.username)) {\n\t\tthrow new Meteor.Error('error-input-is-not-a-valid-field', `${ _.escape(userData.username) } is not a valid username`, { method: 'insertOrUpdateUser', input: userData.username, field: 'Username' });\n\t}\n\n\tif (!userData._id && !userData.password) {\n\t\tthrow new Meteor.Error('error-the-field-is-required', 'The field Password is required', { method: 'insertOrUpdateUser', field: 'Password' });\n\t}\n\n\tif (!userData._id) {\n\t\tif (!RocketChat.checkUsernameAvailability(userData.username)) {\n\t\t\tthrow new Meteor.Error('error-field-unavailable', `${ _.escape(userData.username) } is already in use :(`, { method: 'insertOrUpdateUser', field: userData.username });\n\t\t}\n\n\t\tif (userData.email && !RocketChat.checkEmailAvailability(userData.email)) {\n\t\t\tthrow new Meteor.Error('error-field-unavailable', `${ _.escape(userData.email) } is already in use :(`, { method: 'insertOrUpdateUser', field: userData.email });\n\t\t}\n\n\t\tRocketChat.validateEmailDomain(userData.email);\n\n\t\t// insert user\n\t\tconst createUser = {\n\t\t\tusername: userData.username,\n\t\t\tpassword: userData.password,\n\t\t\tjoinDefaultChannels: userData.joinDefaultChannels\n\t\t};\n\t\tif (userData.email) {\n\t\t\tcreateUser.email = userData.email;\n\t\t}\n\n\t\tconst _id = Accounts.createUser(createUser);\n\n\t\tconst updateUser = {\n\t\t\t$set: {\n\t\t\t\tname: userData.name,\n\t\t\t\troles: userData.roles || ['user']\n\t\t\t}\n\t\t};\n\n\t\tif (typeof userData.requirePasswordChange !== 'undefined') {\n\t\t\tupdateUser.$set.requirePasswordChange = userData.requirePasswordChange;\n\t\t}\n\n\t\tif (userData.verified) {\n\t\t\tupdateUser.$set['emails.0.verified'] = true;\n\t\t}\n\n\t\tMeteor.users.update({ _id }, updateUser);\n\n\t\tif (userData.sendWelcomeEmail) {\n\t\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\t\t\tlet subject;\n\t\t\tlet html;\n\n\t\t\tif (RocketChat.settings.get('Accounts_UserAddedEmail_Customized')) {\n\t\t\t\tsubject = RocketChat.settings.get('Accounts_UserAddedEmailSubject');\n\t\t\t\thtml = RocketChat.settings.get('Accounts_UserAddedEmail');\n\t\t\t} else {\n\t\t\t\tsubject = TAPi18n.__('Accounts_UserAddedEmailSubject_Default', { lng: user.language || RocketChat.settings.get('language') || 'en' });\n\t\t\t\thtml = TAPi18n.__('Accounts_UserAddedEmail_Default', { lng: user.language || RocketChat.settings.get('language') || 'en' });\n\t\t\t}\n\n\t\t\tsubject = RocketChat.placeholders.replace(subject);\n\t\t\thtml = RocketChat.placeholders.replace(html, {\n\t\t\t\tname: userData.name,\n\t\t\t\temail: userData.email,\n\t\t\t\tpassword: userData.password\n\t\t\t});\n\n\t\t\tconst email = {\n\t\t\t\tto: userData.email,\n\t\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\t\tsubject,\n\t\t\t\thtml: header + html + footer\n\t\t\t};\n\n\t\t\tMeteor.defer(function() {\n\t\t\t\ttry {\n\t\t\t\t\tEmail.send(email);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, { function: 'RocketChat.saveUser', message: error.message });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tuserData._id = _id;\n\n\t\tif (RocketChat.settings.get('Accounts_SetDefaultAvatar') === true && userData.email) {\n\t\t\tconst gravatarUrl = Gravatar.imageUrl(userData.email, {default: '404', size: 200, secure: true});\n\n\t\t\ttry {\n\t\t\t\tRocketChat.setUserAvatar(userData, gravatarUrl, '', 'url');\n\t\t\t} catch (e) {\n\t\t\t\t//Ignore this error for now, as it not being successful isn't bad\n\t\t\t}\n\t\t}\n\n\t\treturn _id;\n\t} else {\n\t\t// update user\n\t\tif (userData.username) {\n\t\t\tRocketChat.setUsername(userData._id, userData.username);\n\t\t}\n\n\t\tif (userData.name) {\n\t\t\tRocketChat.setRealName(userData._id, userData.name);\n\t\t}\n\n\t\tif (userData.email) {\n\t\t\tRocketChat.setEmail(userData._id, userData.email);\n\t\t}\n\n\t\tif (userData.password && userData.password.trim() && RocketChat.authz.hasPermission(userId, 'edit-other-user-password')) {\n\t\t\tAccounts.setPassword(userData._id, userData.password.trim());\n\t\t}\n\n\t\tconst updateUser = {\n\t\t\t$set: {}\n\t\t};\n\n\t\tif (userData.roles) {\n\t\t\tupdateUser.$set.roles = userData.roles;\n\t\t}\n\n\t\tif (typeof userData.requirePasswordChange !== 'undefined') {\n\t\t\tupdateUser.$set.requirePasswordChange = userData.requirePasswordChange;\n\t\t}\n\n\t\tif (userData.verified) {\n\t\t\tupdateUser.$set['emails.0.verified'] = userData.verified;\n\t\t}\n\n\t\tMeteor.users.update({ _id: userData._id }, updateUser);\n\n\t\treturn true;\n\t}\n};\n","import s from 'underscore.string';\n\nRocketChat.saveCustomFields = function(userId, formData) {\n\tif (s.trim(RocketChat.settings.get('Accounts_CustomFields')) !== '') {\n\t\tRocketChat.validateCustomFields(formData);\n\t\treturn RocketChat.saveCustomFieldsWithoutValidation(userId, formData);\n\t}\n};\n","import s from 'underscore.string';\n\nRocketChat.saveCustomFieldsWithoutValidation = function(userId, formData) {\n\tif (s.trim(RocketChat.settings.get('Accounts_CustomFields')) !== '') {\n\t\tlet customFieldsMeta;\n\t\ttry {\n\t\t\tcustomFieldsMeta = JSON.parse(RocketChat.settings.get('Accounts_CustomFields'));\n\t\t} catch (e) {\n\t\t\tthrow new Meteor.Error('error-invalid-customfield-json', 'Invalid JSON for Custom Fields');\n\t\t}\n\n\t\tconst customFields = {};\n\t\tObject.keys(customFieldsMeta).forEach(key => customFields[key] = formData[key]);\n\t\tRocketChat.models.Users.setCustomFields(userId, customFields);\n\n\t\tObject.keys(customFields).forEach((fieldName) => {\n\t\t\tif (!customFieldsMeta[fieldName].modifyRecordField) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst modifyRecordField = customFieldsMeta[fieldName].modifyRecordField;\n\t\t\tconst update = {};\n\t\t\tif (modifyRecordField.array) {\n\t\t\t\tupdate.$addToSet = {};\n\t\t\t\tupdate.$addToSet[modifyRecordField.field] = customFields[fieldName];\n\t\t\t} else {\n\t\t\t\tupdate.$set = {};\n\t\t\t\tupdate.$set[modifyRecordField.field] = customFields[fieldName];\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.update(userId, update);\n\t\t});\n\t}\n};\n","import _ from 'underscore';\n\nRocketChat.sendMessage = function(user, message, room, upsert = false) {\n\tif (!user || !message || !room._id) {\n\t\treturn false;\n\t}\n\tif (message.ts == null) {\n\t\tmessage.ts = new Date();\n\t}\n\tmessage.u = _.pick(user, ['_id', 'username', 'name']);\n\tif (!Match.test(message.msg, String)) {\n\t\tmessage.msg = '';\n\t}\n\tmessage.rid = room._id;\n\tif (!room.usernames || room.usernames.length === 0) {\n\t\tconst updated_room = RocketChat.models.Rooms.findOneById(room._id);\n\t\tif (updated_room != null) {\n\t\t\troom = updated_room;\n\t\t} else {\n\t\t\troom.usernames = [];\n\t\t}\n\t}\n\tif (message.parseUrls !== false) {\n\t\tconst urls = message.msg.match(/([A-Za-z]{3,9}):\\/\\/([-;:&=\\+\\$,\\w]+@{1})?([-A-Za-z0-9\\.]+)+:?(\\d+)?((\\/[-\\+=!:~%\\/\\.@\\,\\(\\)\\w]*)?\\??([-\\+=&!:;%@\\/\\.\\,\\w]+)?(?:#([^\\s\\)]+))?)?/g);\n\n\t\tif (urls) {\n\t\t\tmessage.urls = urls.map(function(url) {\n\t\t\t\treturn {\n\t\t\t\t\turl\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t}\n\tmessage = RocketChat.callbacks.run('beforeSaveMessage', message);\n\tif (message) {\n\t\t// Avoid saving sandstormSessionId to the database\n\t\tlet sandstormSessionId = null;\n\t\tif (message.sandstormSessionId) {\n\t\t\tsandstormSessionId = message.sandstormSessionId;\n\t\t\tdelete message.sandstormSessionId;\n\t\t}\n\t\tif (message._id && upsert) {\n\t\t\tconst _id = message._id;\n\t\t\tdelete message._id;\n\t\t\tRocketChat.models.Messages.upsert({\n\t\t\t\t_id,\n\t\t\t\t'u._id': message.u._id\n\t\t\t}, message);\n\t\t\tmessage._id = _id;\n\t\t} else {\n\t\t\tmessage._id = RocketChat.models.Messages.insert(message);\n\t\t}\n\n\t\t/*\n\t\tDefer other updates as their return is not interesting to the user\n\t\t*/\n\t\tMeteor.defer(() => {\n\t\t\t// Execute all callbacks\n\t\t\tmessage.sandstormSessionId = sandstormSessionId;\n\t\t\treturn RocketChat.callbacks.run('afterSaveMessage', message, room, user._id);\n\t\t});\n\t\treturn message;\n\t}\n};\n","import _ from 'underscore';\n\nconst blockedSettings = {};\n\nif (process.env.SETTINGS_BLOCKED) {\n\tprocess.env.SETTINGS_BLOCKED.split(',').forEach((settingId) => blockedSettings[settingId] = 1);\n}\n\nconst hiddenSettings = {};\nif (process.env.SETTINGS_HIDDEN) {\n\tprocess.env.SETTINGS_HIDDEN.split(',').forEach((settingId) => hiddenSettings[settingId] = 1);\n}\n\nRocketChat.settings._sorter = {};\n\n\n/*\n* Add a setting\n* @param {String} _id\n* @param {Mixed} value\n* @param {Object} setting\n*/\n\nRocketChat.settings.add = function(_id, value, options = {}) {\n\tif (options == null) {\n\t\toptions = {};\n\t}\n\tif (!_id || value == null) {\n\t\treturn false;\n\t}\n\tif (RocketChat.settings._sorter[options.group] == null) {\n\t\tRocketChat.settings._sorter[options.group] = 0;\n\t}\n\toptions.packageValue = value;\n\toptions.valueSource = 'packageValue';\n\toptions.hidden = options.hidden || false;\n\toptions.blocked = options.blocked || false;\n\tif (options.sorter == null) {\n\t\toptions.sorter = RocketChat.settings._sorter[options.group]++;\n\t}\n\tif (options.enableQuery != null) {\n\t\toptions.enableQuery = JSON.stringify(options.enableQuery);\n\t}\n\tif (options.i18nDefaultQuery != null) {\n\t\toptions.i18nDefaultQuery = JSON.stringify(options.i18nDefaultQuery);\n\t}\n\tif (typeof process !== 'undefined' && process.env && process.env[_id]) {\n\t\tvalue = process.env[_id];\n\t\tif (value.toLowerCase() === 'true') {\n\t\t\tvalue = true;\n\t\t} else if (value.toLowerCase() === 'false') {\n\t\t\tvalue = false;\n\t\t}\n\t\toptions.processEnvValue = value;\n\t\toptions.valueSource = 'processEnvValue';\n\t} else if (Meteor.settings && typeof Meteor.settings[_id] !== 'undefined') {\n\t\tif (Meteor.settings[_id] == null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvalue = Meteor.settings[_id];\n\t\toptions.meteorSettingsValue = value;\n\t\toptions.valueSource = 'meteorSettingsValue';\n\t}\n\tif (options.i18nLabel == null) {\n\t\toptions.i18nLabel = _id;\n\t}\n\tif (options.i18nDescription == null) {\n\t\toptions.i18nDescription = `${ _id }_Description`;\n\t}\n\tif (blockedSettings[_id] != null) {\n\t\toptions.blocked = true;\n\t}\n\tif (hiddenSettings[_id] != null) {\n\t\toptions.hidden = true;\n\t}\n\tif (typeof process !== 'undefined' && process.env && process.env[`OVERWRITE_SETTING_${ _id }`]) {\n\t\tlet value = process.env[`OVERWRITE_SETTING_${ _id }`];\n\t\tif (value.toLowerCase() === 'true') {\n\t\t\tvalue = true;\n\t\t} else if (value.toLowerCase() === 'false') {\n\t\t\tvalue = false;\n\t\t}\n\t\toptions.value = value;\n\t\toptions.processEnvValue = value;\n\t\toptions.valueSource = 'processEnvValue';\n\t}\n\tconst updateOperations = {\n\t\t$set: options,\n\t\t$setOnInsert: {\n\t\t\tcreatedAt: new Date\n\t\t}\n\t};\n\tif (options.editor != null) {\n\t\tupdateOperations.$setOnInsert.editor = options.editor;\n\t\tdelete options.editor;\n\t}\n\tif (options.value == null) {\n\t\tif (options.force === true) {\n\t\t\tupdateOperations.$set.value = options.packageValue;\n\t\t} else {\n\t\t\tupdateOperations.$setOnInsert.value = value;\n\t\t}\n\t}\n\tconst query = _.extend({\n\t\t_id\n\t}, updateOperations.$set);\n\tif (options.section == null) {\n\t\tupdateOperations.$unset = {\n\t\t\tsection: 1\n\t\t};\n\t\tquery.section = {\n\t\t\t$exists: false\n\t\t};\n\t}\n\tconst existantSetting = RocketChat.models.Settings.db.findOne(query);\n\tif (existantSetting != null) {\n\t\tif (existantSetting.editor == null && updateOperations.$setOnInsert.editor != null) {\n\t\t\tupdateOperations.$set.editor = updateOperations.$setOnInsert.editor;\n\t\t\tdelete updateOperations.$setOnInsert.editor;\n\t\t}\n\t} else {\n\t\tupdateOperations.$set.ts = new Date;\n\t}\n\treturn RocketChat.models.Settings.upsert({\n\t\t_id\n\t}, updateOperations);\n};\n\n\n/*\n* Add a setting group\n* @param {String} _id\n*/\n\nRocketChat.settings.addGroup = function(_id, options = {}, cb) {\n\tif (!_id) {\n\t\treturn false;\n\t}\n\tif (_.isFunction(options)) {\n\t\tcb = options;\n\t\toptions = {};\n\t}\n\tif (options.i18nLabel == null) {\n\t\toptions.i18nLabel = _id;\n\t}\n\tif (options.i18nDescription == null) {\n\t\toptions.i18nDescription = `${ _id }_Description`;\n\t}\n\toptions.ts = new Date;\n\toptions.blocked = false;\n\toptions.hidden = false;\n\tif (blockedSettings[_id] != null) {\n\t\toptions.blocked = true;\n\t}\n\tif (hiddenSettings[_id] != null) {\n\t\toptions.hidden = true;\n\t}\n\tRocketChat.models.Settings.upsert({\n\t\t_id\n\t}, {\n\t\t$set: options,\n\t\t$setOnInsert: {\n\t\t\ttype: 'group',\n\t\t\tcreatedAt: new Date\n\t\t}\n\t});\n\tif (cb != null) {\n\t\tcb.call({\n\t\t\tadd(id, value, options) {\n\t\t\t\tif (options == null) {\n\t\t\t\t\toptions = {};\n\t\t\t\t}\n\t\t\t\toptions.group = _id;\n\t\t\t\treturn RocketChat.settings.add(id, value, options);\n\t\t\t},\n\t\t\tsection(section, cb) {\n\t\t\t\treturn cb.call({\n\t\t\t\t\tadd(id, value, options) {\n\t\t\t\t\t\tif (options == null) {\n\t\t\t\t\t\t\toptions = {};\n\t\t\t\t\t\t}\n\t\t\t\t\t\toptions.group = _id;\n\t\t\t\t\t\toptions.section = section;\n\t\t\t\t\t\treturn RocketChat.settings.add(id, value, options);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n};\n\n\n/*\n* Remove a setting by id\n* @param {String} _id\n*/\n\nRocketChat.settings.removeById = function(_id) {\n\tif (!_id) {\n\t\treturn false;\n\t}\n\treturn RocketChat.models.Settings.removeById(_id);\n};\n\n\n/*\n* Update a setting by id\n* @param {String} _id\n*/\n\nRocketChat.settings.updateById = function(_id, value, editor) {\n\tif (!_id || value == null) {\n\t\treturn false;\n\t}\n\tif (editor != null) {\n\t\treturn RocketChat.models.Settings.updateValueAndEditorById(_id, value, editor);\n\t}\n\treturn RocketChat.models.Settings.updateValueById(_id, value);\n};\n\n\n/*\n* Update options of a setting by id\n* @param {String} _id\n*/\n\nRocketChat.settings.updateOptionsById = function(_id, options) {\n\tif (!_id || options == null) {\n\t\treturn false;\n\t}\n\treturn RocketChat.models.Settings.updateOptionsById(_id, options);\n};\n\n\n/*\n* Update a setting by id\n* @param {String} _id\n*/\n\nRocketChat.settings.clearById = function(_id) {\n\tif (_id == null) {\n\t\treturn false;\n\t}\n\treturn RocketChat.models.Settings.updateValueById(_id, undefined);\n};\n\n\n/*\n* Update a setting by id\n*/\n\nRocketChat.settings.init = function() {\n\tRocketChat.settings.initialLoad = true;\n\tRocketChat.models.Settings.find().observe({\n\t\tadded(record) {\n\t\t\tMeteor.settings[record._id] = record.value;\n\t\t\tif (record.env === true) {\n\t\t\t\tprocess.env[record._id] = record.value;\n\t\t\t}\n\t\t\treturn RocketChat.settings.load(record._id, record.value, RocketChat.settings.initialLoad);\n\t\t},\n\t\tchanged(record) {\n\t\t\tMeteor.settings[record._id] = record.value;\n\t\t\tif (record.env === true) {\n\t\t\t\tprocess.env[record._id] = record.value;\n\t\t\t}\n\t\t\treturn RocketChat.settings.load(record._id, record.value, RocketChat.settings.initialLoad);\n\t\t},\n\t\tremoved(record) {\n\t\t\tdelete Meteor.settings[record._id];\n\t\t\tif (record.env === true) {\n\t\t\t\tdelete process.env[record._id];\n\t\t\t}\n\t\t\treturn RocketChat.settings.load(record._id, undefined, RocketChat.settings.initialLoad);\n\t\t}\n\t});\n\tRocketChat.settings.initialLoad = false;\n\tRocketChat.settings.afterInitialLoad.forEach(fn => fn(Meteor.settings));\n};\n\nRocketChat.settings.afterInitialLoad = [];\n\nRocketChat.settings.onAfterInitialLoad = function(fn) {\n\tRocketChat.settings.afterInitialLoad.push(fn);\n\tif (RocketChat.settings.initialLoad === false) {\n\t\treturn fn(Meteor.settings);\n\t}\n};\n","RocketChat.setUserAvatar = function(user, dataURI, contentType, service) {\n\tlet encoding;\n\tlet image;\n\n\tif (service === 'initials') {\n\t\treturn RocketChat.models.Users.setAvatarOrigin(user._id, service);\n\t} else if (service === 'url') {\n\t\tlet result = null;\n\n\t\ttry {\n\t\t\tresult = HTTP.get(dataURI, { npmRequestOptions: {encoding: 'binary'} });\n\t\t} catch (error) {\n\t\t\tif (!error.response || error.response.statusCode !== 404) {\n\t\t\t\tconsole.log(`Error while handling the setting of the avatar from a url (${ dataURI }) for ${ user.username }:`, error);\n\t\t\t\tthrow new Meteor.Error('error-avatar-url-handling', `Error while handling avatar setting from a URL (${ dataURI }) for ${ user.username }`, { function: 'RocketChat.setUserAvatar', url: dataURI, username: user.username });\n\t\t\t}\n\t\t}\n\n\t\tif (result.statusCode !== 200) {\n\t\t\tconsole.log(`Not a valid response, ${ result.statusCode }, from the avatar url: ${ dataURI }`);\n\t\t\tthrow new Meteor.Error('error-avatar-invalid-url', `Invalid avatar URL: ${ dataURI }`, { function: 'RocketChat.setUserAvatar', url: dataURI });\n\t\t}\n\n\t\tif (!/image\\/.+/.test(result.headers['content-type'])) {\n\t\t\tconsole.log(`Not a valid content-type from the provided url, ${ result.headers['content-type'] }, from the avatar url: ${ dataURI }`);\n\t\t\tthrow new Meteor.Error('error-avatar-invalid-url', `Invalid avatar URL: ${ dataURI }`, { function: 'RocketChat.setUserAvatar', url: dataURI });\n\t\t}\n\n\t\tencoding = 'binary';\n\t\timage = result.content;\n\t\tcontentType = result.headers['content-type'];\n\t} else if (service === 'rest') {\n\t\tencoding = 'binary';\n\t\timage = dataURI;\n\t} else {\n\t\tconst fileData = RocketChatFile.dataURIParse(dataURI);\n\t\tencoding = 'base64';\n\t\timage = fileData.image;\n\t\tcontentType = fileData.contentType;\n\t}\n\n\tconst buffer = new Buffer(image, encoding);\n\tconst fileStore = FileUpload.getStore('Avatars');\n\tfileStore.deleteByName(user.username);\n\n\tconst file = {\n\t\tuserId: user._id,\n\t\ttype: contentType,\n\t\tsize: buffer.length\n\t};\n\n\tfileStore.insert(file, buffer, () => {\n\t\tMeteor.setTimeout(function() {\n\t\t\tRocketChat.models.Users.setAvatarOrigin(user._id, service);\n\t\t\tRocketChat.Notifications.notifyLogged('updateAvatar', {username: user.username});\n\t\t}, 500);\n\t});\n};\n","import s from 'underscore.string';\n\nRocketChat._setUsername = function(userId, u) {\n\tconst username = s.trim(u);\n\tif (!userId || !username) {\n\t\treturn false;\n\t}\n\tlet nameValidation;\n\ttry {\n\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t} catch (error) {\n\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t}\n\tif (!nameValidation.test(username)) {\n\t\treturn false;\n\t}\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\t// User already has desired username, return\n\tif (user.username === username) {\n\t\treturn user;\n\t}\n\tconst previousUsername = user.username;\n\t// Check username availability or if the user already owns a different casing of the name\n\tif (!previousUsername || !(username.toLowerCase() === previousUsername.toLowerCase())) {\n\t\tif (!RocketChat.checkUsernameAvailability(username)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\t//If first time setting username, send Enrollment Email\n\ttry {\n\t\tif (!previousUsername && user.emails && user.emails.length > 0 && RocketChat.settings.get('Accounts_Enrollment_Email')) {\n\t\t\tAccounts.sendEnrollmentEmail(user._id);\n\t\t}\n\t} catch (e) {\n\t\tconsole.error(e);\n\t}\n\t/* globals getAvatarSuggestionForUser */\n\tuser.username = username;\n\tif (!previousUsername && RocketChat.settings.get('Accounts_SetDefaultAvatar') === true) {\n\t\tconst avatarSuggestions = getAvatarSuggestionForUser(user);\n\t\tlet gravatar;\n\t\tObject.keys(avatarSuggestions).some(service => {\n\t\t\tconst avatarData = avatarSuggestions[service];\n\t\t\tif (service !== 'gravatar') {\n\t\t\t\tRocketChat.setUserAvatar(user, avatarData.blob, avatarData.contentType, service);\n\t\t\t\tgravatar = null;\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tgravatar = avatarData;\n\t\t\t}\n\t\t});\n\t\tif (gravatar != null) {\n\t\t\tRocketChat.setUserAvatar(user, gravatar.blob, gravatar.contentType, 'gravatar');\n\t\t}\n\t}\n\t// Username is available; if coming from old username, update all references\n\tif (previousUsername) {\n\t\tRocketChat.models.Messages.updateAllUsernamesByUserId(user._id, username);\n\t\tRocketChat.models.Messages.updateUsernameOfEditByUserId(user._id, username);\n\t\tRocketChat.models.Messages.findByMention(previousUsername).forEach(function(msg) {\n\t\t\tconst updatedMsg = msg.msg.replace(new RegExp(`@${ previousUsername }`, 'ig'), `@${ username }`);\n\t\t\treturn RocketChat.models.Messages.updateUsernameAndMessageOfMentionByIdAndOldUsername(msg._id, previousUsername, username, updatedMsg);\n\t\t});\n\t\tRocketChat.models.Rooms.replaceUsername(previousUsername, username);\n\t\tRocketChat.models.Rooms.replaceMutedUsername(previousUsername, username);\n\t\tRocketChat.models.Rooms.replaceUsernameOfUserByUserId(user._id, username);\n\t\tRocketChat.models.Subscriptions.setUserUsernameByUserId(user._id, username);\n\t\tRocketChat.models.Subscriptions.setNameForDirectRoomsWithOldName(previousUsername, username);\n\n\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\tconst file = fileStore.model.findOneByName(previousUsername);\n\t\tif (file) {\n\t\t\tfileStore.model.updateFileNameById(file._id, username);\n\t\t}\n\t}\n\t// Set new username*\n\tRocketChat.models.Users.setUsername(user._id, username);\n\treturn user;\n};\n\nRocketChat.setUsername = RocketChat.RateLimiter.limitFunction(RocketChat._setUsername, 1, 60000, {\n\t[0](userId) {\n\t\treturn !userId || !RocketChat.authz.hasPermission(userId, 'edit-other-user-info');\n\t}\n});\n","import s from 'underscore.string';\n\nRocketChat._setRealName = function(userId, name) {\n\tname = s.trim(name);\n\tif (!userId || !name) {\n\t\treturn false;\n\t}\n\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t// User already has desired name, return\n\tif (user.name === name) {\n\t\treturn user;\n\t}\n\n\t// Set new name\n\tRocketChat.models.Users.setName(user._id, name);\n\tuser.name = name;\n\n\tif (RocketChat.settings.get('UI_Use_Real_Name') === true) {\n\t\tRocketChat.Notifications.notifyLogged('Users:NameChanged', {\n\t\t\t_id: user._id,\n\t\t\tname: user.name,\n\t\t\tusername: user.username\n\t\t});\n\t}\n\n\treturn user;\n};\n\nRocketChat.setRealName = RocketChat.RateLimiter.limitFunction(RocketChat._setRealName, 1, 60000, {\n\t0() { return !Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-info'); } // Administrators have permission to change others names, so don't limit those\n});\n","import s from 'underscore.string';\n\nRocketChat._setEmail = function(userId, email) {\n\temail = s.trim(email);\n\tif (!userId) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { function: '_setEmail' });\n\t}\n\n\tif (!email) {\n\t\tthrow new Meteor.Error('error-invalid-email', 'Invalid email', { function: '_setEmail' });\n\t}\n\n\tRocketChat.validateEmailDomain(email);\n\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t// User already has desired username, return\n\tif (user.emails && user.emails[0] && user.emails[0].address === email) {\n\t\treturn user;\n\t}\n\n\t// Check email availability\n\tif (!RocketChat.checkEmailAvailability(email)) {\n\t\tthrow new Meteor.Error('error-field-unavailable', `${ email } is already in use :(`, { function: '_setEmail', field: email });\n\t}\n\n\t// Set new email\n\tRocketChat.models.Users.setEmail(user._id, email);\n\tuser.email = email;\n\treturn user;\n};\n\nRocketChat.setEmail = RocketChat.RateLimiter.limitFunction(RocketChat._setEmail, 1, 60000, {\n\t0() { return !Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-info'); } // Administrators have permission to change others emails, so don't limit those\n});\n","RocketChat.unarchiveRoom = function(rid) {\n\tRocketChat.models.Rooms.unarchiveById(rid);\n\tRocketChat.models.Subscriptions.unarchiveByRoomId(rid);\n};\n","RocketChat.updateMessage = function(message, user) {\n\t// If we keep history of edits, insert a new message to store history information\n\tif (RocketChat.settings.get('Message_KeepHistory')) {\n\t\tRocketChat.models.Messages.cloneAndSaveAsHistoryById(message._id);\n\t}\n\n\tmessage.editedAt = new Date();\n\tmessage.editedBy = {\n\t\t_id: user._id,\n\t\tusername: user.username\n\t};\n\n\tconst urls = message.msg.match(/([A-Za-z]{3,9}):\\/\\/([-;:&=\\+\\$,\\w]+@{1})?([-A-Za-z0-9\\.]+)+:?(\\d+)?((\\/[-\\+=!:~%\\/\\.@\\,\\w]*)?\\??([-\\+=&!:;%@\\/\\.\\,\\w]+)?(?:#([^\\s\\)]+))?)?/g);\n\tif (urls) {\n\t\tmessage.urls = urls.map((url) => { return { url }; });\n\t}\n\n\tmessage = RocketChat.callbacks.run('beforeSaveMessage', message);\n\n\tconst tempid = message._id;\n\tdelete message._id;\n\n\tRocketChat.models.Messages.update({ _id: tempid }, { $set: message });\n\n\tconst room = RocketChat.models.Rooms.findOneById(message.rid);\n\n\tMeteor.defer(function() {\n\t\tRocketChat.callbacks.run('afterSaveMessage', RocketChat.models.Messages.findOneById(tempid), room, user._id);\n\t});\n};\n","import s from 'underscore.string';\n\nRocketChat.validateCustomFields = function(fields) {\n\t// Special Case:\n\t// If an admin didn't set any custom fields there's nothing to validate against so consider any customFields valid\n\tif (s.trim(RocketChat.settings.get('Accounts_CustomFields')) === '') {\n\t\treturn;\n\t}\n\n\tlet customFieldsMeta;\n\ttry {\n\t\tcustomFieldsMeta = JSON.parse(RocketChat.settings.get('Accounts_CustomFields'));\n\t} catch (e) {\n\t\tthrow new Meteor.Error('error-invalid-customfield-json', 'Invalid JSON for Custom Fields');\n\t}\n\n\tconst customFields = {};\n\n\tObject.keys(customFieldsMeta).forEach((fieldName) => {\n\t\tconst field = customFieldsMeta[fieldName];\n\n\t\tcustomFields[fieldName] = fields[fieldName];\n\t\tconst fieldValue = s.trim(fields[fieldName]);\n\n\t\tif (field.required && fieldValue === '') {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Field ${ fieldName } is required`, {method: 'registerUser'});\n\t\t}\n\n\t\tif (field.type === 'select' && field.options.indexOf(fields[fieldName]) === -1) {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Value for field ${ fieldName } is invalid`, {method: 'registerUser'});\n\t\t}\n\n\t\tif (field.maxLength && fieldValue.length > field.maxLength) {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Max length of field ${ fieldName } ${ field.maxLength }`, {method: 'registerUser'});\n\t\t}\n\n\t\tif (field.minLength && fieldValue.length < field.minLength) {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Min length of field ${ fieldName } ${ field.minLength }`, {method: 'registerUser'});\n\t\t}\n\t});\n};\n","RocketChat.Notifications = new class {\n\tconstructor() {\n\t\tthis.debug = false;\n\t\tthis.streamAll = new Meteor.Streamer('notify-all');\n\t\tthis.streamLogged = new Meteor.Streamer('notify-logged');\n\t\tthis.streamRoom = new Meteor.Streamer('notify-room');\n\t\tthis.streamRoomUsers = new Meteor.Streamer('notify-room-users');\n\t\tthis.streamUser = new Meteor.Streamer('notify-user');\n\t\tthis.streamAll.allowWrite('none');\n\t\tthis.streamLogged.allowWrite('none');\n\t\tthis.streamRoom.allowWrite('none');\n\t\tthis.streamRoomUsers.allowWrite(function(eventName, ...args) {\n\t\t\tconst [roomId, e] = eventName.split('/');\n\t\t\t// const user = Meteor.users.findOne(this.userId, {\n\t\t\t// \tfields: {\n\t\t\t// \t\tusername: 1\n\t\t\t// \t}\n\t\t\t// });\n\t\t\tif (RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(roomId, this.userId) != null) {\n\t\t\t\tconst subscriptions = RocketChat.models.Subscriptions.findByRoomIdAndNotUserId(roomId, this.userId).fetch();\n\t\t\t\tsubscriptions.forEach(subscription => RocketChat.Notifications.notifyUser(subscription.u._id, e, ...args));\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t\tthis.streamUser.allowWrite('logged');\n\t\tthis.streamAll.allowRead('all');\n\t\tthis.streamLogged.allowRead('logged');\n\t\tthis.streamRoom.allowRead(function(eventName) {\n\t\t\tif (this.userId == null) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst [roomId] = eventName.split('/');\n\t\t\tconst user = Meteor.users.findOne(this.userId, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(roomId);\n\t\t\tif (!room) {\n\t\t\t\tconsole.warn(`Invalid streamRoom eventName: \"${ eventName }\"`);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (room.t === 'l' && room.v._id === user._id) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn room.usernames.indexOf(user.username) > -1;\n\t\t});\n\t\tthis.streamRoomUsers.allowRead('none');\n\t\tthis.streamUser.allowRead(function(eventName) {\n\t\t\tconst [userId] = eventName.split('/');\n\t\t\treturn (this.userId != null) && this.userId === userId;\n\t\t});\n\t}\n\n\tnotifyAll(eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyAll', arguments);\n\t\t}\n\t\targs.unshift(eventName);\n\t\treturn this.streamAll.emit.apply(this.streamAll, args);\n\t}\n\n\tnotifyLogged(eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyLogged', arguments);\n\t\t}\n\t\targs.unshift(eventName);\n\t\treturn this.streamLogged.emit.apply(this.streamLogged, args);\n\t}\n\n\tnotifyRoom(room, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyRoom', arguments);\n\t\t}\n\t\targs.unshift(`${ room }/${ eventName }`);\n\t\treturn this.streamRoom.emit.apply(this.streamRoom, args);\n\t}\n\n\tnotifyUser(userId, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyUser', arguments);\n\t\t}\n\t\targs.unshift(`${ userId }/${ eventName }`);\n\t\treturn this.streamUser.emit.apply(this.streamUser, args);\n\t}\n\n\tnotifyAllInThisInstance(eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyAll', arguments);\n\t\t}\n\t\targs.unshift(eventName);\n\t\treturn this.streamAll.emitWithoutBroadcast.apply(this.streamAll, args);\n\t}\n\n\tnotifyLoggedInThisInstance(eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyLogged', arguments);\n\t\t}\n\t\targs.unshift(eventName);\n\t\treturn this.streamLogged.emitWithoutBroadcast.apply(this.streamLogged, args);\n\t}\n\n\tnotifyRoomInThisInstance(room, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyRoomAndBroadcast', arguments);\n\t\t}\n\t\targs.unshift(`${ room }/${ eventName }`);\n\t\treturn this.streamRoom.emitWithoutBroadcast.apply(this.streamRoom, args);\n\t}\n\n\tnotifyUserInThisInstance(userId, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyUserAndBroadcast', arguments);\n\t\t}\n\t\targs.unshift(`${ userId }/${ eventName }`);\n\t\treturn this.streamUser.emitWithoutBroadcast.apply(this.streamUser, args);\n\t}\n};\n\nRocketChat.Notifications.streamRoom.allowWrite(function(eventName, username) {\n\tconst [, e] = eventName.split('/');\n\tif (e === 'webrtc') {\n\t\treturn true;\n\t}\n\tif (e === 'typing') {\n\t\tconst user = Meteor.users.findOne(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\t\tif (user != null && user.username === username) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n});\n","import ModelsBaseDb from './_BaseDb';\nimport ModelsBaseCache from './_BaseCache';\n\nRocketChat.models._CacheControl = new Meteor.EnvironmentVariable();\n\nclass ModelsBase {\n\tconstructor(nameOrModel, useCache) {\n\t\tthis._db = new ModelsBaseDb(nameOrModel, this);\n\t\tthis.model = this._db.model;\n\t\tthis.collectionName = this._db.collectionName;\n\t\tthis.name = this._db.name;\n\n\t\tthis._useCache = useCache === true;\n\n\t\tthis.cache = new ModelsBaseCache(this);\n\t\t// TODO_CACHE: remove\n\t\tthis.on = this.cache.on.bind(this.cache);\n\t\tthis.emit = this.cache.emit.bind(this.cache);\n\t\tthis.getDynamicView = this.cache.getDynamicView.bind(this.cache);\n\t\tthis.processQueryOptionsOnResult = this.cache.processQueryOptionsOnResult.bind(this.cache);\n\t\t// END_TODO_CACHE\n\n\t\tthis.db = this;\n\n\t\tif (this._useCache) {\n\t\t\tthis.db = new this.constructor(this.model, false);\n\t\t}\n\t}\n\n\tget useCache() {\n\t\tif (RocketChat.models._CacheControl.get() === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this._useCache;\n\t}\n\n\tget origin() {\n\t\treturn this.useCache === true ? 'cache' : '_db';\n\t}\n\n\tarrayToCursor(data) {\n\t\treturn {\n\t\t\tfetch() {\n\t\t\t\treturn data;\n\t\t\t},\n\t\t\tcount() {\n\t\t\t\treturn data.length;\n\t\t\t},\n\t\t\tforEach(fn) {\n\t\t\t\treturn data.forEach(fn);\n\t\t\t}\n\t\t};\n\t}\n\n\tsetUpdatedAt(/*record, checkQuery, query*/) {\n\t\treturn this._db.setUpdatedAt(...arguments);\n\t}\n\n\tfind() {\n\t\ttry {\n\t\t\treturn this[this.origin].find(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...arguments);\n\t\t}\n\t}\n\n\tfindOne() {\n\t\ttry {\n\t\t\treturn this[this.origin].findOne(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...arguments);\n\t\t}\n\t}\n\n\tfindOneById() {\n\t\ttry {\n\t\t\treturn this[this.origin].findOneById(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...arguments);\n\t\t}\n\t}\n\n\tfindOneByIds(ids, options) {\n\t\tcheck(ids, [String]);\n\n\t\ttry {\n\t\t\treturn this[this.origin].findOneByIds(ids, options);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...arguments);\n\t\t}\n\t}\n\n\tinsert(/*record*/) {\n\t\treturn this._db.insert(...arguments);\n\t}\n\n\tupdate(/*query, update, options*/) {\n\t\treturn this._db.update(...arguments);\n\t}\n\n\tupsert(/*query, update*/) {\n\t\treturn this._db.upsert(...arguments);\n\t}\n\n\tremove(/*query*/) {\n\t\treturn this._db.remove(...arguments);\n\t}\n\n\tinsertOrUpsert() {\n\t\treturn this._db.insertOrUpsert(...arguments);\n\t}\n\n\tallow() {\n\t\treturn this._db.allow(...arguments);\n\t}\n\n\tdeny() {\n\t\treturn this._db.deny(...arguments);\n\t}\n\n\tensureIndex() {\n\t\treturn this._db.ensureIndex(...arguments);\n\t}\n\n\tdropIndex() {\n\t\treturn this._db.dropIndex(...arguments);\n\t}\n\n\ttryEnsureIndex() {\n\t\treturn this._db.tryEnsureIndex(...arguments);\n\t}\n\n\ttryDropIndex() {\n\t\treturn this._db.tryDropIndex(...arguments);\n\t}\n\n\ttrashFind(/*query, options*/) {\n\t\treturn this._db.trashFind(...arguments);\n\t}\n\n\ttrashFindDeletedAfter(/*deletedAt, query, options*/) {\n\t\treturn this._db.trashFindDeletedAfter(...arguments);\n\t}\n\n\t// dinamicTrashFindAfter(method, deletedAt, ...args) {\n\t// \tconst scope = {\n\t// \t\tfind: (query={}) => {\n\t// \t\t\treturn this.trashFindDeletedAfter(deletedAt, query, { fields: {_id: 1, _deletedAt: 1} });\n\t// \t\t}\n\t// \t};\n\n\t// \tscope.model = {\n\t// \t\tfind: scope.find\n\t// \t};\n\n\t// \treturn this[method].apply(scope, args);\n\t// }\n\n\t// dinamicFindAfter(method, updatedAt, ...args) {\n\t// \tconst scope = {\n\t// \t\tfind: (query={}, options) => {\n\t// \t\t\tquery._updatedAt = {\n\t// \t\t\t\t$gt: updatedAt\n\t// \t\t\t};\n\n\t// \t\t\treturn this.find(query, options);\n\t// \t\t}\n\t// \t};\n\n\t// \tscope.model = {\n\t// \t\tfind: scope.find\n\t// \t};\n\n\t// \treturn this[method].apply(scope, args);\n\t// }\n\n\t// dinamicFindChangesAfter(method, updatedAt, ...args) {\n\t// \treturn {\n\t// \t\tupdate: this.dinamicFindAfter(method, updatedAt, ...args).fetch(),\n\t// \t\tremove: this.dinamicTrashFindAfter(method, updatedAt, ...args).fetch()\n\t// \t};\n\t// }\n\n}\n\nRocketChat.models._Base = ModelsBase;\n","/* globals InstanceStatus */\nimport _ from 'underscore';\nimport s from 'underscore.string';\n\nRocketChat.models.Avatars = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('avatars');\n\n\t\tthis.model.before.insert((userId, doc) => {\n\t\t\tdoc.instanceId = InstanceStatus.id();\n\t\t});\n\n\t\tthis.tryEnsureIndex({ name: 1 });\n\t}\n\n\tinsertAvatarFileInit(name, userId, store, file, extra) {\n\t\tconst fileData = {\n\t\t\t_id: name,\n\t\t\tname,\n\t\t\tuserId,\n\t\t\tstore,\n\t\t\tcomplete: false,\n\t\t\tuploading: true,\n\t\t\tprogress: 0,\n\t\t\textension: s.strRightBack(file.name, '.'),\n\t\t\tuploadedAt: new Date()\n\t\t};\n\n\t\t_.extend(fileData, file, extra);\n\n\t\treturn this.insertOrUpsert(fileData);\n\t}\n\n\tupdateFileComplete(fileId, userId, file) {\n\t\tif (!fileId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst filter = {\n\t\t\t_id: fileId,\n\t\t\tuserId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tprogress: 1\n\t\t\t}\n\t\t};\n\n\t\tupdate.$set = _.extend(file, update.$set);\n\n\t\tif (this.model.direct && this.model.direct.update) {\n\t\t\treturn this.model.direct.update(filter, update);\n\t\t} else {\n\t\t\treturn this.update(filter, update);\n\t\t}\n\t}\n\n\tfindOneByName(name) {\n\t\treturn this.findOne({ name });\n\t}\n\n\tupdateFileNameById(fileId, name) {\n\t\tconst filter = { _id: fileId };\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname\n\t\t\t}\n\t\t};\n\t\tif (this.model.direct && this.model.direct.update) {\n\t\t\treturn this.model.direct.update(filter, update);\n\t\t} else {\n\t\t\treturn this.update(filter, update);\n\t\t}\n\t}\n\n\t// @TODO deprecated\n\tupdateFileCompleteByNameAndUserId(name, userId, url) {\n\t\tif (!name) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst filter = {\n\t\t\tname,\n\t\t\tuserId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tprogress: 1,\n\t\t\t\turl\n\t\t\t}\n\t\t};\n\n\t\tif (this.model.direct && this.model.direct.update) {\n\t\t\treturn this.model.direct.update(filter, update);\n\t\t} else {\n\t\t\treturn this.update(filter, update);\n\t\t}\n\t}\n\n\tdeleteFile(fileId) {\n\t\tif (this.model.direct && this.model.direct.remove) {\n\t\t\treturn this.model.direct.remove({ _id: fileId });\n\t\t} else {\n\t\t\treturn this.remove({ _id: fileId });\n\t\t}\n\t}\n};\n","import _ from 'underscore';\n\nRocketChat.models.Messages = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('message');\n\n\t\tthis.tryEnsureIndex({ 'rid': 1, 'ts': 1 });\n\t\tthis.tryEnsureIndex({ 'ts': 1 });\n\t\tthis.tryEnsureIndex({ 'u._id': 1 });\n\t\tthis.tryEnsureIndex({ 'editedAt': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'editedBy._id': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'rid': 1, 't': 1, 'u._id': 1 });\n\t\tthis.tryEnsureIndex({ 'expireAt': 1 }, { expireAfterSeconds: 0 });\n\t\tthis.tryEnsureIndex({ 'msg': 'text' });\n\t\tthis.tryEnsureIndex({ 'file._id': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'mentions.username': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'pinned': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'snippeted': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'location': '2dsphere' });\n\t\tthis.tryEnsureIndex({ 'slackBotId': 1, 'slackTs': 1 }, { sparse: 1 });\n\t}\n\n\t// FIND\n\tfindByMention(username, options) {\n\t\tconst query =\t{'mentions.username': username};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByMentionAndRoomId(username, rid, options) {\n\t\tconst query = {\n\t\t\t_hidden: { $ne: true },\n\t\t\t'mentions.username': username,\n\t\t\trid\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomId(roomId, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdNotContainingTypes(roomId, types, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\n\t\t\trid: roomId\n\t\t};\n\n\t\tif (Match.test(types, [String]) && (types.length > 0)) {\n\t\t\tquery.t =\n\t\t\t{$nin: types};\n\t\t}\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindInvisibleByRoomId(roomId, options) {\n\t\tconst query = {\n\t\t\t_hidden: true,\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdAfterTimestamp(roomId, timestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$gt: timestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindForUpdates(roomId, timestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\t_updatedAt: {\n\t\t\t\t$gt: timestamp\n\t\t\t}\n\t\t};\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBeforeTimestamp(roomId, timestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$lt: timestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBeforeTimestampInclusive(roomId, timestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$lte: timestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBetweenTimestamps(roomId, afterTimestamp, beforeTimestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$gt: afterTimestamp,\n\t\t\t\t$lt: beforeTimestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBetweenTimestampsInclusive(roomId, afterTimestamp, beforeTimestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$gte: afterTimestamp,\n\t\t\t\t$lte: beforeTimestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBeforeTimestampNotContainingTypes(roomId, timestamp, types, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$lt: timestamp\n\t\t\t}\n\t\t};\n\n\t\tif (Match.test(types, [String]) && (types.length > 0)) {\n\t\t\tquery.t =\n\t\t\t{$nin: types};\n\t\t}\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBetweenTimestampsNotContainingTypes(roomId, afterTimestamp, beforeTimestamp, types, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$gt: afterTimestamp,\n\t\t\t\t$lt: beforeTimestamp\n\t\t\t}\n\t\t};\n\n\t\tif (Match.test(types, [String]) && (types.length > 0)) {\n\t\t\tquery.t =\n\t\t\t{$nin: types};\n\t\t}\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleCreatedOrEditedAfterTimestamp(timestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: { $ne: true },\n\t\t\t$or: [{\n\t\t\t\tts: {\n\t\t\t\t\t$gt: timestamp\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t'editedAt': {\n\t\t\t\t\t$gt: timestamp\n\t\t\t\t}\n\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindStarredByUserAtRoom(userId, roomId, options) {\n\t\tconst query = {\n\t\t\t_hidden: { $ne: true },\n\t\t\t'starred._id': userId,\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindPinnedByRoom(roomId, options) {\n\t\tconst query = {\n\t\t\tt: { $ne: 'rm' },\n\t\t\t_hidden: { $ne: true },\n\t\t\tpinned: true,\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindSnippetedByRoom(roomId, options) {\n\t\tconst query = {\n\t\t\t_hidden: { $ne: true },\n\t\t\tsnippeted: true,\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tgetLastTimestamp(options) {\n\t\tif (options == null) { options = {}; }\n\t\tconst query = { ts: { $exists: 1 } };\n\t\toptions.sort = { ts: -1 };\n\t\toptions.limit = 1;\n\t\tconst [message] = this.find(query, options).fetch();\n\t\treturn message && message.ts;\n\t}\n\n\tfindByRoomIdAndMessageIds(rid, messageIds, options) {\n\t\tconst query = {\n\t\t\trid,\n\t\t\t_id: {\n\t\t\t\t$in: messageIds\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindOneBySlackBotIdAndSlackTs(slackBotId, slackTs) {\n\t\tconst query = {\n\t\t\tslackBotId,\n\t\t\tslackTs\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tfindOneBySlackTs(slackTs) {\n\t\tconst query = {slackTs};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tgetLastVisibleMessageSentWithNoTypeByRoomId(rid, messageId) {\n\t\tconst query = {\n\t\t\trid,\n\t\t\t_hidden: { $ne: true },\n\t\t\tt: { $exists: false }\n\t\t};\n\n\t\tif (messageId) {\n\t\t\tquery._id = { $ne: messageId };\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tcloneAndSaveAsHistoryById(_id) {\n\t\tconst me = RocketChat.models.Users.findOneById(Meteor.userId());\n\t\tconst record = this.findOneById(_id);\n\t\trecord._hidden = true;\n\t\trecord.parent = record._id;\n\t\trecord.editedAt = new Date;\n\t\trecord.editedBy = {\n\t\t\t_id: Meteor.userId(),\n\t\t\tusername: me.username\n\t\t};\n\t\tdelete record._id;\n\t\treturn this.insert(record);\n\t}\n\n\t// UPDATE\n\tsetHiddenById(_id, hidden) {\n\t\tif (hidden == null) { hidden = true; }\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t_hidden: hidden\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetAsDeletedByIdAndUser(_id, user) {\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tmsg: '',\n\t\t\t\tt: 'rm',\n\t\t\t\turls: [],\n\t\t\t\tmentions: [],\n\t\t\t\tattachments: [],\n\t\t\t\treactions: [],\n\t\t\t\teditedAt: new Date(),\n\t\t\t\teditedBy: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetPinnedByIdAndUserId(_id, pinnedBy, pinned, pinnedAt) {\n\t\tif (pinned == null) { pinned = true; }\n\t\tif (pinnedAt == null) { pinnedAt = 0; }\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tpinned,\n\t\t\t\tpinnedAt: pinnedAt || new Date,\n\t\t\t\tpinnedBy\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetSnippetedByIdAndUserId(message, snippetName, snippetedBy, snippeted, snippetedAt) {\n\t\tif (snippeted == null) { snippeted = true; }\n\t\tif (snippetedAt == null) { snippetedAt = 0; }\n\t\tconst query =\t{_id: message._id};\n\n\t\tconst msg = `\\`\\`\\`${ message.msg }\\`\\`\\``;\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tmsg,\n\t\t\t\tsnippeted,\n\t\t\t\tsnippetedAt: snippetedAt || new Date,\n\t\t\t\tsnippetedBy,\n\t\t\t\tsnippetName\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetUrlsById(_id, urls) {\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\turls\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateAllUsernamesByUserId(userId, username) {\n\t\tconst query =\t{'u._id': userId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'u.username': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tupdateUsernameOfEditByUserId(userId, username) {\n\t\tconst query =\t{'editedBy._id': userId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'editedBy.username': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tupdateUsernameAndMessageOfMentionByIdAndOldUsername(_id, oldUsername, newUsername, newMessage) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\t'mentions.username': oldUsername\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'mentions.$.username': newUsername,\n\t\t\t\t'msg': newMessage\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateUserStarById(_id, userId, starred) {\n\t\tlet update;\n\t\tconst query =\t{_id};\n\n\t\tif (starred) {\n\t\t\tupdate = {\n\t\t\t\t$addToSet: {\n\t\t\t\t\tstarred: { _id: userId }\n\t\t\t\t}\n\t\t\t};\n\t\t} else {\n\t\t\tupdate = {\n\t\t\t\t$pull: {\n\t\t\t\t\tstarred: { _id: Meteor.userId() }\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupgradeEtsToEditAt() {\n\t\tconst query =\t{ets: { $exists: 1 }};\n\n\t\tconst update = {\n\t\t\t$rename: {\n\t\t\t\t'ets': 'editedAt'\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetMessageAttachments(_id, attachments) {\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tattachments\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetSlackBotIdAndSlackTs(_id, slackBotId, slackTs) {\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tslackBotId,\n\t\t\t\tslackTs\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\n\t// INSERT\n\tcreateWithTypeRoomIdMessageAndUser(type, roomId, message, user, extraData) {\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId, { fields: { sysMes: 1 }});\n\t\tif ((room != null ? room.sysMes : undefined) === false) {\n\t\t\treturn;\n\t\t}\n\t\tconst record = {\n\t\t\tt: type,\n\t\t\trid: roomId,\n\t\t\tts: new Date,\n\t\t\tmsg: message,\n\t\t\tu: {\n\t\t\t\t_id: user._id,\n\t\t\t\tusername: user.username\n\t\t\t},\n\t\t\tgroupable: false\n\t\t};\n\n\t\t_.extend(record, extraData);\n\n\t\trecord._id = this.insertOrUpsert(record);\n\t\tRocketChat.models.Rooms.incMsgCountById(room._id, 1);\n\t\treturn record;\n\t}\n\n\tcreateUserJoinWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('uj', roomId, message, user, extraData);\n\t}\n\n\tcreateUserLeaveWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('ul', roomId, message, user, extraData);\n\t}\n\n\tcreateUserRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('ru', roomId, message, user, extraData);\n\t}\n\n\tcreateUserAddedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('au', roomId, message, user, extraData);\n\t}\n\n\tcreateCommandWithRoomIdAndUser(command, roomId, user, extraData) {\n\t\treturn this.createWithTypeRoomIdMessageAndUser('command', roomId, command, user, extraData);\n\t}\n\n\tcreateUserMutedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('user-muted', roomId, message, user, extraData);\n\t}\n\n\tcreateUserUnmutedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('user-unmuted', roomId, message, user, extraData);\n\t}\n\n\tcreateNewModeratorWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('new-moderator', roomId, message, user, extraData);\n\t}\n\n\tcreateModeratorRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('moderator-removed', roomId, message, user, extraData);\n\t}\n\n\tcreateNewOwnerWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('new-owner', roomId, message, user, extraData);\n\t}\n\n\tcreateOwnerRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('owner-removed', roomId, message, user, extraData);\n\t}\n\n\tcreateNewLeaderWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('new-leader', roomId, message, user, extraData);\n\t}\n\n\tcreateLeaderRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('leader-removed', roomId, message, user, extraData);\n\t}\n\n\tcreateSubscriptionRoleAddedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('subscription-role-added', roomId, message, user, extraData);\n\t}\n\n\tcreateSubscriptionRoleRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('subscription-role-removed', roomId, message, user, extraData);\n\t}\n\n\t// REMOVE\n\tremoveById(_id) {\n\t\tconst query =\t{_id};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByRoomId(roomId) {\n\t\tconst query =\t{rid: roomId};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByUserId(userId) {\n\t\tconst query =\t{'u._id': userId};\n\n\t\treturn this.remove(query);\n\t}\n\n\tgetMessageByFileId(fileID) {\n\t\treturn this.findOne({ 'file._id': fileID });\n\t}\n};\n","import _ from 'underscore';\n\nRocketChat.models.Reports = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('reports');\n\t}\n\tcreateWithMessageDescriptionAndUserId(message, description, userId, extraData) {\n\t\tconst record = {\n\t\t\tmessage,\n\t\t\tdescription,\n\t\t\tts: new Date(),\n\t\t\tuserId\n\t\t};\n\t\t_.extend(record, extraData);\n\t\trecord._id = this.insert(record);\n\t\treturn record;\n\t}\n};\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nclass ModelRooms extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper(...arguments);\n\n\t\tthis.tryEnsureIndex({ 'name': 1 }, { unique: 1, sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'default': 1 });\n\t\tthis.tryEnsureIndex({ 'usernames': 1 });\n\t\tthis.tryEnsureIndex({ 't': 1 });\n\t\tthis.tryEnsureIndex({ 'u._id': 1 });\n\n\t\tthis.cache.ignoreUpdatedFields = ['msgs', 'lm'];\n\t\tthis.cache.ensureIndex(['t', 'name'], 'unique');\n\t\tthis.cache.options = {fields: {usernames: 0}};\n\t}\n\n\tfindOneByIdOrName(_idOrName, options) {\n\t\tconst query = {\n\t\t\t$or: [{\n\t\t\t\t_id: _idOrName\n\t\t\t}, {\n\t\t\t\tname: _idOrName\n\t\t\t}]\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByImportId(_id, options) {\n\t\tconst query = {importIds: _id};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByName(name, options) {\n\t\tconst query = {name};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByNameAndNotId(name, rid) {\n\t\tconst query = {\n\t\t\t_id: { $ne: rid },\n\t\t\tname\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tfindOneByDisplayName(fname, options) {\n\t\tconst query = {fname};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByNameAndType(name, type, options) {\n\t\tconst query = {\n\t\t\tname,\n\t\t\tt: type\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByIdContainingUsername(_id, username, options) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByNameAndTypeNotContainingUsername(name, type, username, options) {\n\t\tconst query = {\n\t\t\tname,\n\t\t\tt: type,\n\t\t\tusernames: {\n\t\t\t\t$ne: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\n\t// FIND\n\n\tfindById(roomId, options) {\n\t\treturn this.find({ _id: roomId }, options);\n\t}\n\n\tfindByIds(roomIds, options) {\n\t\treturn this.find({ _id: {$in: [].concat(roomIds)} }, options);\n\t}\n\n\tfindByType(type, options) {\n\t\tconst query = {t: type};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypes(types, options) {\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByUserId(userId, options) {\n\t\tconst query = {'u._id': userId};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindBySubscriptionUserId(userId, options) {\n\t\tlet data;\n\t\tif (this.useCache) {\n\t\t\tdata = RocketChat.models.Subscriptions.findByUserId(userId).fetch();\n\t\t\tdata = data.map(function(item) {\n\t\t\t\tif (item._room) {\n\t\t\t\t\treturn item._room;\n\t\t\t\t}\n\t\t\t\tconsole.log('Empty Room for Subscription', item);\n\t\t\t\treturn {};\n\t\t\t});\n\t\t\treturn this.arrayToCursor(this.processQueryOptionsOnResult(data, options));\n\t\t}\n\n\t\tdata = RocketChat.models.Subscriptions.findByUserId(userId, {fields: {rid: 1}}).fetch();\n\t\tdata = data.map(item => item.rid);\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: data\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindBySubscriptionUserIdUpdatedAfter(userId, _updatedAt, options) {\n\t\tif (this.useCache) {\n\t\t\tlet data = RocketChat.models.Subscriptions.findByUserId(userId).fetch();\n\t\t\tdata = data.map(function(item) {\n\t\t\t\tif (item._room) {\n\t\t\t\t\treturn item._room;\n\t\t\t\t}\n\t\t\t\tconsole.log('Empty Room for Subscription', item);\n\t\t\t\treturn {};\n\t\t\t});\n\t\t\tdata = data.filter(item => item._updatedAt > _updatedAt);\n\t\t\treturn this.arrayToCursor(this.processQueryOptionsOnResult(data, options));\n\t\t}\n\n\t\tlet ids = RocketChat.models.Subscriptions.findByUserId(userId, {fields: {rid: 1}}).fetch();\n\t\tids = ids.map(item => item.rid);\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: ids\n\t\t\t},\n\t\t\t_updatedAt: {\n\t\t\t\t$gt: _updatedAt\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByNameContaining(name, options) {\n\t\tconst nameRegex = new RegExp(s.trim(s.escapeRegExp(name)), 'i');\n\n\t\tconst query = {\n\t\t\t$or: [\n\t\t\t\t{name: nameRegex},\n\t\t\t\t{\n\t\t\t\t\tt: 'd',\n\t\t\t\t\tusernames: nameRegex\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByNameContainingTypesWithUsername(name, types, options) {\n\t\tconst nameRegex = new RegExp(s.trim(s.escapeRegExp(name)), 'i');\n\n\t\tconst $or = [];\n\t\tfor (const type of Array.from(types)) {\n\t\t\tconst obj = {name: nameRegex, t: type.type};\n\t\t\tif (type.username != null) {\n\t\t\t\tobj.usernames = type.username;\n\t\t\t}\n\t\t\tif (type.ids != null) {\n\t\t\t\tobj._id = {$in: type.ids};\n\t\t\t}\n\t\t\t$or.push(obj);\n\t\t}\n\n\t\tconst query = {$or};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindContainingTypesWithUsername(types, options) {\n\n\t\tconst $or = [];\n\t\tfor (const type of Array.from(types)) {\n\t\t\tconst obj = {t: type.type};\n\t\t\tif (type.username != null) {\n\t\t\t\tobj.usernames = type.username;\n\t\t\t}\n\t\t\tif (type.ids != null) {\n\t\t\t\tobj._id = {$in: type.ids};\n\t\t\t}\n\t\t\t$or.push(obj);\n\t\t}\n\n\t\tconst query = {$or};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByNameContainingAndTypes(name, types, options) {\n\t\tconst nameRegex = new RegExp(s.trim(s.escapeRegExp(name)), 'i');\n\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t},\n\t\t\t$or: [\n\t\t\t\t{name: nameRegex},\n\t\t\t\t{\n\t\t\t\t\tt: 'd',\n\t\t\t\t\tusernames: nameRegex\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByNameAndTypeNotDefault(name, type, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tname,\n\t\t\tdefault: {\n\t\t\t\t$ne: true\n\t\t\t}\n\t\t};\n\n\t\t// do not use cache\n\t\treturn this._db.find(query, options);\n\t}\n\n\tfindByNameAndTypesNotContainingUsername(name, types, username, options) {\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t},\n\t\t\tname,\n\t\t\tusernames: {\n\t\t\t\t$ne: username\n\t\t\t}\n\t\t};\n\n\t\t// do not use cache\n\t\treturn this._db.find(query, options);\n\t}\n\n\tfindByNameStartingAndTypes(name, types, options) {\n\t\tconst nameRegex = new RegExp(`^${ s.trim(s.escapeRegExp(name)) }`, 'i');\n\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t},\n\t\t\t$or: [\n\t\t\t\t{name: nameRegex},\n\t\t\t\t{\n\t\t\t\t\tt: 'd',\n\t\t\t\t\tusernames: nameRegex\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByDefaultAndTypes(defaultValue, types, options) {\n\t\tconst query = {\n\t\t\tdefault: defaultValue,\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeContainingUsername(type, username, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeContainingUsernames(type, username, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tusernames: { $all: [].concat(username) }\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypesAndNotUserIdContainingUsername(types, userId, username, options) {\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t},\n\t\t\tuid: {\n\t\t\t\t$ne: userId\n\t\t\t},\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByContainingUsername(username, options) {\n\t\tconst query = {usernames: username};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeAndName(type, name, options) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('t,name', [type, name], options);\n\t\t}\n\n\t\tconst query = {\n\t\t\tname,\n\t\t\tt: type\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeAndNameContainingUsername(type, name, username, options) {\n\t\tconst query = {\n\t\t\tname,\n\t\t\tt: type,\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeAndArchivationState(type, archivationstate, options) {\n\t\tconst query = {t: type};\n\n\t\tif (archivationstate) {\n\t\t\tquery.archived = true;\n\t\t} else {\n\t\t\tquery.archived = { $ne: true };\n\t\t}\n\n\t\treturn this.find(query, options);\n\t}\n\n\t// UPDATE\n\taddImportIds(_id, importIds) {\n\t\timportIds = [].concat(importIds);\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\timportIds: {\n\t\t\t\t\t$each: importIds\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tarchiveById(_id) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tarchived: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tunarchiveById(_id) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tarchived: false\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\taddUsernameById(_id, username, muted) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\tif (muted) {\n\t\t\tupdate.$addToSet.muted = username;\n\t\t}\n\n\t\treturn this.update(query, update);\n\t}\n\n\taddUsernamesById(_id, usernames) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\tusernames: {\n\t\t\t\t\t$each: usernames\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\taddUsernameByName(name, username) {\n\t\tconst query = {name};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tremoveUsernameById(_id, username) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tremoveUsernamesById(_id, usernames) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tusernames: {\n\t\t\t\t\t$in: usernames\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tremoveUsernameFromAll(username) {\n\t\tconst query = {usernames: username};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tremoveUsernameByName(name, username) {\n\t\tconst query = {name};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetNameById(_id, name, fname) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname,\n\t\t\t\tfname\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tincMsgCountById(_id, inc) {\n\t\tif (inc == null) { inc = 1; }\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$inc: {\n\t\t\t\tmsgs: inc\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tincMsgCountAndSetLastMessageById(_id, inc, lastMessageTimestamp, lastMessage) {\n\t\tif (inc == null) { inc = 1; }\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tlm: lastMessageTimestamp\n\t\t\t},\n\t\t\t$inc: {\n\t\t\t\tmsgs: inc\n\t\t\t}\n\t\t};\n\n\t\tif (lastMessage) {\n\t\t\tupdate.$set.lastMessage = lastMessage;\n\t\t}\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetLastMessageById(_id, lastMessage) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tlastMessage\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\treplaceUsername(previousUsername, username) {\n\t\tconst query = {usernames: previousUsername};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'usernames.$': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\treplaceMutedUsername(previousUsername, username) {\n\t\tconst query = {muted: previousUsername};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'muted.$': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\treplaceUsernameOfUserByUserId(userId, username) {\n\t\tconst query = {'u._id': userId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'u.username': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetJoinCodeById(_id, joinCode) {\n\t\tlet update;\n\t\tconst query = {_id};\n\n\t\tif ((joinCode != null ? joinCode.trim() : undefined) !== '') {\n\t\t\tupdate = {\n\t\t\t\t$set: {\n\t\t\t\t\tjoinCodeRequired: true,\n\t\t\t\t\tjoinCode\n\t\t\t\t}\n\t\t\t};\n\t\t} else {\n\t\t\tupdate = {\n\t\t\t\t$set: {\n\t\t\t\t\tjoinCodeRequired: false\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\tjoinCode: 1\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetUserById(_id, user) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetTypeById(_id, type) {\n\t\tconst query = {_id};\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tt: type\n\t\t\t}\n\t\t};\n\t\tif (type === 'p') {\n\t\t\tupdate.$unset = {default: ''};\n\t\t}\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetTopicById(_id, topic) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\ttopic\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetAnnouncementById(_id, announcement) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tannouncement\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tmuteUsernameByRoomId(_id, username) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\tmuted: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tunmuteUsernameByRoomId(_id, username) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tmuted: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsaveDefaultById(_id, defaultValue) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tdefault: defaultValue === 'true'\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetTopicAndTagsById(_id, topic, tags) {\n\t\tconst setData = {};\n\t\tconst unsetData = {};\n\n\t\tif (topic != null) {\n\t\t\tif (!_.isEmpty(s.trim(topic))) {\n\t\t\t\tsetData.topic = s.trim(topic);\n\t\t\t} else {\n\t\t\t\tunsetData.topic = 1;\n\t\t\t}\n\t\t}\n\n\t\tif (tags != null) {\n\t\t\tif (!_.isEmpty(s.trim(tags))) {\n\t\t\t\tsetData.tags = s.trim(tags).split(',').map(tag => s.trim(tag));\n\t\t\t} else {\n\t\t\t\tunsetData.tags = 1;\n\t\t\t}\n\t\t}\n\n\t\tconst update = {};\n\n\t\tif (!_.isEmpty(setData)) {\n\t\t\tupdate.$set = setData;\n\t\t}\n\n\t\tif (!_.isEmpty(unsetData)) {\n\t\t\tupdate.$unset = unsetData;\n\t\t}\n\n\t\tif (_.isEmpty(update)) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.update({ _id }, update);\n\t}\n\n\t// INSERT\n\tcreateWithTypeNameUserAndUsernames(type, name, fname, user, usernames, extraData) {\n\t\tconst room = {\n\t\t\tname,\n\t\t\tfname,\n\t\t\tt: type,\n\t\t\tusernames,\n\t\t\tmsgs: 0,\n\t\t\tu: {\n\t\t\t\t_id: user._id,\n\t\t\t\tusername: user.username\n\t\t\t}\n\t\t};\n\n\t\t_.extend(room, extraData);\n\n\t\troom._id = this.insert(room);\n\t\treturn room;\n\t}\n\n\tcreateWithIdTypeAndName(_id, type, name, extraData) {\n\t\tconst room = {\n\t\t\t_id,\n\t\t\tts: new Date(),\n\t\t\tt: type,\n\t\t\tname,\n\t\t\tusernames: [],\n\t\t\tmsgs: 0\n\t\t};\n\n\t\t_.extend(room, extraData);\n\n\t\tthis.insert(room);\n\t\treturn room;\n\t}\n\n\n\t// REMOVE\n\tremoveById(_id) {\n\t\tconst query = {_id};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByTypeContainingUsername(type, username) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.remove(query);\n\t}\n}\n\nRocketChat.models.Rooms = new ModelRooms('room', true);\n","class ModelSettings extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper(...arguments);\n\n\t\tthis.tryEnsureIndex({ 'blocked': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'hidden': 1 }, { sparse: 1 });\n\t}\n\n\t// FIND\n\tfindById(_id) {\n\t\tconst query = {_id};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindOneNotHiddenById(_id) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\thidden: { $ne: true }\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tfindByIds(_id = []) {\n\t\t_id = [].concat(_id);\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: _id\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindByRole(role, options) {\n\t\tconst query = {role};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindPublic(options) {\n\t\tconst query = {public: true};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindNotHiddenPublic(ids = []) {\n\t\tconst filter = {\n\t\t\thidden: { $ne: true },\n\t\t\tpublic: true\n\t\t};\n\n\t\tif (ids.length > 0) {\n\t\t\tfilter._id =\n\t\t\t\t{$in: ids};\n\t\t}\n\n\t\treturn this.find(filter, { fields: {_id: 1, value: 1} });\n\t}\n\n\tfindNotHiddenPublicUpdatedAfter(updatedAt) {\n\t\tconst filter = {\n\t\t\thidden: { $ne: true },\n\t\t\tpublic: true,\n\t\t\t_updatedAt: {\n\t\t\t\t$gt: updatedAt\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(filter, { fields: {_id: 1, value: 1} });\n\t}\n\n\tfindNotHiddenPrivate() {\n\t\treturn this.find({\n\t\t\thidden: { $ne: true },\n\t\t\tpublic: { $ne: true }\n\t\t});\n\t}\n\n\tfindNotHidden(options) {\n\t\treturn this.find({ hidden: { $ne: true } }, options);\n\t}\n\n\tfindNotHiddenUpdatedAfter(updatedAt) {\n\t\treturn this.find({\n\t\t\thidden: { $ne: true },\n\t\t\t_updatedAt: {\n\t\t\t\t$gt: updatedAt\n\t\t\t}\n\t\t});\n\t}\n\n\t// UPDATE\n\tupdateValueById(_id, value) {\n\t\tconst query = {\n\t\t\tblocked: { $ne: true },\n\t\t\tvalue: { $ne: value },\n\t\t\t_id\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tvalue\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateValueAndEditorById(_id, value, editor) {\n\t\tconst query = {\n\t\t\tblocked: { $ne: true },\n\t\t\tvalue: { $ne: value },\n\t\t\t_id\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tvalue,\n\t\t\t\teditor\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateValueNotHiddenById(_id, value) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\thidden: { $ne: true },\n\t\t\tblocked: { $ne: true }\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tvalue\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateOptionsById(_id, options) {\n\t\tconst query = {\n\t\t\tblocked: { $ne: true },\n\t\t\t_id\n\t\t};\n\n\t\tconst update = {$set: options};\n\n\t\treturn this.update(query, update);\n\t}\n\n\t// INSERT\n\tcreateWithIdAndValue(_id, value) {\n\t\tconst record = {\n\t\t\t_id,\n\t\t\tvalue,\n\t\t\t_createdAt: new Date\n\t\t};\n\n\t\treturn this.insert(record);\n\t}\n\n\t// REMOVE\n\tremoveById(_id) {\n\t\tconst query = {\n\t\t\tblocked: { $ne: true },\n\t\t\t_id\n\t\t};\n\n\t\treturn this.remove(query);\n\t}\n}\n\nRocketChat.models.Settings = new ModelSettings('settings', true);\n","import _ from 'underscore';\n\nclass ModelSubscriptions extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper(...arguments);\n\n\t\tthis.tryEnsureIndex({ 'rid': 1, 'u._id': 1 }, { unique: 1 });\n\t\tthis.tryEnsureIndex({ 'rid': 1, 'alert': 1, 'u._id': 1 });\n\t\tthis.tryEnsureIndex({ 'rid': 1, 'roles': 1 });\n\t\tthis.tryEnsureIndex({ 'u._id': 1, 'name': 1, 't': 1 });\n\t\tthis.tryEnsureIndex({ 'u._id': 1, 'name': 1, 't': 1, 'code': 1 }, { unique: 1 });\n\t\tthis.tryEnsureIndex({ 'open': 1 });\n\t\tthis.tryEnsureIndex({ 'alert': 1 });\n\t\tthis.tryEnsureIndex({ 'unread': 1 });\n\t\tthis.tryEnsureIndex({ 'ts': 1 });\n\t\tthis.tryEnsureIndex({ 'ls': 1 });\n\t\tthis.tryEnsureIndex({ 'audioNotifications': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'desktopNotifications': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'mobilePushNotifications': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'emailNotifications': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'autoTranslate': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'autoTranslateLanguage': 1 }, { sparse: 1 });\n\n\t\tthis.cache.ensureIndex('rid', 'array');\n\t\tthis.cache.ensureIndex('u._id', 'array');\n\t\tthis.cache.ensureIndex('name', 'array');\n\t\tthis.cache.ensureIndex(['rid', 'u._id'], 'unique');\n\t\tthis.cache.ensureIndex(['name', 'u._id'], 'unique');\n\t}\n\n\n\t// FIND ONE\n\tfindOneByRoomIdAndUserId(roomId, userId) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('rid,u._id', [roomId, userId]).fetch();\n\t\t}\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tfindOneByRoomNameAndUserId(roomName, userId) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('name,u._id', [roomName, userId]).fetch();\n\t\t}\n\t\tconst query = {\n\t\t\tname: roomName,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\t// FIND\n\tfindByUserId(userId, options) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('u._id', userId, options);\n\t\t}\n\n\t\tconst query =\n\t\t\t{'u._id': userId};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByUserIdUpdatedAfter(userId, updatedAt, options) {\n\t\tconst query = {\n\t\t\t'u._id': userId,\n\t\t\t_updatedAt: {\n\t\t\t\t$gt: updatedAt\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\t// FIND\n\tfindByRoomIdAndRoles(roomId, roles, options) {\n\t\troles = [].concat(roles);\n\t\tconst query = {\n\t\t\t'rid': roomId,\n\t\t\t'roles': { $in: roles }\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByType(types, options) {\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeAndUserId(type, userId, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeNameAndUserId(type, name, userId, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tname,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByRoomId(roomId, options) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('rid', roomId, options);\n\t\t}\n\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByRoomIdAndNotUserId(roomId, userId, options) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$ne: userId\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tgetLastSeen(options) {\n\t\tif (options == null) { options = {}; }\n\t\tconst query = { ls: { $exists: 1 } };\n\t\toptions.sort = { ls: -1 };\n\t\toptions.limit = 1;\n\t\tconst [subscription] = this.find(query, options).fetch();\n\t\treturn subscription && subscription.ls;\n\t}\n\n\tfindByRoomIdAndUserIds(roomId, userIds) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$in: userIds\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindByRoomIdAndUserIdsOrAllMessages(roomId, userIds) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t$or: [\n\t\t\t\t{ 'u._id': { $in: userIds } },\n\t\t\t\t{ emailNotifications: 'all' }\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindUnreadByUserId(userId) {\n\t\tconst query = {\n\t\t\t'u._id': userId,\n\t\t\tunread: {\n\t\t\t\t$gt: 0\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, { fields: { unread: 1 } });\n\t}\n\n\t// UPDATE\n\tarchiveByRoomId(roomId) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: false,\n\t\t\t\topen: false,\n\t\t\t\tarchived: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tunarchiveByRoomId(roomId) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: false,\n\t\t\t\topen: true,\n\t\t\t\tarchived: false\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\thideByRoomIdAndUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: false,\n\t\t\t\topen: false\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\topenByRoomIdAndUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\topen: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetAsReadByRoomIdAndUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\topen: true,\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tls: new Date\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetAsUnreadByRoomIdAndUserId(roomId, userId, firstMessageUnreadTimestamp) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\topen: true,\n\t\t\t\talert: true,\n\t\t\t\tls: firstMessageUnreadTimestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetFavoriteByRoomIdAndUserId(roomId, userId, favorite) {\n\t\tif (favorite == null) { favorite = true; }\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tf: favorite\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateNameAndAlertByRoomId(roomId, name, fname) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname,\n\t\t\t\tfname,\n\t\t\t\talert: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tupdateNameByRoomId(roomId, name) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetUserUsernameByUserId(userId, username) {\n\t\tconst query =\n\t\t\t{'u._id': userId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'u.username': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetNameForDirectRoomsWithOldName(oldName, name) {\n\t\tconst query = {\n\t\t\tname: oldName,\n\t\t\tt: 'd'\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tincUnreadForRoomIdExcludingUserId(roomId, userId, inc) {\n\t\tif (inc == null) { inc = 1; }\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$ne: userId\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: true,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$inc: {\n\t\t\t\tunread: inc\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tincGroupMentionsAndUnreadForRoomIdExcludingUserId(roomId, userId, incGroup = 1, incUnread = 1) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$ne: userId\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: true,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$inc: {\n\t\t\t\tunread: incUnread,\n\t\t\t\tgroupMentions: incGroup\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tincUserMentionsAndUnreadForRoomIdAndUserIds(roomId, userIds, incUser = 1, incUnread = 1) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$in: userIds\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: true,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$inc: {\n\t\t\t\tunread: incUnread,\n\t\t\t\tuserMentions: incUser\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\tsetAlertForRoomIdExcludingUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$ne: userId\n\t\t\t},\n\t\t\t$or: [\n\t\t\t\t{ alert: { $ne: true } },\n\t\t\t\t{ open: { $ne: true } }\n\t\t\t]\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: true,\n\t\t\t\topen: true\n\t\t\t}\n\t\t};\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetBlockedByRoomId(rid, blocked, blocker) {\n\t\tconst query = {\n\t\t\trid,\n\t\t\t'u._id': blocked\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tblocked: true\n\t\t\t}\n\t\t};\n\n\t\tconst query2 = {\n\t\t\trid,\n\t\t\t'u._id': blocker\n\t\t};\n\n\t\tconst update2 = {\n\t\t\t$set: {\n\t\t\t\tblocker: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update) && this.update(query2, update2);\n\t}\n\n\tunsetBlockedByRoomId(rid, blocked, blocker) {\n\t\tconst query = {\n\t\t\trid,\n\t\t\t'u._id': blocked\n\t\t};\n\n\t\tconst update = {\n\t\t\t$unset: {\n\t\t\t\tblocked: 1\n\t\t\t}\n\t\t};\n\n\t\tconst query2 = {\n\t\t\trid,\n\t\t\t'u._id': blocker\n\t\t};\n\n\t\tconst update2 = {\n\t\t\t$unset: {\n\t\t\t\tblocker: 1\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update) && this.update(query2, update2);\n\t}\n\n\tupdateTypeByRoomId(roomId, type) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tt: type\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\taddRoleById(_id, role) {\n\t\tconst query =\n\t\t\t{_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\troles: role\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tremoveRoleById(_id, role) {\n\t\tconst query =\n\t\t\t{_id};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\troles: role\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetArchivedByUsername(username, archived) {\n\t\tconst query = {\n\t\t\tt: 'd',\n\t\t\tname: username\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tarchived\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\t// INSERT\n\tcreateWithRoomAndUser(room, user, extraData) {\n\t\tconst subscription = {\n\t\t\topen: false,\n\t\t\talert: false,\n\t\t\tunread: 0,\n\t\t\tuserMentions: 0,\n\t\t\tgroupMentions: 0,\n\t\t\tts: room.ts,\n\t\t\trid: room._id,\n\t\t\tname: room.name,\n\t\t\tfname: room.fname,\n\t\t\tt: room.t,\n\t\t\tu: {\n\t\t\t\t_id: user._id,\n\t\t\t\tusername: user.username,\n\t\t\t\tname: user.name\n\t\t\t}\n\t\t};\n\n\t\t_.extend(subscription, extraData);\n\n\t\treturn this.insert(subscription);\n\t}\n\n\n\t// REMOVE\n\tremoveByUserId(userId) {\n\t\tconst query =\n\t\t\t{'u._id': userId};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByRoomId(roomId) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByRoomIdAndUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.remove(query);\n\t}\n}\n\nRocketChat.models.Subscriptions = new ModelSubscriptions('subscription', true);\n","/* globals InstanceStatus */\nimport _ from 'underscore';\nimport s from 'underscore.string';\n\nRocketChat.models.Uploads = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('uploads');\n\n\t\tthis.model.before.insert((userId, doc) => {\n\t\t\tdoc.instanceId = InstanceStatus.id();\n\t\t});\n\n\t\tthis.tryEnsureIndex({ 'rid': 1 });\n\t\tthis.tryEnsureIndex({ 'uploadedAt': 1 });\n\t}\n\n\tfindNotHiddenFilesOfRoom(roomId, limit) {\n\t\tconst fileQuery = {\n\t\t\trid: roomId,\n\t\t\tcomplete: true,\n\t\t\tuploading: false,\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t}\n\t\t};\n\n\t\tconst fileOptions = {\n\t\t\tlimit,\n\t\t\tsort: {\n\t\t\t\tuploadedAt: -1\n\t\t\t},\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\tuserId: 1,\n\t\t\t\trid: 1,\n\t\t\t\tname: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\ttype: 1,\n\t\t\t\turl: 1,\n\t\t\t\tuploadedAt: 1\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(fileQuery, fileOptions);\n\t}\n\n\tinsertFileInit(userId, store, file, extra) {\n\t\tconst fileData = {\n\t\t\tuserId,\n\t\t\tstore,\n\t\t\tcomplete: false,\n\t\t\tuploading: true,\n\t\t\tprogress: 0,\n\t\t\textension: s.strRightBack(file.name, '.'),\n\t\t\tuploadedAt: new Date()\n\t\t};\n\n\t\t_.extend(fileData, file, extra);\n\n\t\tif (this.model.direct && this.model.direct.insert != null) {\n\t\t\tfile = this.model.direct.insert(fileData);\n\t\t} else {\n\t\t\tfile = this.insert(fileData);\n\t\t}\n\n\t\treturn file;\n\t}\n\n\tupdateFileComplete(fileId, userId, file) {\n\t\tlet result;\n\t\tif (!fileId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst filter = {\n\t\t\t_id: fileId,\n\t\t\tuserId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tprogress: 1\n\t\t\t}\n\t\t};\n\n\t\tupdate.$set = _.extend(file, update.$set);\n\n\t\tif (this.model.direct && this.model.direct.update != null) {\n\t\t\tresult = this.model.direct.update(filter, update);\n\t\t} else {\n\t\t\tresult = this.update(filter, update);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tdeleteFile(fileId) {\n\t\tif (this.model.direct && this.model.direct.remove != null) {\n\t\t\treturn this.model.direct.remove({ _id: fileId });\n\t\t} else {\n\t\t\treturn this.remove({ _id: fileId });\n\t\t}\n\t}\n};\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nclass ModelUsers extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper(...arguments);\n\n\t\tthis.tryEnsureIndex({ 'roles': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'name': 1 });\n\t\tthis.tryEnsureIndex({ 'lastLogin': 1 });\n\t\tthis.tryEnsureIndex({ 'status': 1 });\n\t\tthis.tryEnsureIndex({ 'active': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'statusConnection': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'type': 1 });\n\n\t\tthis.cache.ensureIndex('username', 'unique');\n\t}\n\n\tfindOneByImportId(_id, options) {\n\t\treturn this.findOne({ importIds: _id }, options);\n\t}\n\n\tfindOneByUsername(username, options) {\n\t\tif (typeof username === 'string') {\n\t\t\tusername = new RegExp(`^${ username }$`, 'i');\n\t\t}\n\n\t\tconst query = {username};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByEmailAddress(emailAddress, options) {\n\t\tconst query =\t{'emails.address': new RegExp(`^${ s.escapeRegExp(emailAddress) }$`, 'i')};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneAdmin(admin, options) {\n\t\tconst query =\t{admin};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByIdAndLoginToken(_id, token, options) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\t'services.resume.loginTokens.hashedToken' : Accounts._hashLoginToken(token)\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\n\t// FIND\n\tfindById(userId) {\n\t\tconst query =\t{_id: userId};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindUsersNotOffline(options) {\n\t\tconst query = {\n\t\t\tusername: {\n\t\t\t\t$exists: 1\n\t\t\t},\n\t\t\tstatus: {\n\t\t\t\t$in: ['online', 'away', 'busy']\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\n\tfindByUsername(username, options) {\n\t\tconst query =\t{username};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindUsersByUsernamesWithHighlights(usernames, options) {\n\t\tif (this.useCache) {\n\t\t\tconst result = {\n\t\t\t\tfetch() {\n\t\t\t\t\treturn RocketChat.models.Users.getDynamicView('highlights').data().filter(record => usernames.indexOf(record.username) > -1);\n\t\t\t\t},\n\t\t\t\tcount() {\n\t\t\t\t\treturn result.fetch().length;\n\t\t\t\t},\n\t\t\t\tforEach(fn) {\n\t\t\t\t\treturn result.fetch().forEach(fn);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn result;\n\t\t}\n\n\t\tconst query = {\n\t\t\tusername: { $in: usernames },\n\t\t\t'settings.preferences.highlights.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindActiveByUsernameOrNameRegexWithExceptions(searchTerm, exceptions, options) {\n\t\tif (exceptions == null) { exceptions = []; }\n\t\tif (options == null) { options = {}; }\n\t\tif (!_.isArray(exceptions)) {\n\t\t\texceptions = [ exceptions ];\n\t\t}\n\n\t\tconst termRegex = new RegExp(s.escapeRegExp(searchTerm), 'i');\n\t\tconst query = {\n\t\t\t$or: [{\n\t\t\t\tusername: termRegex\n\t\t\t}, {\n\t\t\t\tname: termRegex\n\t\t\t}],\n\t\t\tactive: true,\n\t\t\ttype: {\n\t\t\t\t$in: ['user', 'bot']\n\t\t\t},\n\t\t\t$and: [{\n\t\t\t\tusername: {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tusername: {\n\t\t\t\t\t$nin: exceptions\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByActiveUsersExcept(searchTerm, exceptions, options) {\n\t\tif (exceptions == null) { exceptions = []; }\n\t\tif (options == null) { options = {}; }\n\t\tif (!_.isArray(exceptions)) {\n\t\t\texceptions = [ exceptions ];\n\t\t}\n\n\t\tconst termRegex = new RegExp(s.escapeRegExp(searchTerm), 'i');\n\n\t\tconst orStmt = _.reduce(RocketChat.settings.get('Accounts_SearchFields').trim().split(','), function(acc, el) {\n\t\t\tacc.push({ [el.trim()]: termRegex });\n\t\t\treturn acc;\n\t\t}, []);\n\t\tconst query = {\n\t\t\t$and: [\n\t\t\t\t{\n\t\t\t\t\tactive: true,\n\t\t\t\t\t$or: orStmt\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tusername: { $exists: true, $nin: exceptions }\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\t// do not use cache\n\t\treturn this._db.find(query, options);\n\t}\n\n\tfindUsersByNameOrUsername(nameOrUsername, options) {\n\t\tconst query = {\n\t\t\tusername: {\n\t\t\t\t$exists: 1\n\t\t\t},\n\n\t\t\t$or: [\n\t\t\t\t{name: nameOrUsername},\n\t\t\t\t{username: nameOrUsername}\n\t\t\t],\n\n\t\t\ttype: {\n\t\t\t\t$in: ['user']\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByUsernameNameOrEmailAddress(usernameNameOrEmailAddress, options) {\n\t\tconst query = {\n\t\t\t$or: [\n\t\t\t\t{name: usernameNameOrEmailAddress},\n\t\t\t\t{username: usernameNameOrEmailAddress},\n\t\t\t\t{'emails.address': usernameNameOrEmailAddress}\n\t\t\t],\n\t\t\ttype: {\n\t\t\t\t$in: ['user', 'bot']\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindLDAPUsers(options) {\n\t\tconst query =\t{ldap: true};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindCrowdUsers(options) {\n\t\tconst query =\t{crowd: true};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tgetLastLogin(options) {\n\t\tif (options == null) { options = {}; }\n\t\tconst query = { lastLogin: { $exists: 1 } };\n\t\toptions.sort = { lastLogin: -1 };\n\t\toptions.limit = 1;\n\t\tconst [user] = this.find(query, options).fetch();\n\t\treturn user && user.lastLogin;\n\t}\n\n\tfindUsersByUsernames(usernames, options) {\n\t\tconst query = {\n\t\t\tusername: {\n\t\t\t\t$in: usernames\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindUsersByIds(ids, options) {\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: ids\n\t\t\t}\n\t\t};\n\t\treturn this.find(query, options);\n\t}\n\n\t// UPDATE\n\taddImportIds(_id, importIds) {\n\t\timportIds = [].concat(importIds);\n\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\timportIds: {\n\t\t\t\t\t$each: importIds\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateLastLoginById(_id) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tlastLogin: new Date\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetServiceId(_id, serviceName, serviceId) {\n\t\tconst update =\n\t\t{$set: {}};\n\n\t\tconst serviceIdKey = `services.${ serviceName }.id`;\n\t\tupdate.$set[serviceIdKey] = serviceId;\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetUsername(_id, username) {\n\t\tconst update =\n\t\t{$set: {username}};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetEmail(_id, email) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\temails: [{\n\t\t\t\t\taddress: email,\n\t\t\t\t\tverified: false\n\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetEmailVerified(_id, email) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\temails: {\n\t\t\t\t$elemMatch: {\n\t\t\t\t\taddress: email,\n\t\t\t\t\tverified: false\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'emails.$.verified': true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetName(_id, name) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetCustomFields(_id, fields) {\n\t\tconst values = {};\n\t\tObject.keys(fields).forEach(key => {\n\t\t\tvalues[`customFields.${ key }`] = fields[key];\n\t\t});\n\n\t\tconst update = {$set: values};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetAvatarOrigin(_id, origin) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tavatarOrigin: origin\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tunsetAvatarOrigin(_id) {\n\t\tconst update = {\n\t\t\t$unset: {\n\t\t\t\tavatarOrigin: 1\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetUserActive(_id, active) {\n\t\tif (active == null) { active = true; }\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tactive\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetAllUsersActive(active) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tactive\n\t\t\t}\n\t\t};\n\n\t\treturn this.update({}, update, { multi: true });\n\t}\n\n\tunsetLoginTokens(_id) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'services.resume.loginTokens' : []\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tunsetRequirePasswordChange(_id) {\n\t\tconst update = {\n\t\t\t$unset: {\n\t\t\t\t'requirePasswordChange' : true,\n\t\t\t\t'requirePasswordChangeReason' : true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tresetPasswordAndSetRequirePasswordChange(_id, requirePasswordChange, requirePasswordChangeReason) {\n\t\tconst update = {\n\t\t\t$unset: {\n\t\t\t\t'services.password': 1\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\trequirePasswordChange,\n\t\t\t\trequirePasswordChangeReason\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetLanguage(_id, language) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tlanguage\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetProfile(_id, profile) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'settings.profile': profile\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetPreferences(_id, preferences) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'settings.preferences': preferences\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetUtcOffset(_id, utcOffset) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\tutcOffset: {\n\t\t\t\t$ne: utcOffset\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tutcOffset\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsaveUserById(_id, data) {\n\t\tconst setData = {};\n\t\tconst unsetData = {};\n\n\t\tif (data.name != null) {\n\t\t\tif (!_.isEmpty(s.trim(data.name))) {\n\t\t\t\tsetData.name = s.trim(data.name);\n\t\t\t} else {\n\t\t\t\tunsetData.name = 1;\n\t\t\t}\n\t\t}\n\n\t\tif (data.email != null) {\n\t\t\tif (!_.isEmpty(s.trim(data.email))) {\n\t\t\t\tsetData.emails = [{address: s.trim(data.email)}];\n\t\t\t} else {\n\t\t\t\tunsetData.emails = 1;\n\t\t\t}\n\t\t}\n\n\t\tif (data.phone != null) {\n\t\t\tif (!_.isEmpty(s.trim(data.phone))) {\n\t\t\t\tsetData.phone = [{phoneNumber: s.trim(data.phone)}];\n\t\t\t} else {\n\t\t\t\tunsetData.phone = 1;\n\t\t\t}\n\t\t}\n\n\t\tconst update = {};\n\n\t\tif (!_.isEmpty(setData)) {\n\t\t\tupdate.$set = setData;\n\t\t}\n\n\t\tif (!_.isEmpty(unsetData)) {\n\t\t\tupdate.$unset = unsetData;\n\t\t}\n\n\t\tif (_.isEmpty(update)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.update({ _id }, update);\n\t}\n\n\t// INSERT\n\tcreate(data) {\n\t\tconst user = {\n\t\t\tcreatedAt: new Date,\n\t\t\tavatarOrigin: 'none'\n\t\t};\n\n\t\t_.extend(user, data);\n\n\t\treturn this.insert(user);\n\t}\n\n\n\t// REMOVE\n\tremoveById(_id) {\n\t\treturn this.remove(_id);\n\t}\n\n\t/*\nFind users to send a message by email if:\n- he is not online\n- has a verified email\n- has not disabled email notifications\n- `active` is equal to true (false means they were deactivated and can't login)\n*/\n\tgetUsersToSendOfflineEmail(usersIds) {\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: usersIds\n\t\t\t},\n\t\t\tactive: true,\n\t\t\tstatus: 'offline',\n\t\t\tstatusConnection: {\n\t\t\t\t$ne: 'online'\n\t\t\t},\n\t\t\t'emails.verified': true\n\t\t};\n\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tusername: 1,\n\t\t\t\temails: 1,\n\t\t\t\t'settings.preferences.emailNotificationMode': 1,\n\t\t\t\tlanguage: 1\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n}\n\nRocketChat.models.Users = new ModelUsers(Meteor.users, true);\n","/* eslint new-cap: 0 */\nimport _ from 'underscore';\nimport loki from 'lokijs';\nimport {EventEmitter} from 'events';\nimport objectPath from 'object-path';\n\nconst logger = new Logger('BaseCache');\n\nconst lokiEq = loki.LokiOps.$eq;\nconst lokiNe = loki.LokiOps.$ne;\n\nloki.LokiOps.$eq = function(a, b) {\n\tif (Array.isArray(a)) {\n\t\treturn a.indexOf(b) !== -1;\n\t}\n\treturn lokiEq(a, b);\n};\n\nloki.LokiOps.$ne = function(a, b) {\n\tif (Array.isArray(a)) {\n\t\treturn a.indexOf(b) === -1;\n\t}\n\treturn lokiNe(a, b);\n};\n\nconst lokiIn = loki.LokiOps.$in;\nloki.LokiOps.$in = function(a, b) {\n\tif (Array.isArray(a)) {\n\t\treturn a.some(subA => lokiIn(subA, b));\n\t}\n\treturn lokiIn(a, b);\n};\n\nloki.LokiOps.$nin = function(a, b) {\n\treturn !loki.LokiOps.$in(a, b);\n};\n\nloki.LokiOps.$all = function(a, b) {\n\treturn b.every(subB => a.includes(subB));\n};\n\nloki.LokiOps.$exists = function(a, b) {\n\tif (b) {\n\t\treturn loki.LokiOps.$ne(a, undefined);\n\t}\n\n\treturn loki.LokiOps.$eq(a, undefined);\n};\n\nloki.LokiOps.$elemMatch = function(a, b) {\n\treturn _.findWhere(a, b);\n};\n\nconst ignore = [\n\t'emit',\n\t'load',\n\t'on',\n\t'addToAllIndexes'\n];\n\nfunction traceMethodCalls(target) {\n\ttarget._stats = {};\n\n\tfor (const property in target) {\n\t\tif (typeof target[property] === 'function' && ignore.indexOf(property) === -1) {\n\t\t\ttarget._stats[property] = {\n\t\t\t\tcalls: 0,\n\t\t\t\ttime: 0,\n\t\t\t\tavg: 0\n\t\t\t};\n\t\t\tconst origMethod = target[property];\n\t\t\ttarget[property] = function(...args) {\n\n\t\t\t\tif (target.loaded !== true) {\n\t\t\t\t\treturn origMethod.apply(target, args);\n\t\t\t\t}\n\n\t\t\t\tconst startTime = RocketChat.statsTracker.now();\n\t\t\t\tconst result = origMethod.apply(target, args);\n\t\t\t\tconst time = Math.round(RocketChat.statsTracker.now() - startTime) / 1000;\n\t\t\t\ttarget._stats[property].time += time;\n\t\t\t\ttarget._stats[property].calls++;\n\t\t\t\ttarget._stats[property].avg = target._stats[property].time / target._stats[property].calls;\n\n\t\t\t\treturn result;\n\t\t\t};\n\t\t}\n\t}\n\n\tsetInterval(function() {\n\t\tfor (const property in target._stats) {\n\t\t\tif (target._stats.hasOwnProperty(property) && target._stats[property].time > 0) {\n\t\t\t\tconst tags = [`property:${ property }`, `collection:${ target.collectionName }`];\n\t\t\t\tRocketChat.statsTracker.timing('cache.methods.time', target._stats[property].avg, tags);\n\t\t\t\tRocketChat.statsTracker.increment('cache.methods.totalTime', target._stats[property].time, tags);\n\t\t\t\tRocketChat.statsTracker.increment('cache.methods.count', target._stats[property].calls, tags);\n\t\t\t\ttarget._stats[property].avg = 0;\n\t\t\t\ttarget._stats[property].time = 0;\n\t\t\t\ttarget._stats[property].calls = 0;\n\t\t\t}\n\t\t}\n\t}, 10000);\n\n\ttarget._getStatsAvg = function() {\n\t\tconst stats = [];\n\t\tfor (const property in target._stats) {\n\t\t\tif (target._stats.hasOwnProperty(property)) {\n\t\t\t\tstats.push([Math.round(target._stats[property].avg*100)/100, property]);\n\t\t\t}\n\t\t}\n\t\treturn _.sortBy(stats, function(record) {\n\t\t\treturn record[0];\n\t\t});\n\t};\n}\n\nclass Adapter {\n\tloadDatabase(/*dbname, callback*/) {}\n\tsaveDatabase(/*dbname, dbstring, callback*/) {}\n\tdeleteDatabase(/*dbname, callback*/) {}\n}\n\nconst db = new loki('rocket.chat.json', {adapter: Adapter});\n\nclass ModelsBaseCache extends EventEmitter {\n\tconstructor(model) {\n\t\tsuper();\n\n\t\ttraceMethodCalls(this);\n\n\t\tthis.indexes = {};\n\t\tthis.ignoreUpdatedFields = ['_updatedAt'];\n\n\t\tthis.query = {};\n\t\tthis.options = {};\n\n\t\tthis.ensureIndex('_id', 'unique');\n\n\t\tthis.joins = {};\n\n\t\tthis.on('inserted', (...args) => { this.emit('changed', 'inserted', ...args); });\n\t\tthis.on('removed', (...args) => { this.emit('changed', 'removed', ...args); });\n\t\tthis.on('updated', (...args) => { this.emit('changed', 'updated', ...args); });\n\n\t\tthis.on('beforeinsert', (...args) => { this.emit('beforechange', 'inserted', ...args); });\n\t\tthis.on('beforeremove', (...args) => { this.emit('beforechange', 'removed', ...args); });\n\t\tthis.on('beforeupdate', (...args) => { this.emit('beforechange', 'updated', ...args); });\n\n\t\tthis.on('inserted', (...args) => { this.emit('sync', 'inserted', ...args); });\n\t\tthis.on('updated', (...args) => { this.emit('sync', 'updated', ...args); });\n\t\tthis.on('beforeremove', (...args) => { this.emit('sync', 'removed', ...args); });\n\n\t\tthis.db = db;\n\n\t\tthis.model = model;\n\n\t\tthis.collectionName = this.model._db.collectionName;\n\t\tthis.collection = this.db.addCollection(this.collectionName);\n\t}\n\n\thasOne(join, {field, link}) {\n\t\tthis.join({join, field, link, multi: false});\n\t}\n\n\thasMany(join, {field, link}) {\n\t\tthis.join({join, field, link, multi: true});\n\t}\n\n\tjoin({join, field, link, multi}) {\n\t\tif (!RocketChat.models[join]) {\n\t\t\tconsole.log(`Invalid cache model ${ join }`);\n\t\t\treturn;\n\t\t}\n\n\t\tRocketChat.models[join].cache.on('inserted', (record) => {\n\t\t\tthis.processRemoteJoinInserted({join, field, link, multi, record});\n\t\t});\n\n\t\tRocketChat.models[join].cache.on('beforeupdate', (record, diff) => {\n\t\t\tif (diff[link.remote]) {\n\t\t\t\tthis.processRemoteJoinRemoved({join, field, link, multi, record});\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models[join].cache.on('updated', (record, diff) => {\n\t\t\tif (diff[link.remote]) {\n\t\t\t\tthis.processRemoteJoinInserted({join, field, link, multi, record});\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models[join].cache.on('removed', (record) => {\n\t\t\tthis.processRemoteJoinRemoved({join, field, link, multi, record});\n\t\t});\n\n\t\tthis.on('inserted', (localRecord) => {\n\t\t\tthis.processLocalJoinInserted({join, field, link, multi, localRecord});\n\t\t});\n\n\t\tthis.on('beforeupdate', (localRecord, diff) => {\n\t\t\tif (diff[link.local]) {\n\t\t\t\tif (multi === true) {\n\t\t\t\t\tlocalRecord[field] = [];\n\t\t\t\t} else {\n\t\t\t\t\tlocalRecord[field] = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.on('updated', (localRecord, diff) => {\n\t\t\tif (diff[link.local]) {\n\t\t\t\tthis.processLocalJoinInserted({join, field, link, multi, localRecord});\n\t\t\t}\n\t\t});\n\t}\n\n\tprocessRemoteJoinInserted({field, link, multi, record}) {\n\t\tlet localRecords = this._findByIndex(link.local, objectPath.get(record, link.remote));\n\n\t\tif (!localRecords) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Array.isArray(localRecords)) {\n\t\t\tlocalRecords = [localRecords];\n\t\t}\n\n\t\tfor (let i = 0; i < localRecords.length; i++) {\n\t\t\tconst localRecord = localRecords[i];\n\t\t\tif (multi === true && !localRecord[field]) {\n\t\t\t\tlocalRecord[field] = [];\n\t\t\t}\n\n\t\t\tif (typeof link.where === 'function' && link.where(localRecord, record) === false) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet mutableRecord = record;\n\n\t\t\tif (typeof link.transform === 'function') {\n\t\t\t\tmutableRecord = link.transform(localRecord, mutableRecord);\n\t\t\t}\n\n\t\t\tif (multi === true) {\n\t\t\t\tlocalRecord[field].push(mutableRecord);\n\t\t\t} else {\n\t\t\t\tlocalRecord[field] = mutableRecord;\n\t\t\t}\n\n\t\t\tthis.emit(`join:${ field }:inserted`, localRecord, mutableRecord);\n\t\t\tthis.emit(`join:${ field }:changed`, 'inserted', localRecord, mutableRecord);\n\t\t}\n\t}\n\n\tprocessLocalJoinInserted({join, field, link, multi, localRecord}) {\n\t\tlet records = RocketChat.models[join].cache._findByIndex(link.remote, objectPath.get(localRecord, link.local));\n\n\t\tif (!Array.isArray(records)) {\n\t\t\trecords = [records];\n\t\t}\n\n\t\tfor (let i = 0; i < records.length; i++) {\n\t\t\tlet record = records[i];\n\n\t\t\tif (typeof link.where === 'function' && link.where(localRecord, record) === false) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (typeof link.transform === 'function') {\n\t\t\t\trecord = link.transform(localRecord, record);\n\t\t\t}\n\n\t\t\tif (multi === true) {\n\t\t\t\tlocalRecord[field].push(record);\n\t\t\t} else {\n\t\t\t\tlocalRecord[field] = record;\n\t\t\t}\n\n\t\t\tthis.emit(`join:${ field }:inserted`, localRecord, record);\n\t\t\tthis.emit(`join:${ field }:changed`, 'inserted', localRecord, record);\n\t\t}\n\t}\n\n\tprocessRemoteJoinRemoved({field, link, multi, record}) {\n\t\tlet localRecords = this._findByIndex(link.local, objectPath.get(record, link.remote));\n\n\t\tif (!localRecords) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Array.isArray(localRecords)) {\n\t\t\tlocalRecords = [localRecords];\n\t\t}\n\n\t\tfor (let i = 0; i < localRecords.length; i++) {\n\t\t\tconst localRecord = localRecords[i];\n\n\t\t\tif (multi === true) {\n\t\t\t\tif (Array.isArray(localRecord[field])) {\n\t\t\t\t\tif (typeof link.remove === 'function') {\n\t\t\t\t\t\tlink.remove(localRecord[field], record);\n\t\t\t\t\t} else if (localRecord[field].indexOf(record) > -1) {\n\t\t\t\t\t\tlocalRecord[field].splice(localRecord[field].indexOf(record), 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlocalRecord[field] = undefined;\n\t\t\t}\n\n\t\t\tthis.emit(`join:${ field }:removed`, localRecord, record);\n\t\t\tthis.emit(`join:${ field }:changed`, 'removed', localRecord, record);\n\t\t}\n\t}\n\n\tensureIndex(fields, type='array') {\n\t\tif (!Array.isArray(fields)) {\n\t\t\tfields = [fields];\n\t\t}\n\n\t\tthis.indexes[fields.join(',')] = {\n\t\t\ttype,\n\t\t\tfields,\n\t\t\tdata: {}\n\t\t};\n\t}\n\n\taddToAllIndexes(record) {\n\t\tfor (const indexName in this.indexes) {\n\t\t\tif (this.indexes.hasOwnProperty(indexName)) {\n\t\t\t\tthis.addToIndex(indexName, record);\n\t\t\t}\n\t\t}\n\t}\n\n\taddToIndex(indexName, record) {\n\t\tconst index = this.indexes[indexName];\n\t\tif (!index) {\n\t\t\tconsole.error(`Index not defined ${ indexName }`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst keys = [];\n\t\tfor (const field of index.fields) {\n\t\t\tkeys.push(objectPath.get(record, field));\n\t\t}\n\t\tconst key = keys.join('|');\n\n\t\tif (index.type === 'unique') {\n\t\t\tindex.data[key] = record;\n\t\t\treturn;\n\t\t}\n\n\t\tif (index.type === 'array') {\n\t\t\tif (!index.data[key]) {\n\t\t\t\tindex.data[key] = [];\n\t\t\t}\n\t\t\tindex.data[key].push(record);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tremoveFromAllIndexes(record) {\n\t\tfor (const indexName in this.indexes) {\n\t\t\tif (this.indexes.hasOwnProperty(indexName)) {\n\t\t\t\tthis.removeFromIndex(indexName, record);\n\t\t\t}\n\t\t}\n\t}\n\n\tremoveFromIndex(indexName, record) {\n\t\tconst index = this.indexes[indexName];\n\t\tif (!this.indexes[indexName]) {\n\t\t\tconsole.error(`Index not defined ${ indexName }`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!index.data) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet key = [];\n\t\tfor (const field of index.fields) {\n\t\t\tkey.push(objectPath.get(record, field));\n\t\t}\n\t\tkey = key.join('|');\n\n\t\tif (index.type === 'unique') {\n\t\t\tindex.data[key] = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif (index.type === 'array') {\n\t\t\tif (!index.data[key]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst i = index.data[key].indexOf(record);\n\t\t\tif (i > -1) {\n\t\t\t\tindex.data[key].splice(i, 1);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t}\n\n\t_findByIndex(index, keys) {\n\t\tconst key = [].concat(keys).join('|');\n\t\tif (!this.indexes[index]) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.indexes[index].data) {\n\t\t\tconst result = this.indexes[index].data[key];\n\t\t\tif (result) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\n\t\tif (this.indexes[index].type === 'array') {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tfindByIndex(index, keys, options={}) {\n\t\treturn {\n\t\t\tfetch: () => {\n\t\t\t\treturn this.processQueryOptionsOnResult(this._findByIndex(index, keys), options);\n\t\t\t},\n\n\t\t\tcount: () => {\n\t\t\t\tconst records = this.findByIndex(index, keys, options).fetch();\n\t\t\t\tif (Array.isArray(records)) {\n\t\t\t\t\treturn records.length;\n\t\t\t\t}\n\t\t\t\treturn !records ? 0 : 1;\n\t\t\t},\n\n\t\t\tforEach: (fn) => {\n\t\t\t\tconst records = this.findByIndex(index, keys, options).fetch();\n\t\t\t\tif (Array.isArray(records)) {\n\t\t\t\t\treturn records.forEach(fn);\n\t\t\t\t}\n\t\t\t\tif (records) {\n\t\t\t\t\treturn fn(records);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tload() {\n\t\tif (this.model._useCache === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.log('Will load cache for', this.collectionName);\n\t\tthis.emit('beforeload');\n\t\tthis.loaded = false;\n\t\tconst time = RocketChat.statsTracker.now();\n\t\tconst data = this.model.db.find(this.query, this.options).fetch();\n\t\tfor (let i=0; i < data.length; i++) {\n\t\t\tthis.insert(data[i]);\n\t\t}\n\t\tconsole.log(String(data.length), 'records load from', this.collectionName);\n\t\tRocketChat.statsTracker.timing('cache.load', RocketChat.statsTracker.now() - time, [`collection:${ this.collectionName }`]);\n\n\t\tthis.startSync();\n\t\tthis.loaded = true;\n\t\tthis.emit('afterload');\n\t}\n\n\tstartSync() {\n\t\tif (this.model._useCache === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.model._db.on('change', ({action, id, data/*, oplog*/}) => {\n\t\t\tswitch (action) {\n\t\t\t\tcase 'insert':\n\t\t\t\t\tdata._id = id;\n\t\t\t\t\tthis.insert(data);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'remove':\n\t\t\t\t\tthis.removeById(id);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'update:record':\n\t\t\t\t\tthis.updateDiffById(id, data);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'update:diff':\n\t\t\t\t\tthis.updateDiffById(id, data);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'update:query':\n\t\t\t\t\tthis.update(data.query, data.update, data.options);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t}\n\n\tprocessQueryOptionsOnResult(result, options={}) {\n\t\tif (result === undefined || result === null) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (Array.isArray(result)) {\n\t\t\tif (options.sort) {\n\t\t\t\tresult = result.sort((a, b) => {\n\t\t\t\t\tlet r = 0;\n\t\t\t\t\tfor (const field in options.sort) {\n\t\t\t\t\t\tif (options.sort.hasOwnProperty(field)) {\n\t\t\t\t\t\t\tconst direction = options.sort[field];\n\t\t\t\t\t\t\tlet valueA;\n\t\t\t\t\t\t\tlet valueB;\n\t\t\t\t\t\t\tif (field.indexOf('.') > -1) {\n\t\t\t\t\t\t\t\tvalueA = objectPath.get(a, field);\n\t\t\t\t\t\t\t\tvalueB = objectPath.get(b, field);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvalueA = a[field];\n\t\t\t\t\t\t\t\tvalueB = b[field];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (valueA > valueB) {\n\t\t\t\t\t\t\t\tr = direction;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (valueA < valueB) {\n\t\t\t\t\t\t\t\tr = -direction;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn r;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (typeof options.skip === 'number') {\n\t\t\t\tresult.splice(0, options.skip);\n\t\t\t}\n\n\t\t\tif (typeof options.limit === 'number' && options.limit !== 0) {\n\t\t\t\tresult.splice(options.limit);\n\t\t\t}\n\t\t}\n\n\t\tif (!options.fields) {\n\t\t\toptions.fields = {};\n\t\t}\n\n\t\tconst fieldsToRemove = [];\n\t\tconst fieldsToGet = [];\n\n\t\tfor (const field in options.fields) {\n\t\t\tif (options.fields.hasOwnProperty(field)) {\n\t\t\t\tif (options.fields[field] === 0) {\n\t\t\t\t\tfieldsToRemove.push(field);\n\t\t\t\t} else if (options.fields[field] === 1) {\n\t\t\t\t\tfieldsToGet.push(field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (fieldsToRemove.length > 0 && fieldsToGet.length > 0) {\n\t\t\tconsole.warn('Can\\'t mix remove and get fields');\n\t\t\tfieldsToRemove.splice(0, fieldsToRemove.length);\n\t\t}\n\n\t\tif (fieldsToGet.length > 0 && fieldsToGet.indexOf('_id') === -1) {\n\t\t\tfieldsToGet.push('_id');\n\t\t}\n\n\t\tconst pickFields = (obj, fields) => {\n\t\t\tconst picked = {};\n\t\t\tfields.forEach((field) => {\n\t\t\t\tif (field.indexOf('.') !== -1) {\n\t\t\t\t\tobjectPath.set(picked, field, objectPath.get(obj, field));\n\t\t\t\t} else {\n\t\t\t\t\tpicked[field] = obj[field];\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn picked;\n\t\t};\n\n\t\tif (fieldsToRemove.length > 0 || fieldsToGet.length > 0) {\n\t\t\tif (Array.isArray(result)) {\n\t\t\t\tresult = result.map((record) => {\n\t\t\t\t\tif (fieldsToRemove.length > 0) {\n\t\t\t\t\t\treturn _.omit(record, ...fieldsToRemove);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (fieldsToGet.length > 0) {\n\t\t\t\t\t\treturn pickFields(record, fieldsToGet);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (fieldsToRemove.length > 0) {\n\t\t\t\t\treturn _.omit(result, ...fieldsToRemove);\n\t\t\t\t}\n\n\t\t\t\tif (fieldsToGet.length > 0) {\n\t\t\t\t\treturn pickFields(result, fieldsToGet);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprocessQuery(query, parentField) {\n\t\tif (!query) {\n\t\t\treturn query;\n\t\t}\n\n\t\tif (Match.test(query, String)) {\n\t\t\treturn {\n\t\t\t\t_id: query\n\t\t\t};\n\t\t}\n\n\t\tif (Object.keys(query).length > 1 && parentField !== '$elemMatch') {\n\t\t\tconst and = [];\n\t\t\tfor (const field in query) {\n\t\t\t\tif (query.hasOwnProperty(field)) {\n\t\t\t\t\tand.push({\n\t\t\t\t\t\t[field]: query[field]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tquery = {$and: and};\n\t\t}\n\n\t\tfor (const field in query) {\n\t\t\tif (query.hasOwnProperty(field)) {\n\t\t\t\tconst value = query[field];\n\t\t\t\tif (value instanceof RegExp && field !== '$regex') {\n\t\t\t\t\tquery[field] = {\n\t\t\t\t\t\t$regex: value\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (field === '$and' || field === '$or') {\n\t\t\t\t\tquery[field] = value.map((subValue) => {\n\t\t\t\t\t\treturn this.processQuery(subValue, field);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (Match.test(value, Object) && Object.keys(value).length > 0) {\n\t\t\t\t\tquery[field] = this.processQuery(value, field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn query;\n\t}\n\n\tfind(query, options={}) {\n\t\treturn {\n\t\t\tfetch: () => {\n\t\t\t\ttry {\n\t\t\t\t\tquery = this.processQuery(query);\n\t\t\t\t\treturn this.processQueryOptionsOnResult(this.collection.find(query), options);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('Exception on cache find for', this.collectionName);\n\t\t\t\t\tconsole.error('Query:', JSON.stringify(query, null, 2));\n\t\t\t\t\tconsole.error('Options:', JSON.stringify(options, null, 2));\n\t\t\t\t\tconsole.error(e.stack);\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tcount: () => {\n\t\t\t\ttry {\n\t\t\t\t\tquery = this.processQuery(query);\n\t\t\t\t\tconst { limit, skip } = options;\n\t\t\t\t\treturn this.processQueryOptionsOnResult(this.collection.find(query), { limit, skip }).length;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('Exception on cache find for', this.collectionName);\n\t\t\t\t\tconsole.error('Query:', JSON.stringify(query, null, 2));\n\t\t\t\t\tconsole.error('Options:', JSON.stringify(options, null, 2));\n\t\t\t\t\tconsole.error(e.stack);\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tforEach: (fn) => {\n\t\t\t\treturn this.find(query, options).fetch().forEach(fn);\n\t\t\t},\n\n\t\t\tobserve: (obj) => {\n\t\t\t\tlogger.debug(this.collectionName, 'Falling back observe to model with query:', query);\n\t\t\t\treturn this.model.db.find(...arguments).observe(obj);\n\t\t\t},\n\n\t\t\tobserveChanges: (obj) => {\n\t\t\t\tlogger.debug(this.collectionName, 'Falling back observeChanges to model with query:', query);\n\t\t\t\treturn this.model.db.find(...arguments).observeChanges(obj);\n\t\t\t},\n\n\t\t\t_publishCursor: (cursor, sub, collection) => {\n\t\t\t\tlogger.debug(this.collectionName, 'Falling back _publishCursor to model with query:', query);\n\t\t\t\treturn this.model.db.find(...arguments)._publishCursor(cursor, sub, collection);\n\t\t\t}\n\t\t};\n\t}\n\n\tfindOne(query, options) {\n\t\ttry {\n\t\t\tquery = this.processQuery(query);\n\t\t\treturn this.processQueryOptionsOnResult(this.collection.findOne(query), options);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on cache findOne for', this.collectionName);\n\t\t\tconsole.error('Query:', JSON.stringify(query, null, 2));\n\t\t\tconsole.error('Options:', JSON.stringify(options, null, 2));\n\t\t\tconsole.error(e.stack);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tfindOneById(_id, options) {\n\t\treturn this.findByIndex('_id', _id, options).fetch();\n\t}\n\n\tfindOneByIds(ids, options) {\n\t\tconst query = this.processQuery({ _id: { $in: ids }});\n\t\treturn this.processQueryOptionsOnResult(this.collection.findOne(query), options);\n\t}\n\n\tfindWhere(query, options) {\n\t\tquery = this.processQuery(query);\n\t\treturn this.processQueryOptionsOnResult(this.collection.findWhere(query), options);\n\t}\n\n\taddDynamicView() {\n\t\treturn this.collection.addDynamicView(...arguments);\n\t}\n\n\tgetDynamicView() {\n\t\treturn this.collection.getDynamicView(...arguments);\n\t}\n\n\tinsert(record) {\n\t\tif (Array.isArray(record)) {\n\t\t\tfor (const item of record) {\n\t\t\t\tthis.insert(item);\n\t\t\t}\n\t\t} else {\n\t\t\t// TODO remove - ignore updates in room.usernames\n\t\t\tif (this.collectionName === 'rocketchat_room' && record.usernames) {\n\t\t\t\tdelete record.usernames;\n\t\t\t}\n\t\t\tthis.emit('beforeinsert', record);\n\t\t\tthis.addToAllIndexes(record);\n\t\t\tthis.collection.insert(record);\n\t\t\tthis.emit('inserted', record);\n\t\t}\n\t}\n\n\tupdateDiffById(id, diff) {\n\t\t// TODO remove - ignore updates in room.usernames\n\t\tif (this.collectionName === 'rocketchat_room' && diff.usernames) {\n\t\t\tdelete diff.usernames;\n\t\t}\n\n\t\tconst record = this._findByIndex('_id', id);\n\t\tif (!record) {\n\t\t\tconsole.error('Cache.updateDiffById: No record', this.collectionName, id, diff);\n\t\t\treturn;\n\t\t}\n\t\tthis.removeFromAllIndexes(record);\n\n\t\tconst updatedFields = _.without(Object.keys(diff), ...this.ignoreUpdatedFields);\n\n\t\tif (updatedFields.length > 0) {\n\t\t\tthis.emit('beforeupdate', record, diff);\n\t\t}\n\n\t\tfor (const key in diff) {\n\t\t\tif (diff.hasOwnProperty(key)) {\n\t\t\t\tobjectPath.set(record, key, diff[key]);\n\t\t\t}\n\t\t}\n\n\t\tthis.collection.update(record);\n\t\tthis.addToAllIndexes(record);\n\n\t\tif (updatedFields.length > 0) {\n\t\t\tthis.emit('updated', record, diff);\n\t\t}\n\t}\n\n\tupdateRecord(record, update) {\n\t\t// TODO remove - ignore updates in room.usernames\n\t\tif (this.collectionName === 'rocketchat_room' && (record.usernames || (record.$set && record.$set.usernames))) {\n\t\t\tdelete record.usernames;\n\t\t\tif (record.$set && record.$set.usernames) {\n\t\t\t\tdelete record.$set.usernames;\n\t\t\t}\n\t\t}\n\n\t\tthis.removeFromAllIndexes(record);\n\n\t\tconst topLevelFields = Object.keys(update).map(field => field.split('.')[0]);\n\t\tconst updatedFields = _.without(topLevelFields, ...this.ignoreUpdatedFields);\n\n\t\tif (updatedFields.length > 0) {\n\t\t\tthis.emit('beforeupdate', record, record);\n\t\t}\n\n\t\tif (update.$set) {\n\t\t\t_.each(update.$set, (value, field) => {\n\t\t\t\tobjectPath.set(record, field, value);\n\t\t\t});\n\t\t}\n\n\t\tif (update.$unset) {\n\t\t\t_.each(update.$unset, (value, field) => {\n\t\t\t\tobjectPath.del(record, field);\n\t\t\t});\n\t\t}\n\n\t\tif (update.$min) {\n\t\t\t_.each(update.$min, (value, field) => {\n\t\t\t\tconst curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined || value < curValue) {\n\t\t\t\t\tobjectPath.set(record, field, value);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$max) {\n\t\t\t_.each(update.$max, (value, field) => {\n\t\t\t\tconst curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined || value > curValue) {\n\t\t\t\t\tobjectPath.set(record, field, value);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$inc) {\n\t\t\t_.each(update.$inc, (value, field) => {\n\t\t\t\tlet curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined) {\n\t\t\t\t\tcurValue = value;\n\t\t\t\t} else {\n\t\t\t\t\tcurValue += value;\n\t\t\t\t}\n\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t});\n\t\t}\n\n\t\tif (update.$mul) {\n\t\t\t_.each(update.$mul, (value, field) => {\n\t\t\t\tlet curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined) {\n\t\t\t\t\tcurValue = 0;\n\t\t\t\t} else {\n\t\t\t\t\tcurValue *= value;\n\t\t\t\t}\n\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t});\n\t\t}\n\n\t\tif (update.$rename) {\n\t\t\t_.each(update.$rename, (value, field) => {\n\t\t\t\tconst curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue !== undefined) {\n\t\t\t\t\tobjectPath.set(record, value, curValue);\n\t\t\t\t\tobjectPath.del(record, field);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$pullAll) {\n\t\t\t_.each(update.$pullAll, (value, field) => {\n\t\t\t\tlet curValue = objectPath.get(record, field);\n\t\t\t\tif (Array.isArray(curValue)) {\n\t\t\t\t\tcurValue = _.difference(curValue, value);\n\t\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$pop) {\n\t\t\t_.each(update.$pop, (value, field) => {\n\t\t\t\tconst curValue = objectPath.get(record, field);\n\t\t\t\tif (Array.isArray(curValue)) {\n\t\t\t\t\tif (value === -1) {\n\t\t\t\t\t\tcurValue.shift();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurValue.pop();\n\t\t\t\t\t}\n\t\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$addToSet) {\n\t\t\t_.each(update.$addToSet, (value, field) => {\n\t\t\t\tlet curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined) {\n\t\t\t\t\tcurValue = [];\n\t\t\t\t}\n\t\t\t\tif (Array.isArray(curValue)) {\n\t\t\t\t\tconst length = curValue.length;\n\n\t\t\t\t\tif (value && value.$each && Array.isArray(value.$each)) {\n\t\t\t\t\t\tfor (const valueItem of value.$each) {\n\t\t\t\t\t\t\tif (curValue.indexOf(valueItem) === -1) {\n\t\t\t\t\t\t\t\tcurValue.push(valueItem);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (curValue.indexOf(value) === -1) {\n\t\t\t\t\t\tcurValue.push(value);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (curValue.length > length) {\n\t\t\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.collection.update(record);\n\t\tthis.addToAllIndexes(record);\n\n\t\tif (updatedFields.length > 0) {\n\t\t\tthis.emit('updated', record, record);\n\t\t}\n\t}\n\n\tupdate(query, update, options = {}) {\n\t\tlet records = options.multi ? this.find(query).fetch() : this.findOne(query) || [];\n\t\tif (!Array.isArray(records)) {\n\t\t\trecords = [records];\n\t\t}\n\n\t\tfor (const record of records) {\n\t\t\tthis.updateRecord(record, update);\n\t\t}\n\t}\n\n\tremoveById(id) {\n\t\tconst record = this._findByIndex('_id', id);\n\t\tif (record) {\n\t\t\tthis.emit('beforeremove', record);\n\t\t\tthis.collection.removeWhere({_id: id});\n\t\t\tthis.removeFromAllIndexes(record);\n\t\t\tthis.emit('removed', record);\n\t\t}\n\t}\n}\n\nexport default ModelsBaseCache;\n","/* globals MongoInternals */\nimport _ from 'underscore';\n\nconst baseName = 'rocketchat_';\nimport {EventEmitter} from 'events';\n\nconst trash = new Mongo.Collection(`${ baseName }_trash`);\ntry {\n\ttrash._ensureIndex({ collection: 1 });\n\ttrash._ensureIndex({ _deletedAt: 1 }, { expireAfterSeconds: 60 * 60 * 24 * 30 });\n} catch (e) {\n\tconsole.log(e);\n}\n\nconst isOplogAvailable = MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle && !!MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry;\nlet isOplogEnabled = isOplogAvailable;\nRocketChat.settings.get('Force_Disable_OpLog_For_Cache', (key, value) => {\n\tisOplogEnabled = isOplogAvailable && value === false;\n});\n\nclass ModelsBaseDb extends EventEmitter {\n\tconstructor(model, baseModel) {\n\t\tsuper();\n\n\t\tif (Match.test(model, String)) {\n\t\t\tthis.name = model;\n\t\t\tthis.collectionName = this.baseName + this.name;\n\t\t\tthis.model = new Mongo.Collection(this.collectionName);\n\t\t} else {\n\t\t\tthis.name = model._name;\n\t\t\tthis.collectionName = this.name;\n\t\t\tthis.model = model;\n\t\t}\n\n\t\tthis.baseModel = baseModel;\n\n\t\tthis.wrapModel();\n\n\t\t// When someone start listening for changes we start oplog if available\n\t\tthis.once('newListener', (event/*, listener*/) => {\n\t\t\tif (event === 'change') {\n\t\t\t\tif (isOplogEnabled) {\n\t\t\t\t\tconst query = {\n\t\t\t\t\t\tcollection: this.collectionName\n\t\t\t\t\t};\n\n\t\t\t\t\tMongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry(query, this.processOplogRecord.bind(this));\n\t\t\t\t\tMongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle._defineTooFarBehind(Number.MAX_SAFE_INTEGER);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.tryEnsureIndex({ '_updatedAt': 1 });\n\t}\n\n\tget baseName() {\n\t\treturn baseName;\n\t}\n\n\tsetUpdatedAt(record = {}) {\n\n\t\t// TODO: Check if this can be deleted, Rodrigo does not rememebr WHY he added it. So he removed it to fix issue #5541\n\t\t// setUpdatedAt(record = {}, checkQuery = false, query) {\n\t\t// if (checkQuery === true) {\n\t\t// \tif (!query || Object.keys(query).length === 0) {\n\t\t// \t\tthrow new Meteor.Error('Models._Base: Empty query');\n\t\t// \t}\n\t\t// }\n\n\t\tif (/(^|,)\\$/.test(Object.keys(record).join(','))) {\n\t\t\trecord.$set = record.$set || {};\n\t\t\trecord.$set._updatedAt = new Date;\n\t\t} else {\n\t\t\trecord._updatedAt = new Date;\n\t\t}\n\n\t\treturn record;\n\t}\n\n\twrapModel() {\n\t\tthis.originals = {\n\t\t\tinsert: this.model.insert.bind(this.model),\n\t\t\tupdate: this.model.update.bind(this.model),\n\t\t\tremove: this.model.remove.bind(this.model)\n\t\t};\n\t\tconst self = this;\n\n\t\tthis.model.insert = function() {\n\t\t\treturn self.insert(...arguments);\n\t\t};\n\n\t\tthis.model.update = function() {\n\t\t\treturn self.update(...arguments);\n\t\t};\n\n\t\tthis.model.remove = function() {\n\t\t\treturn self.remove(...arguments);\n\t\t};\n\t}\n\n\tfind() {\n\t\treturn this.model.find(...arguments);\n\t}\n\n\tfindOne() {\n\t\treturn this.model.findOne(...arguments);\n\t}\n\n\tfindOneById(_id, options) {\n\t\treturn this.model.findOne({ _id }, options);\n\t}\n\n\tfindOneByIds(ids, options) {\n\t\treturn this.model.findOne({ _id: { $in: ids }}, options);\n\t}\n\n\tdefineSyncStrategy(query, modifier, options) {\n\t\tif (this.baseModel.useCache === false) {\n\t\t\treturn 'db';\n\t\t}\n\n\t\tif (options.upsert === true) {\n\t\t\treturn 'db';\n\t\t}\n\n\t\t// const dbModifiers = [\n\t\t// \t'$currentDate',\n\t\t// \t'$bit',\n\t\t// \t'$pull',\n\t\t// \t'$pushAll',\n\t\t// \t'$push',\n\t\t// \t'$setOnInsert'\n\t\t// ];\n\n\t\tconst cacheAllowedModifiers = [\n\t\t\t'$set',\n\t\t\t'$unset',\n\t\t\t'$min',\n\t\t\t'$max',\n\t\t\t'$inc',\n\t\t\t'$mul',\n\t\t\t'$rename',\n\t\t\t'$pullAll',\n\t\t\t'$pop',\n\t\t\t'$addToSet'\n\t\t];\n\n\t\tconst notAllowedModifiers = Object.keys(modifier).filter(i => i.startsWith('$') && cacheAllowedModifiers.includes(i) === false);\n\n\t\tif (notAllowedModifiers.length > 0) {\n\t\t\treturn 'db';\n\t\t}\n\n\t\tconst placeholderFields = Object.keys(query).filter(item => item.indexOf('$') > -1);\n\t\tif (placeholderFields.length > 0) {\n\t\t\treturn 'db';\n\t\t}\n\n\t\treturn 'cache';\n\t}\n\n\tupdateHasPositionalOperator(update) {\n\t\tfor (const key in update) {\n\t\t\tif (key.includes('.$')) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst value = update[key];\n\n\t\t\tif (Match.test(value, Object)) {\n\t\t\t\tif (this.updateHasPositionalOperator(value) === true) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprocessOplogRecord(action) {\n\t\tif (isOplogEnabled === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (action.op.op === 'i') {\n\t\t\tthis.emit('change', {\n\t\t\t\taction: 'insert',\n\t\t\t\tid: action.op.o._id,\n\t\t\t\tdata: action.op.o,\n\t\t\t\toplog: true\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (action.op.op === 'u') {\n\t\t\tif (!action.op.o.$set && !action.op.o.$unset) {\n\t\t\t\tthis.emit('change', {\n\t\t\t\t\taction: 'update:record',\n\t\t\t\t\tid: action.id,\n\t\t\t\t\tdata: action.op.o,\n\t\t\t\t\toplog: true\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst diff = {};\n\t\t\tif (action.op.o.$set) {\n\t\t\t\tfor (const key in action.op.o.$set) {\n\t\t\t\t\tif (action.op.o.$set.hasOwnProperty(key)) {\n\t\t\t\t\t\tdiff[key] = action.op.o.$set[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (action.op.o.$unset) {\n\t\t\t\tfor (const key in action.op.o.$unset) {\n\t\t\t\t\tif (action.op.o.$unset.hasOwnProperty(key)) {\n\t\t\t\t\t\tdiff[key] = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.emit('change', {\n\t\t\t\taction: 'update:diff',\n\t\t\t\tid: action.id,\n\t\t\t\tdata: diff,\n\t\t\t\toplog: true\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (action.op.op === 'd') {\n\t\t\tthis.emit('change', {\n\t\t\t\taction: 'remove',\n\t\t\t\tid: action.id,\n\t\t\t\toplog: true\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t}\n\n\tinsert(record) {\n\t\tthis.setUpdatedAt(record);\n\n\t\tconst result = this.originals.insert(...arguments);\n\t\tif (!isOplogEnabled && this.listenerCount('change') > 0) {\n\t\t\tthis.emit('change', {\n\t\t\t\taction: 'insert',\n\t\t\t\tid: result,\n\t\t\t\tdata: _.extend({}, record),\n\t\t\t\toplog: false\n\t\t\t});\n\t\t}\n\n\t\trecord._id = result;\n\n\t\treturn result;\n\t}\n\n\tupdate(query, update, options = {}) {\n\t\tthis.setUpdatedAt(update, true, query);\n\n\t\tconst strategy = this.defineSyncStrategy(query, update, options);\n\t\tlet ids = [];\n\t\tif (!isOplogEnabled && this.listenerCount('change') > 0 && strategy === 'db') {\n\t\t\tconst findOptions = {fields: {_id: 1}};\n\t\t\tlet records = options.multi ? this.find(query, findOptions).fetch() : this.findOne(query, findOptions) || [];\n\t\t\tif (!Array.isArray(records)) {\n\t\t\t\trecords = [records];\n\t\t\t}\n\n\t\t\tids = records.map(item => item._id);\n\t\t\tif (options.upsert !== true && this.updateHasPositionalOperator(update) === false) {\n\t\t\t\tquery = {\n\t\t\t\t\t_id: {\n\t\t\t\t\t\t$in: ids\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst result = this.originals.update(query, update, options);\n\n\t\tif (!isOplogEnabled && this.listenerCount('change') > 0) {\n\t\t\tif (strategy === 'db') {\n\t\t\t\tif (options.upsert === true) {\n\t\t\t\t\tif (result.insertedId) {\n\t\t\t\t\t\tthis.emit('change', {\n\t\t\t\t\t\t\taction: 'insert',\n\t\t\t\t\t\t\tid: result.insertedId,\n\t\t\t\t\t\t\tdata: this.findOne({_id: result.insertedId}),\n\t\t\t\t\t\t\toplog: false\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tquery = {\n\t\t\t\t\t\t_id: {\n\t\t\t\t\t\t\t$in: ids\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlet records = options.multi ? this.find(query).fetch() : this.findOne(query) || [];\n\t\t\t\tif (!Array.isArray(records)) {\n\t\t\t\t\trecords = [records];\n\t\t\t\t}\n\t\t\t\tfor (const record of records) {\n\t\t\t\t\tthis.emit('change', {\n\t\t\t\t\t\taction: 'update:record',\n\t\t\t\t\t\tid: record._id,\n\t\t\t\t\t\tdata: record,\n\t\t\t\t\t\toplog: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.emit('change', {\n\t\t\t\t\taction: 'update:query',\n\t\t\t\t\tid: undefined,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tquery,\n\t\t\t\t\t\tupdate,\n\t\t\t\t\t\toptions\n\t\t\t\t\t},\n\t\t\t\t\toplog: false\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tupsert(query, update, options = {}) {\n\t\toptions.upsert = true;\n\t\toptions._returnObject = true;\n\t\treturn this.update(query, update, options);\n\t}\n\n\tremove(query) {\n\t\tconst records = this.model.find(query).fetch();\n\n\t\tconst ids = [];\n\t\tfor (const record of records) {\n\t\t\tids.push(record._id);\n\n\t\t\trecord._deletedAt = new Date;\n\t\t\trecord.__collection__ = this.name;\n\n\t\t\ttrash.upsert({_id: record._id}, _.omit(record, '_id'));\n\t\t}\n\n\t\tquery = { _id: { $in: ids } };\n\n\t\tconst result = this.originals.remove(query);\n\n\t\tif (!isOplogEnabled && this.listenerCount('change') > 0) {\n\t\t\tfor (const record of records) {\n\t\t\t\tthis.emit('change', {\n\t\t\t\t\taction: 'remove',\n\t\t\t\t\tid: record._id,\n\t\t\t\t\tdata: _.extend({}, record),\n\t\t\t\t\toplog: false\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinsertOrUpsert(...args) {\n\t\tif (args[0] && args[0]._id) {\n\t\t\tconst _id = args[0]._id;\n\t\t\tdelete args[0]._id;\n\t\t\targs.unshift({\n\t\t\t\t_id\n\t\t\t});\n\n\t\t\tthis.upsert(...args);\n\t\t\treturn _id;\n\t\t} else {\n\t\t\treturn this.insert(...args);\n\t\t}\n\t}\n\n\tallow() {\n\t\treturn this.model.allow(...arguments);\n\t}\n\n\tdeny() {\n\t\treturn this.model.deny(...arguments);\n\t}\n\n\tensureIndex() {\n\t\treturn this.model._ensureIndex(...arguments);\n\t}\n\n\tdropIndex() {\n\t\treturn this.model._dropIndex(...arguments);\n\t}\n\n\ttryEnsureIndex() {\n\t\ttry {\n\t\t\treturn this.ensureIndex(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Error creating index:', this.name, '->', ...arguments, e);\n\t\t}\n\t}\n\n\ttryDropIndex() {\n\t\ttry {\n\t\t\treturn this.dropIndex(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Error dropping index:', this.name, '->', ...arguments, e);\n\t\t}\n\t}\n\n\ttrashFind(query, options) {\n\t\tquery.__collection__ = this.name;\n\n\t\treturn trash.find(query, options);\n\t}\n\n\ttrashFindDeletedAfter(deletedAt, query = {}, options) {\n\t\tquery.__collection__ = this.name;\n\t\tquery._deletedAt = {\n\t\t\t$gt: deletedAt\n\t\t};\n\n\t\treturn trash.find(query, options);\n\t}\n}\n\nexport default ModelsBaseDb;\n","import _ from 'underscore';\n\nconst AccessTokenServices = {};\n\nRocketChat.registerAccessTokenService = function(serviceName, handleAccessTokenRequest) {\n\tAccessTokenServices[serviceName] = {\n\t\tserviceName,\n\t\thandleAccessTokenRequest\n\t};\n};\n\n// Listen to calls to `login` with an oauth option set. This is where\n// users actually get logged in to meteor via oauth.\nAccounts.registerLoginHandler(function(options) {\n\tif (!options.accessToken) {\n\t\treturn undefined; // don't handle\n\t}\n\n\tcheck(options, Match.ObjectIncluding({\n\t\tserviceName: String\n\t}));\n\n\tconst service = AccessTokenServices[options.serviceName];\n\n\t// Skip everything if there's no service set by the oauth middleware\n\tif (!service) {\n\t\tthrow new Error(`Unexpected AccessToken service ${ options.serviceName }`);\n\t}\n\n\t// Make sure we're configured\n\tif (!ServiceConfiguration.configurations.findOne({service: service.serviceName})) {\n\t\tthrow new ServiceConfiguration.ConfigError();\n\t}\n\n\tif (!_.contains(Accounts.oauth.serviceNames(), service.serviceName)) {\n\t\t// serviceName was not found in the registered services list.\n\t\t// This could happen because the service never registered itself or\n\t\t// unregisterService was called on it.\n\t\treturn {\n\t\t\ttype: 'oauth',\n\t\t\terror: new Meteor.Error(\n\t\t\t\tAccounts.LoginCancelledError.numericError,\n\t\t\t\t`No registered oauth service found for: ${ service.serviceName }`\n\t\t\t)\n\t\t};\n\t}\n\n\tconst oauthResult = service.handleAccessTokenRequest(options);\n\n\treturn Accounts.updateOrCreateUserFromExternalService(service.serviceName, oauthResult.serviceData, oauthResult.options);\n});\n\n\n\n","/* globals Google */\nimport _ from 'underscore';\n\nfunction getIdentity(accessToken) {\n\ttry {\n\t\treturn HTTP.get(\n\t\t\t'https://www.googleapis.com/oauth2/v1/userinfo',\n\t\t\t{params: {access_token: accessToken}}).data;\n\t} catch (err) {\n\t\tthrow _.extend(new Error(`Failed to fetch identity from Google. ${ err.message }`), {response: err.response});\n\t}\n}\n\nfunction getScopes(accessToken) {\n\ttry {\n\t\treturn HTTP.get(\n\t\t\t'https://www.googleapis.com/oauth2/v1/tokeninfo',\n\t\t\t{params: {access_token: accessToken}}).data.scope.split(' ');\n\t} catch (err) {\n\t\tthrow _.extend(new Error(`Failed to fetch tokeninfo from Google. ${ err.message }`), {response: err.response});\n\t}\n}\n\n\nRocketChat.registerAccessTokenService('google', function(options) {\n\tcheck(options, Match.ObjectIncluding({\n\t\taccessToken: String,\n\t\tidToken: String,\n\t\texpiresIn: Match.Integer,\n\t\tscope: Match.Maybe(String),\n\t\tidentity: Match.Maybe(Object)\n\t}));\n\n\tconst identity = options.identity || getIdentity(options.accessToken);\n\n\tconst serviceData = {\n\t\taccessToken: options.accessToken,\n\t\tidToken: options.idToken,\n\t\texpiresAt: (+new Date) + (1000 * parseInt(options.expiresIn, 10)),\n\t\tscope: options.scopes || getScopes(options.accessToken)\n\t};\n\n\tconst fields = _.pick(identity, Google.whitelistedFields);\n\t_.extend(serviceData, fields);\n\n\t// only set the token in serviceData if it's there. this ensures\n\t// that we don't lose old ones (since we only get this on the first\n\t// log in attempt)\n\tif (options.refreshToken) {\n\t\tserviceData.refreshToken = options.refreshToken;\n\t}\n\n\treturn {\n\t\tserviceData,\n\t\toptions: {\n\t\t\tprofile: {\n\t\t\t\tname: identity.name\n\t\t\t}\n\t\t}\n\t};\n});\n","/* globals OAuth */\nimport _ from 'underscore';\n\nOAuth._redirectUri = _.wrap(OAuth._redirectUri, function(func, serviceName, ...args) {\n\tconst proxy = RocketChat.settings.get('Accounts_OAuth_Proxy_services').replace(/\\s/g, '').split(',');\n\tif (proxy.includes(serviceName)) {\n\t\treturn `${ RocketChat.settings.get('Accounts_OAuth_Proxy_host') }/oauth_redirect`;\n\t} else {\n\t\treturn func(serviceName, ...args);\n\t}\n\n});\n","RocketChat.statsTracker = new (class StatsTracker {\n\tconstructor() {\n\t\tthis.StatsD = Npm.require('node-dogstatsd').StatsD;\n\t\tthis.dogstatsd = new this.StatsD();\n\t}\n\n\ttrack(type, stats, ...args) {\n\t\tthis.dogstatsd[type](`RocketChat.${ stats }`, ...args);\n\t}\n\n\tnow() {\n\t\tconst hrtime = process.hrtime();\n\t\treturn (hrtime[0] * 1000000 + hrtime[1] / 1000);\n\t}\n\n\ttiming(stats, time, tags) {\n\t\tthis.track('timing', stats, time, tags);\n\t}\n\n\tincrement(stats, time, tags) {\n\t\tthis.track('increment', stats, time, tags);\n\t}\n\n\tdecrement(stats, time, tags) {\n\t\tthis.track('decrement', stats, time, tags);\n\t}\n\n\thistogram(stats, time, tags) {\n\t\tthis.track('histogram', stats, time, tags);\n\t}\n\n\tgauge(stats, time, tags) {\n\t\tthis.track('gauge', stats, time, tags);\n\t}\n\n\tunique(stats, time, tags) {\n\t\tthis.track('unique', stats, time, tags);\n\t}\n\n\tset(stats, time, tags) {\n\t\tthis.track('set', stats, time, tags);\n\t}\n});\n","RocketChat.models.Rooms.cache.hasMany('Subscriptions', {\n\tfield: 'usernames',\n\tlink: {\n\t\tlocal: '_id',\n\t\tremote: 'rid',\n\t\ttransform(room, subscription) {\n\t\t\treturn subscription.u.username;\n\t\t},\n\t\tremove(arr, subscription) {\n\t\t\tif (arr.indexOf(subscription.u.username) > -1) {\n\t\t\t\tarr.splice(arr.indexOf(subscription.u.username), 1);\n\t\t\t}\n\t\t}\n\t}\n});\n\n\nRocketChat.models.Subscriptions.cache.hasOne('Rooms', {\n\tfield: '_room',\n\tlink: {\n\t\tlocal: 'rid',\n\t\tremote: '_id'\n\t}\n});\n\n\nRocketChat.models.Subscriptions.cache.hasOne('Users', {\n\tfield: '_user',\n\tlink: {\n\t\tlocal: 'u._id',\n\t\tremote: '_id'\n\t}\n});\n\nRocketChat.models.Subscriptions.cache.hasOne('Users', {\n\tfield: 'fname',\n\tlink: {\n\t\tlocal: 'name',\n\t\tremote: 'username',\n\t\twhere(subscription/*, user*/) {\n\t\t\treturn subscription.t === 'd';\n\t\t},\n\t\ttransform(subscription, user) {\n\t\t\tif (user == null || subscription == null) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\t// Prevent client cache for old subscriptions with new names\n\t\t\t// Cuz when a user change his name, the subscription's _updateAt\n\t\t\t// will not change\n\t\t\tif (subscription._updatedAt < user._updatedAt) {\n\t\t\t\tsubscription._updatedAt = user._updatedAt;\n\t\t\t}\n\t\t\treturn user.name;\n\t\t}\n\t}\n});\n\nRocketChat.models.Users.cache.load();\nRocketChat.models.Rooms.cache.load();\nRocketChat.models.Subscriptions.cache.load();\nRocketChat.models.Settings.cache.load();\n\n\nRocketChat.models.Users.cache.addDynamicView('highlights').applyFind({\n\t'settings.preferences.highlights': {$size: {$gt: 0}}\n});\n\nRocketChat.models.Subscriptions.cache.addDynamicView('notifications').applyFind({\n\t$or: [\n\t\t{desktopNotifications: {$in: ['all', 'nothing']}},\n\t\t{mobilePushNotifications: {$in: ['all', 'nothing']}}\n\t]\n});\n","/* globals WebAppInternals*/\nimport _ from 'underscore';\n\nfunction testWebAppInternals(fn) {\n\ttypeof WebAppInternals !== 'undefined' && fn(WebAppInternals);\n}\nRocketChat.settings.onload('CDN_PREFIX', function(key, value) {\n\tif (_.isString(value) && value.trim()) {\n\t\treturn testWebAppInternals(WebAppInternals => WebAppInternals.setBundledJsCssPrefix(value));\n\t}\n});\n\nMeteor.startup(function() {\n\tconst value = RocketChat.settings.get('CDN_PREFIX');\n\tif (_.isString(value) && value.trim()) {\n\t\treturn testWebAppInternals(WebAppInternals => WebAppInternals.setBundledJsCssPrefix(value));\n\t}\n});\n","import _ from 'underscore';\nimport { IMAPIntercepter } from '../lib/interceptDirectReplyEmails.js';\nimport { POP3Helper } from '../lib/interceptDirectReplyEmails.js';\n\nconst startEmailIntercepter = _.debounce(Meteor.bindEnvironment(function() {\n\tconsole.log('Starting Email Intercepter...');\n\n\tif (RocketChat.settings.get('Direct_Reply_Enable') && RocketChat.settings.get('Direct_Reply_Protocol') && RocketChat.settings.get('Direct_Reply_Host') && RocketChat.settings.get('Direct_Reply_Port') && RocketChat.settings.get('Direct_Reply_Username') && RocketChat.settings.get('Direct_Reply_Password')) {\n\t\tif (RocketChat.settings.get('Direct_Reply_Protocol') === 'IMAP') {\n\t\t\t// stop already running IMAP instance\n\t\t\tif (RocketChat.IMAP && RocketChat.IMAP.isActive()) {\n\t\t\t\tconsole.log('Disconnecting already running IMAP instance...');\n\t\t\t\tRocketChat.IMAP.stop(Meteor.bindEnvironment(function() {\n\t\t\t\t\tconsole.log('Starting new IMAP instance......');\n\t\t\t\t\tRocketChat.IMAP = new IMAPIntercepter();\n\t\t\t\t\tRocketChat.IMAP.start();\n\t\t\t\t\treturn true;\n\t\t\t\t}));\n\t\t\t} else if (RocketChat.POP3 && RocketChat.POP3Helper && RocketChat.POP3Helper.isActive()) {\n\t\t\t\tconsole.log('Disconnecting already running POP instance...');\n\t\t\t\tRocketChat.POP3Helper.stop(Meteor.bindEnvironment(function() {\n\t\t\t\t\tconsole.log('Starting new IMAP instance......');\n\t\t\t\t\tRocketChat.IMAP = new IMAPIntercepter();\n\t\t\t\t\tRocketChat.IMAP.start();\n\t\t\t\t\treturn true;\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tconsole.log('Starting new IMAP instance......');\n\t\t\t\tRocketChat.IMAP = new IMAPIntercepter();\n\t\t\t\tRocketChat.IMAP.start();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else if (RocketChat.settings.get('Direct_Reply_Protocol') === 'POP') {\n\t\t\t// stop already running POP instance\n\t\t\tif (RocketChat.POP3 && RocketChat.POP3Helper && RocketChat.POP3Helper.isActive()) {\n\t\t\t\tconsole.log('Disconnecting already running POP instance...');\n\t\t\t\tRocketChat.POP3Helper.stop(Meteor.bindEnvironment(function() {\n\t\t\t\t\tconsole.log('Starting new POP instance......');\n\t\t\t\t\tRocketChat.POP3Helper = new POP3Helper();\n\t\t\t\t\tRocketChat.POP3Helper.start();\n\t\t\t\t\treturn true;\n\t\t\t\t}));\n\t\t\t} else if (RocketChat.IMAP && RocketChat.IMAP.isActive()) {\n\t\t\t\tconsole.log('Disconnecting already running IMAP instance...');\n\t\t\t\tRocketChat.IMAP.stop(Meteor.bindEnvironment(function() {\n\t\t\t\t\tconsole.log('Starting new POP instance......');\n\t\t\t\t\tRocketChat.POP3Helper = new POP3Helper();\n\t\t\t\t\tRocketChat.POP3Helper.start();\n\t\t\t\t\treturn true;\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tconsole.log('Starting new POP instance......');\n\t\t\t\tRocketChat.POP3Helper = new POP3Helper();\n\t\t\t\tRocketChat.POP3Helper.start();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t} else if (RocketChat.IMAP && RocketChat.IMAP.isActive()) {\n\t\t// stop IMAP instance\n\t\tRocketChat.IMAP.stop();\n\t} else if (RocketChat.POP3 && RocketChat.POP3Helper.isActive()) {\n\t\t// stop POP3 instance\n\t\tRocketChat.POP3Helper.stop();\n\t}\n}), 1000);\n\nRocketChat.settings.onload(/^Direct_Reply_.+/, startEmailIntercepter);\n","import _ from 'underscore';\n\nconst buildMailURL = _.debounce(function() {\n\tconsole.log('Updating process.env.MAIL_URL');\n\n\tif (RocketChat.settings.get('SMTP_Host')) {\n\t\tprocess.env.MAIL_URL = `${ RocketChat.settings.get('SMTP_Protocol') }://`;\n\n\t\tif (RocketChat.settings.get('SMTP_Username') && RocketChat.settings.get('SMTP_Password')) {\n\t\t\tprocess.env.MAIL_URL += `${ encodeURIComponent(RocketChat.settings.get('SMTP_Username')) }:${ encodeURIComponent(RocketChat.settings.get('SMTP_Password')) }@`;\n\t\t}\n\n\t\tprocess.env.MAIL_URL += encodeURIComponent(RocketChat.settings.get('SMTP_Host'));\n\n\t\tif (RocketChat.settings.get('SMTP_Port')) {\n\t\t\tprocess.env.MAIL_URL += `:${ parseInt(RocketChat.settings.get('SMTP_Port')) }`;\n\t\t}\n\n\t\tprocess.env.MAIL_URL += `?pool=${ RocketChat.settings.get('SMTP_Pool') }`;\n\n\t\tif (RocketChat.settings.get('SMTP_Protocol') === 'smtp' && RocketChat.settings.get('SMTP_IgnoreTLS')) {\n\t\t\tprocess.env.MAIL_URL += '&secure=false&ignoreTLS=true';\n\t\t}\n\n\t\treturn process.env.MAIL_URL;\n\t}\n}, 500);\n\nRocketChat.settings.onload('SMTP_Host', function(key, value) {\n\tif (_.isString(value)) {\n\t\treturn buildMailURL();\n\t}\n});\n\nRocketChat.settings.onload('SMTP_Port', function() {\n\treturn buildMailURL();\n});\n\nRocketChat.settings.onload('SMTP_Username', function(key, value) {\n\tif (_.isString(value)) {\n\t\treturn buildMailURL();\n\t}\n});\n\nRocketChat.settings.onload('SMTP_Password', function(key, value) {\n\tif (_.isString(value)) {\n\t\treturn buildMailURL();\n\t}\n});\n\nRocketChat.settings.onload('SMTP_Protocol', function() {\n\treturn buildMailURL();\n});\n\nRocketChat.settings.onload('SMTP_Pool', function() {\n\treturn buildMailURL();\n});\n\nRocketChat.settings.onload('SMTP_IgnoreTLS', function() {\n\treturn buildMailURL();\n});\n\nMeteor.startup(function() {\n\treturn buildMailURL();\n});\n","/* globals CustomOAuth */\nimport _ from 'underscore';\n\nconst logger = new Logger('rocketchat:lib', {\n\tmethods: {\n\t\toauth_updated: {\n\t\t\ttype: 'info'\n\t\t}\n\t}\n});\n\nfunction _OAuthServicesUpdate() {\n\tconst services = RocketChat.settings.get(/^(Accounts_OAuth_|Accounts_OAuth_Custom-)[a-z0-9_]+$/i);\n\tservices.forEach((service) => {\n\t\tlogger.oauth_updated(service.key);\n\t\tlet serviceName = service.key.replace('Accounts_OAuth_', '');\n\t\tif (serviceName === 'Meteor') {\n\t\t\tserviceName = 'meteor-developer';\n\t\t}\n\t\tif (/Accounts_OAuth_Custom-/.test(service.key)) {\n\t\t\tserviceName = service.key.replace('Accounts_OAuth_Custom-', '');\n\t\t}\n\t\tif (service.value === true) {\n\t\t\tconst data = {\n\t\t\t\tclientId: RocketChat.settings.get(`${ service.key }_id`),\n\t\t\t\tsecret: RocketChat.settings.get(`${ service.key }_secret`)\n\t\t\t};\n\t\t\tif (/Accounts_OAuth_Custom-/.test(service.key)) {\n\t\t\t\tdata.custom = true;\n\t\t\t\tdata.clientId = RocketChat.settings.get(`${ service.key }-id`);\n\t\t\t\tdata.secret = RocketChat.settings.get(`${ service.key }-secret`);\n\t\t\t\tdata.serverURL = RocketChat.settings.get(`${ service.key }-url`);\n\t\t\t\tdata.tokenPath = RocketChat.settings.get(`${ service.key }-token_path`);\n\t\t\t\tdata.identityPath = RocketChat.settings.get(`${ service.key }-identity_path`);\n\t\t\t\tdata.authorizePath = RocketChat.settings.get(`${ service.key }-authorize_path`);\n\t\t\t\tdata.scope = RocketChat.settings.get(`${ service.key }-scope`);\n\t\t\t\tdata.buttonLabelText = RocketChat.settings.get(`${ service.key }-button_label_text`);\n\t\t\t\tdata.buttonLabelColor = RocketChat.settings.get(`${ service.key }-button_label_color`);\n\t\t\t\tdata.loginStyle = RocketChat.settings.get(`${ service.key }-login_style`);\n\t\t\t\tdata.buttonColor = RocketChat.settings.get(`${ service.key }-button_color`);\n\t\t\t\tdata.tokenSentVia = RocketChat.settings.get(`${ service.key }-token_sent_via`);\n\t\t\t\tdata.identityTokenSentVia = RocketChat.settings.get(`${ service.key }-identity_token_sent_via`);\n\t\t\t\tdata.usernameField = RocketChat.settings.get(`${ service.key }-username_field`);\n\t\t\t\tdata.mergeUsers = RocketChat.settings.get(`${ service.key }-merge_users`);\n\t\t\t\tnew CustomOAuth(serviceName.toLowerCase(), {\n\t\t\t\t\tserverURL: data.serverURL,\n\t\t\t\t\ttokenPath: data.tokenPath,\n\t\t\t\t\tidentityPath: data.identityPath,\n\t\t\t\t\tauthorizePath: data.authorizePath,\n\t\t\t\t\tscope: data.scope,\n\t\t\t\t\tloginStyle: data.loginStyle,\n\t\t\t\t\ttokenSentVia: data.tokenSentVia,\n\t\t\t\t\tidentityTokenSentVia: data.identityTokenSentVia,\n\t\t\t\t\tusernameField: data.usernameField,\n\t\t\t\t\tmergeUsers: data.mergeUsers\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (serviceName === 'Facebook') {\n\t\t\t\tdata.appId = data.clientId;\n\t\t\t\tdelete data.clientId;\n\t\t\t}\n\t\t\tif (serviceName === 'Twitter') {\n\t\t\t\tdata.consumerKey = data.clientId;\n\t\t\t\tdelete data.clientId;\n\t\t\t}\n\t\t\tServiceConfiguration.configurations.upsert({\n\t\t\t\tservice: serviceName.toLowerCase()\n\t\t\t}, {\n\t\t\t\t$set: data\n\t\t\t});\n\t\t} else {\n\t\t\tServiceConfiguration.configurations.remove({\n\t\t\t\tservice: serviceName.toLowerCase()\n\t\t\t});\n\t\t}\n\t});\n}\n\nconst OAuthServicesUpdate = _.debounce(Meteor.bindEnvironment(_OAuthServicesUpdate), 2000);\n\nfunction OAuthServicesRemove(_id) {\n\tconst serviceName = _id.replace('Accounts_OAuth_Custom-', '');\n\treturn ServiceConfiguration.configurations.remove({\n\t\tservice: serviceName.toLowerCase()\n\t});\n}\n\nRocketChat.settings.get(/^Accounts_OAuth_.+/, function() {\n\treturn OAuthServicesUpdate(); // eslint-disable-line new-cap\n});\n\nRocketChat.settings.get(/^Accounts_OAuth_Custom-[a-z0-9_]+/, function(key, value) {\n\tif (!value) {\n\t\treturn OAuthServicesRemove(key);// eslint-disable-line new-cap\n\t}\n});\n","// Insert server unique id if it doesn't exist\nRocketChat.settings.add('uniqueID', process.env.DEPLOYMENT_ID || Random.id(), {\n\t'public': true,\n\thidden: true\n});\n\n// When you define a setting and want to add a description, you don't need to automatically define the i18nDescription\n// if you add a node to the i18n.json with the same setting name but with `_Description` it will automatically work.\n\nRocketChat.settings.addGroup('Accounts', function() {\n\tthis.add('Accounts_AllowAnonymousRead', false, {\n\t\ttype: 'boolean',\n\t\tpublic: true\n\t});\n\tthis.add('Accounts_AllowAnonymousWrite', false, {\n\t\ttype: 'boolean',\n\t\tpublic: true,\n\t\tenableQuery: {\n\t\t\t_id: 'Accounts_AllowAnonymousRead',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.add('Accounts_AllowDeleteOwnAccount', false, {\n\t\ttype: 'boolean',\n\t\t'public': true,\n\t\tenableQuery: {\n\t\t\t_id: 'Accounts_AllowUserProfileChange',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.add('Accounts_AllowUserProfileChange', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_AllowUserAvatarChange', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_AllowRealNameChange', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_AllowUsernameChange', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_AllowEmailChange', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_AllowPasswordChange', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_CustomFieldsToShowInUserInfo', '', {\n\t\ttype: 'string',\n\t\tpublic: true\n\t});\n\tthis.add('Accounts_LoginExpiration', 90, {\n\t\ttype: 'int',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_ShowFormLogin', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_EmailOrUsernamePlaceholder', '', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nLabel: 'Placeholder_for_email_or_username_login_field'\n\t});\n\tthis.add('Accounts_PasswordPlaceholder', '', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nLabel: 'Placeholder_for_password_login_field'\n\t});\n\tthis.add('Accounts_ForgetUserSessionOnWindowClose', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_SearchFields', 'username, name, emails.address', {\n\t\ttype: 'string',\n\t\tpublic: true\n\t});\n\n\tthis.section('Registration', function() {\n\t\tthis.add('Accounts_DefaultUsernamePrefixSuggestion', 'user', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Accounts_RequireNameForSignUp', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_RequirePasswordConfirmation', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_EmailVerification', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'SMTP_Host',\n\t\t\t\tvalue: {\n\t\t\t\t\t$exists: 1,\n\t\t\t\t\t$ne: ''\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.add('Accounts_ManuallyApproveNewUsers', false, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t\tthis.add('Accounts_AllowedDomainsList', '', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_BlockedDomainsList', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Accounts_BlockedUsernameList', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Accounts_UseDefaultBlockedDomainsList', true, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t\tthis.add('Accounts_UseDNSDomainCheck', false, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t\tthis.add('Accounts_RegistrationForm', 'Public', {\n\t\t\ttype: 'select',\n\t\t\t'public': true,\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'Public',\n\t\t\t\t\ti18nLabel: 'Accounts_RegistrationForm_Public'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'Disabled',\n\t\t\t\t\ti18nLabel: 'Accounts_RegistrationForm_Disabled'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'Secret URL',\n\t\t\t\t\ti18nLabel: 'Accounts_RegistrationForm_Secret_URL'\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\t\tthis.add('Accounts_RegistrationForm_SecretURL', Random.id(), {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Accounts_RegistrationForm_LinkReplacementText', 'New user registration is currently disabled', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_Registration_AuthenticationServices_Enabled', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_Registration_AuthenticationServices_Default_Roles', 'user', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_Registration_AuthenticationServices_Enabled',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\t\tthis.add('Accounts_PasswordReset', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_CustomFields', '', {\n\t\t\ttype: 'code',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Custom_Fields'\n\t\t});\n\t});\n\n\tthis.section('Accounts_Default_User_Preferences', function() {\n\t\tthis.add('Accounts_Default_User_Preferences_enableAutoAway', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Enable_Auto_Away'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_idleTimeoutLimit', 300000, {\n\t\t\ttype: 'int',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Idle_Time_Limit'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_desktopNotificationDuration', 0, {\n\t\t\ttype: 'int',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Notification_Duration'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_audioNotifications', 'mentions', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'all',\n\t\t\t\t\ti18nLabel: 'All_messages'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'mentions',\n\t\t\t\t\ti18nLabel: 'Mentions'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'nothing',\n\t\t\t\t\ti18nLabel: 'Nothing'\n\t\t\t\t}\n\t\t\t],\n\t\t\tpublic: true\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_desktopNotifications', 'mentions', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'all',\n\t\t\t\t\ti18nLabel: 'All_messages'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'mentions',\n\t\t\t\t\ti18nLabel: 'Mentions'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'nothing',\n\t\t\t\t\ti18nLabel: 'Nothing'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_mobileNotifications', 'mentions', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey : 'all',\n\t\t\t\t\ti18nLabel : 'All_messages'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey : 'mentions',\n\t\t\t\t\ti18nLabel : 'Mentions'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey : 'nothing',\n\t\t\t\t\ti18nLabel : 'Nothing'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_unreadAlert', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Unread_Tray_Icon_Alert'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_useEmojis', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Use_Emojis'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_convertAsciiEmoji', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Convert_Ascii_Emojis'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_autoImageLoad', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Auto_Load_Images'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_saveMobileBandwidth', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Save_Mobile_Bandwidth'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_collapseMediaByDefault', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Collapse_Embedded_Media_By_Default'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_hideUsernames', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Hide_usernames'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_hideRoles', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Hide_roles'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_hideFlexTab', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Hide_flextab'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_hideAvatars', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Hide_Avatars'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_roomsListExhibitionMode', 'category', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'unread',\n\t\t\t\t\ti18nLabel: 'Unread_Rooms_Mode'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'activity',\n\t\t\t\t\ti18nLabel: 'Sort_by_activity'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'category',\n\t\t\t\t\ti18nLabel: 'Split_by_categories'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Sidebar_list_mode'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_mergeChannels', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'UI_Merge_Channels_Groups'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_sendOnEnter', 'normal', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'normal',\n\t\t\t\t\ti18nLabel: 'Enter_Normal'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'alternative',\n\t\t\t\t\ti18nLabel: 'Enter_Alternative'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'desktop',\n\t\t\t\t\ti18nLabel: 'Only_On_Desktop'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Enter_Behaviour'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_viewMode', 0, {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 0,\n\t\t\t\t\ti18nLabel: 'Normal'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 1,\n\t\t\t\t\ti18nLabel: 'Cozy'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 2,\n\t\t\t\t\ti18nLabel: 'Compact'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'View_mode'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_emailNotificationMode', 'all', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'disabled',\n\t\t\t\t\ti18nLabel: 'Email_Notification_Mode_Disabled'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'all',\n\t\t\t\t\ti18nLabel: 'Email_Notification_Mode_All'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Email_Notification_Mode'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_roomCounterSidebar', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Show_room_counter_on_sidebar'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_newRoomNotification', 'door', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'none',\n\t\t\t\t\ti18nLabel: 'None'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'door',\n\t\t\t\t\ti18nLabel: 'Default'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'New_Room_Notification'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_newMessageNotification', 'chime', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'none',\n\t\t\t\t\ti18nLabel: 'None'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'chime',\n\t\t\t\t\ti18nLabel: 'Default'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'New_Message_Notification'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_notificationsSoundVolume', 100, {\n\t\t\ttype: 'int',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Notifications_Sound_Volume'\n\t\t});\n\t});\n\n\tthis.section('Avatar', function() {\n\t\tthis.add('Accounts_AvatarResize', true, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t\tthis.add('Accounts_AvatarSize', 200, {\n\t\t\ttype: 'int',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_AvatarResize',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\n\t\treturn this.add('Accounts_SetDefaultAvatar', true, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('OAuth', function() {\n\tthis.section('Facebook', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Facebook',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Facebook', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Facebook_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Facebook_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Facebook_callback_url', '_oauth/facebook', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('Google', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Google',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Google', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Google_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Google_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Google_callback_url', '_oauth/google', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('GitHub', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Github',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Github', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Github_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Github_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Github_callback_url', '_oauth/github', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('Linkedin', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Linkedin',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Linkedin', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Linkedin_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Linkedin_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Linkedin_callback_url', '_oauth/linkedin', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('Meteor', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Meteor',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Meteor', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Meteor_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Meteor_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Meteor_callback_url', '_oauth/meteor', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('Twitter', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Twitter',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Twitter', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Twitter_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Twitter_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Twitter_callback_url', '_oauth/twitter', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\treturn this.section('Proxy', function() {\n\t\tthis.add('Accounts_OAuth_Proxy_host', 'https://oauth-proxy.rocket.chat', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Proxy_services', '', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('General', function() {\n\tthis.add('Site_Url', typeof __meteor_runtime_config__ !== 'undefined' && __meteor_runtime_config__ !== null ? __meteor_runtime_config__.ROOT_URL : null, {\n\t\ttype: 'string',\n\t\ti18nDescription: 'Site_Url_Description',\n\t\t'public': true\n\t});\n\tthis.add('Site_Name', 'Rocket.Chat', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Language', '', {\n\t\ttype: 'language',\n\t\t'public': true\n\t});\n\tthis.add('Allow_Invalid_SelfSigned_Certs', false, {\n\t\ttype: 'boolean'\n\t});\n\tthis.add('Favorite_Rooms', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('First_Channel_After_Login', '', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Unread_Count', 'user_and_group_mentions_only', {\n\t\ttype: 'select',\n\t\tvalues: [\n\t\t\t{\n\t\t\t\tkey: 'all_messages',\n\t\t\t\ti18nLabel: 'All_messages'\n\t\t\t}, {\n\t\t\t\tkey: 'user_mentions_only',\n\t\t\t\ti18nLabel: 'User_mentions_only'\n\t\t\t}, {\n\t\t\t\tkey: 'group_mentions_only',\n\t\t\t\ti18nLabel: 'Group_mentions_only'\n\t\t\t}, {\n\t\t\t\tkey: 'user_and_group_mentions_only',\n\t\t\t\ti18nLabel: 'User_and_group_mentions_only'\n\t\t\t}\n\t\t],\n\t\t'public': true\n\t});\n\tthis.add('Unread_Count_DM', 'all_messages', {\n\t\ttype: 'select',\n\t\tvalues: [\n\t\t\t{\n\t\t\t\tkey: 'all_messages',\n\t\t\t\ti18nLabel: 'All_messages'\n\t\t\t}, {\n\t\t\t\tkey: 'mentions_only',\n\t\t\t\ti18nLabel: 'Mentions_only'\n\t\t\t}\n\t\t],\n\t\t'public': true\n\t});\n\tthis.add('CDN_PREFIX', '', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Force_SSL', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('GoogleTagManager_id', '', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Bugsnag_api_key', '', {\n\t\ttype: 'string',\n\t\t'public': false\n\t});\n\tthis.add('Force_Disable_OpLog_For_Cache', false, {\n\t\ttype: 'boolean',\n\t\t'public': false\n\t});\n\tthis.add('Restart', 'restart_server', {\n\t\ttype: 'action',\n\t\tactionText: 'Restart_the_server'\n\t});\n\tthis.add('Store_Last_Message', false, {\n\t\ttype: 'boolean',\n\t\tpublic: true,\n\t\ti18nDescription: 'Store_Last_Message_Sent_per_Room'\n\t});\n\tthis.section('UTF8', function() {\n\t\tthis.add('UTF8_Names_Validation', '[0-9a-zA-Z-_.]+', {\n\t\t\ttype: 'string',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'UTF8_Names_Validation_Description'\n\t\t});\n\t\treturn this.add('UTF8_Names_Slugify', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t});\n\tthis.section('Reporting', function() {\n\t\treturn this.add('Statistics_reporting', true, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t});\n\tthis.section('Notifications', function() {\n\t\tthis.add('Notifications_Max_Room_Members', 100, {\n\t\t\ttype: 'int',\n\t\t\tpublic: true,\n\t\t\ti18nDescription: 'Notifications_Max_Room_Members_Description'\n\t\t});\n\n\t\tthis.add('Notifications_Always_Notify_Mobile', false, {\n\t\t\ttype: 'boolean',\n\t\t\tpublic: true,\n\t\t\ti18nDescription: 'Notifications_Always_Notify_Mobile_Description'\n\t\t});\n\t});\n\tthis.section('REST API', function() {\n\t\treturn this.add('API_User_Limit', 500, {\n\t\t\ttype: 'int',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'API_User_Limit'\n\t\t});\n\t});\n\tthis.section('Iframe_Integration', function() {\n\t\tthis.add('Iframe_Integration_send_enable', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Iframe_Integration_send_target_origin', '*', {\n\t\t\ttype: 'string',\n\t\t\t'public': true,\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Iframe_Integration_send_enable',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\t\tthis.add('Iframe_Integration_receive_enable', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Iframe_Integration_receive_origin', '*', {\n\t\t\ttype: 'string',\n\t\t\t'public': true,\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Iframe_Integration_receive_enable',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\t});\n\tthis.section('Translations', function() {\n\t\treturn this.add('Custom_Translations', '', {\n\t\t\ttype: 'code',\n\t\t\t'public': true\n\t\t});\n\t});\n\treturn this.section('Stream_Cast', function() {\n\t\treturn this.add('Stream_Cast_Address', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('Email', function() {\n\tthis.section('Subject', function() {\n\t\tthis.add('Offline_DM_Email', '[[Site_Name]] You have been direct messaged by [User]', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Offline_DM_Email',\n\t\t\ti18nDescription: 'Offline_Email_Subject_Description'\n\t\t});\n\t\tthis.add('Offline_Mention_Email', '[[Site_Name]] You have been mentioned by [User] in #[Room]', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Offline_Mention_Email',\n\t\t\ti18nDescription: 'Offline_Email_Subject_Description'\n\t\t});\n\t\treturn this.add('Offline_Mention_All_Email', '[User] has posted a message in #[Room]', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Offline_Mention_All_Email',\n\t\t\ti18nDescription: 'Offline_Email_Subject_Description'\n\t\t});\n\t});\n\tthis.section('Header_and_Footer', function() {\n\t\tthis.add('Email_Header', '<html><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" bgcolor=\"#f3f3f3\" style=\"color:#4a4a4a;font-family: Helvetica,Arial,sans-serif;font-size:14px;line-height:20px;border-collapse:collapse;border-spacing:0;margin:0 auto\"><tr><td style=\"padding:1em\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" width=\"100%\" style=\"width:100%;margin:0 auto;max-width:800px\"><tr><td bgcolor=\"#ffffff\" style=\"background-color:#ffffff; border: 1px solid #DDD; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\"><table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"background-color: #04436a;\"><h1 style=\"font-family: Helvetica,Arial,sans-serif; padding: 0 1em; margin: 0; line-height: 70px; color: #FFF;\">[Site_Name]</h1></td></tr><tr><td style=\"padding: 1em; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\">', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Header'\n\t\t});\n\t\tthis.add('Email_Footer', '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table></html>', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Footer'\n\t\t});\n\t\treturn this.add('Email_Footer_Direct_Reply', '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">You can directly reply to this email.<br>Do not modify previous emails in the thread.<br>Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table></html>', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Footer_Direct_Reply'\n\t\t});\n\t});\n\tthis.section('Direct_Reply', function() {\n\t\tthis.add('Direct_Reply_Enable', false, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Enable'\n\t\t});\n\t\tthis.add('Direct_Reply_Debug', false, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Debug',\n\t\t\ti18nDescription: 'Direct_Reply_Debug_Description'\n\t\t});\n\t\tthis.add('Direct_Reply_Protocol', 'IMAP', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'IMAP',\n\t\t\t\t\ti18nLabel: 'IMAP'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'POP',\n\t\t\t\t\ti18nLabel: 'POP'\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Protocol'\n\t\t});\n\t\tthis.add('Direct_Reply_Host', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Host'\n\t\t});\n\t\tthis.add('Direct_Reply_Port', '143', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: '143',\n\t\t\t\t\ti18nLabel: '143'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '993',\n\t\t\t\t\ti18nLabel: '993'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '110',\n\t\t\t\t\ti18nLabel: '110'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '995',\n\t\t\t\t\ti18nLabel: '995'\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Port'\n\t\t});\n\t\tthis.add('Direct_Reply_IgnoreTLS', false, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'IgnoreTLS'\n\t\t});\n\t\tthis.add('Direct_Reply_Frequency', 5, {\n\t\t\ttype: 'int',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Frequency',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Direct_Reply_Protocol',\n\t\t\t\tvalue: 'POP'\n\t\t\t}\n\t\t});\n\t\tthis.add('Direct_Reply_Delete', true, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Delete',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Direct_Reply_Protocol',\n\t\t\t\tvalue: 'IMAP'\n\t\t\t}\n\t\t});\n\t\tthis.add('Direct_Reply_Separator', '+', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: '!',\n\t\t\t\t\ti18nLabel: '!'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '#',\n\t\t\t\t\ti18nLabel: '#'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '$',\n\t\t\t\t\ti18nLabel: '$'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '%',\n\t\t\t\t\ti18nLabel: '%'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '&',\n\t\t\t\t\ti18nLabel: '&'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '\\'',\n\t\t\t\t\ti18nLabel: '\\''\n\t\t\t\t}, {\n\t\t\t\t\tkey: '*',\n\t\t\t\t\ti18nLabel: '*'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '+',\n\t\t\t\t\ti18nLabel: '+'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '-',\n\t\t\t\t\ti18nLabel: '-'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '/',\n\t\t\t\t\ti18nLabel: '/'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '=',\n\t\t\t\t\ti18nLabel: '='\n\t\t\t\t}, {\n\t\t\t\t\tkey: '?',\n\t\t\t\t\ti18nLabel: '?'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '^',\n\t\t\t\t\ti18nLabel: '^'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '_',\n\t\t\t\t\ti18nLabel: '_'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '`',\n\t\t\t\t\ti18nLabel: '`'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '{',\n\t\t\t\t\ti18nLabel: '{'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '|',\n\t\t\t\t\ti18nLabel: '|'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '}',\n\t\t\t\t\ti18nLabel: '}'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '~',\n\t\t\t\t\ti18nLabel: '~'\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Separator'\n\t\t});\n\t\tthis.add('Direct_Reply_Username', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Username',\n\t\t\tplaceholder: 'email@domain'\n\t\t});\n\t\treturn this.add('Direct_Reply_Password', '', {\n\t\t\ttype: 'password',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Password'\n\t\t});\n\t});\n\tthis.section('SMTP', function() {\n\t\tthis.add('SMTP_Protocol', 'smtp', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'smtp',\n\t\t\t\t\ti18nLabel: 'smtp'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'smtps',\n\t\t\t\t\ti18nLabel: 'smtps'\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Protocol'\n\t\t});\n\t\tthis.add('SMTP_Host', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Host'\n\t\t});\n\t\tthis.add('SMTP_Port', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Port'\n\t\t});\n\t\tthis.add('SMTP_IgnoreTLS', false, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'IgnoreTLS',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'SMTP_Protocol',\n\t\t\t\tvalue: 'smtp'\n\t\t\t}\n\t\t});\n\t\tthis.add('SMTP_Pool', true, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Pool'\n\t\t});\n\t\tthis.add('SMTP_Username', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Username'\n\t\t});\n\t\tthis.add('SMTP_Password', '', {\n\t\t\ttype: 'password',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Password'\n\t\t});\n\t\tthis.add('From_Email', '', {\n\t\t\ttype: 'string',\n\t\t\tplaceholder: 'email@domain'\n\t\t});\n\t\treturn this.add('SMTP_Test_Button', 'sendSMTPTestEmail', {\n\t\t\ttype: 'action',\n\t\t\tactionText: 'Send_a_test_mail_to_my_user'\n\t\t});\n\t});\n\tthis.section('Invitation', function() {\n\t\tthis.add('Invitation_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Invitation_Subject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Invitation_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Invitation_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Invitation_HTML', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\ti18nDescription: 'Invitation_HTML_Description',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Invitation_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Invitation_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n\tthis.section('Registration', function() {\n\t\tthis.add('Accounts_Enrollment_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Accounts_Enrollment_Email_Subject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_Enrollment_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Accounts_Enrollment_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Accounts_Enrollment_Email', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_Enrollment_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Accounts_Enrollment_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n\tthis.section('Registration_via_Admin', function() {\n\t\tthis.add('Accounts_UserAddedEmail_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Accounts_UserAddedEmailSubject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_UserAddedEmail_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Accounts_UserAddedEmail_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Accounts_UserAddedEmail', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\ti18nDescription: 'Accounts_UserAddedEmail_Description',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_UserAddedEmail_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Accounts_UserAddedEmail_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n\tthis.section('Forgot_password_section', function() {\n\t\tthis.add('Forgot_Password_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Forgot_Password_Email_Subject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Forgot_Password_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Forgot_Password_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Forgot_Password_Email', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\ti18nDescription: 'Forgot_Password_Description',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Forgot_Password_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Forgot_Password_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n\treturn this.section('Verification', function() {\n\t\tthis.add('Verification_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Verification_Email_Subject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Verification_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Verification_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Verification_Email', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\ti18nDescription: 'Verification_Description',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Verification_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Verification_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('Message', function() {\n\tthis.section('Message_Attachments', function() {\n\t\tthis.add('Message_Attachments_GroupAttach', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'Message_Attachments_GroupAttachDescription'\n\t\t});\n\t\tthis.add('Message_AudioRecorderEnabled', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'Message_AudioRecorderEnabledDescription'\n\t\t});\n\t});\n\tthis.add('Message_AllowEditing', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_AllowEditing_BlockEditInMinutes', 0, {\n\t\ttype: 'int',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_AllowEditing_BlockEditInMinutesDescription'\n\t});\n\tthis.add('Message_AllowDeleting', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_AllowDeleting_BlockDeleteInMinutes', 0, {\n\t\ttype: 'int',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_AllowDeleting_BlockDeleteInMinutes'\n\t});\n\tthis.add('Message_AllowUnrecognizedSlashCommand', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_AllowDirectMessagesToYourself', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_AlwaysSearchRegExp', false, {\n\t\ttype: 'boolean'\n\t});\n\tthis.add('Message_ShowEditedStatus', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_ShowDeletedStatus', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_AllowBadWordsFilter', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_BadWordsFilterList', '', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Message_KeepHistory', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_MaxAll', 0, {\n\t\ttype: 'int',\n\t\t'public': true\n\t});\n\tthis.add('Message_MaxAllowedSize', 5000, {\n\t\ttype: 'int',\n\t\t'public': true\n\t});\n\tthis.add('Message_ShowFormattingTips', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_SetNameToAliasEnabled', false, {\n\t\ttype: 'boolean',\n\t\t'public': false,\n\t\ti18nDescription: 'Message_SetNameToAliasEnabled_Description'\n\t});\n\tthis.add('Message_GroupingPeriod', 300, {\n\t\ttype: 'int',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_GroupingPeriodDescription'\n\t});\n\tthis.add('API_Embed', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('API_Embed_UserAgent', 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.0 Safari/537.36', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('API_EmbedCacheExpirationDays', 30, {\n\t\ttype: 'int',\n\t\t'public': false\n\t});\n\tthis.add('API_Embed_clear_cache_now', 'OEmbedCacheCleanup', {\n\t\ttype: 'action',\n\t\tactionText: 'clear',\n\t\ti18nLabel: 'clear_cache_now'\n\t});\n\tthis.add('API_EmbedDisabledFor', '', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nDescription: 'API_EmbedDisabledFor_Description'\n\t});\n\tthis.add('API_EmbedIgnoredHosts', 'localhost, 127.0.0.1, 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16', {\n\t\ttype: 'string',\n\t\ti18nDescription: 'API_EmbedIgnoredHosts_Description'\n\t});\n\tthis.add('API_EmbedSafePorts', '80, 443', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Message_TimeFormat', 'LT', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_TimeFormat_Description'\n\t});\n\tthis.add('Message_DateFormat', 'LL', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_DateFormat_Description'\n\t});\n\tthis.add('Message_TimeAndDateFormat', 'LLL', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_TimeAndDateFormat_Description'\n\t});\n\tthis.add('Message_QuoteChainLimit', 2, {\n\t\ttype: 'int',\n\t\t'public': true\n\t});\n\tthis.add('Message_HideType_uj', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_HideType_ul', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_HideType_ru', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_HideType_au', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\n\treturn this.add('Message_HideType_mute_unmute', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n});\n\nRocketChat.settings.addGroup('Meta', function() {\n\tthis.add('Meta_language', '', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Meta_fb_app_id', '', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Meta_robots', 'INDEX,FOLLOW', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Meta_google-site-verification', '', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Meta_msvalidate01', '', {\n\t\ttype: 'string'\n\t});\n\treturn this.add('Meta_custom', '', {\n\t\ttype: 'code',\n\t\tcode: 'text/html',\n\t\tmultiline: true\n\t});\n});\n\nRocketChat.settings.addGroup('Push', function() {\n\tthis.add('Push_enable', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Push_debug', false, {\n\t\ttype: 'boolean',\n\t\t'public': true,\n\t\tenableQuery: {\n\t\t\t_id: 'Push_enable',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.add('Push_enable_gateway', true, {\n\t\ttype: 'boolean',\n\t\tenableQuery: {\n\t\t\t_id: 'Push_enable',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.add('Push_gateway', 'https://gateway.rocket.chat', {\n\t\ttype: 'string',\n\t\tenableQuery: [\n\t\t\t{\n\t\t\t\t_id: 'Push_enable',\n\t\t\t\tvalue: true\n\t\t\t}, {\n\t\t\t\t_id: 'Push_enable_gateway',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t]\n\t});\n\tthis.add('Push_production', true, {\n\t\ttype: 'boolean',\n\t\t'public': true,\n\t\tenableQuery: [\n\t\t\t{\n\t\t\t\t_id: 'Push_enable',\n\t\t\t\tvalue: true\n\t\t\t}, {\n\t\t\t\t_id: 'Push_enable_gateway',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t]\n\t});\n\tthis.add('Push_test_push', 'push_test', {\n\t\ttype: 'action',\n\t\tactionText: 'Send_a_test_push_to_my_user',\n\t\tenableQuery: {\n\t\t\t_id: 'Push_enable',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.section('Certificates_and_Keys', function() {\n\t\tthis.add('Push_apn_passphrase', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Push_apn_key', '', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true\n\t\t});\n\t\tthis.add('Push_apn_cert', '', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true\n\t\t});\n\t\tthis.add('Push_apn_dev_passphrase', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Push_apn_dev_key', '', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true\n\t\t});\n\t\tthis.add('Push_apn_dev_cert', '', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true\n\t\t});\n\t\tthis.add('Push_gcm_api_key', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\treturn this.add('Push_gcm_project_number', '', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t});\n\treturn this.section('Privacy', function() {\n\t\tthis.add('Push_show_username_room', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Push_show_message', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('Layout', function() {\n\tthis.section('Content', function() {\n\t\tthis.add('Layout_Home_Title', 'Home', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Layout_Home_Body', 'Welcome to Rocket.Chat <br> Go to APP SETTINGS -> Layout to customize this intro.', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Layout_Terms_of_Service', 'Terms of Service <br> Go to APP SETTINGS -> Layout to customize this page.', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Layout_Login_Terms', 'By proceeding you are agreeing to our <a href=\"terms-of-service\">Terms of Service</a> and <a href=\"privacy-policy\">Privacy Policy</a>.', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Layout_Privacy_Policy', 'Privacy Policy <br> Go to APP SETTINGS -> Layout to customize this page.', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Layout_Sidenav_Footer', '<img src=\"assets/logo\" />', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'Layout_Sidenav_Footer_description'\n\t\t});\n\t});\n\tthis.section('Custom_Scripts', function() {\n\t\tthis.add('Custom_Script_Logged_Out', '//Add your script', {\n\t\t\ttype: 'code',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Custom_Script_Logged_In', '//Add your script', {\n\t\t\ttype: 'code',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t});\n\treturn this.section('User_Interface', function() {\n\t\tthis.add('UI_DisplayRoles', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Merge_Channels_Groups', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Use_Name_Avatar', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Use_Real_Name', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Click_Direct_Message', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Unread_Counter_Style', 'Different_Style_For_User_Mentions', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'Same_Style_For_Mentions',\n\t\t\t\t\ti18nLabel: 'Same_Style_For_Mentions'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'Different_Style_For_User_Mentions',\n\t\t\t\t\ti18nLabel: 'Different_Style_For_User_Mentions'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Allow_room_names_with_special_chars', false, {\n\t\t\ttype: 'boolean',\n\t\t\tpublic: true\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('Logs', function() {\n\tthis.add('Log_Level', '0', {\n\t\ttype: 'select',\n\t\tvalues: [\n\t\t\t{\n\t\t\t\tkey: '0',\n\t\t\t\ti18nLabel: '0_Errors_Only'\n\t\t\t}, {\n\t\t\t\tkey: '1',\n\t\t\t\ti18nLabel: '1_Errors_and_Information'\n\t\t\t}, {\n\t\t\t\tkey: '2',\n\t\t\t\ti18nLabel: '2_Erros_Information_and_Debug'\n\t\t\t}\n\t\t],\n\t\t'public': true\n\t});\n\tthis.add('Log_Package', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Log_File', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\treturn this.add('Log_View_Limit', 1000, {\n\t\ttype: 'int'\n\t});\n});\n\nRocketChat.settings.init();\n","import _ from 'underscore';\n\nMeteor.methods({\n\t'public-settings/get'(updatedAt) {\n\t\tthis.unblock();\n\t\tconst records = RocketChat.models.Settings.find().fetch().filter(function(record) {\n\t\t\treturn record.hidden !== true && record['public'] === true;\n\t\t});\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Settings.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\thidden: {\n\t\t\t\t\t\t$ne: true\n\t\t\t\t\t},\n\t\t\t\t\t'public': true\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1\n\t\t\t\t\t}\n\t\t\t\t}).fetch()\n\t\t\t};\n\t\t}\n\t\treturn records;\n\t},\n\t'private-settings/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn [];\n\t\t}\n\t\tthis.unblock();\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'view-privileged-setting')) {\n\t\t\treturn [];\n\t\t}\n\t\tconst records = RocketChat.models.Settings.find().fetch().filter(function(record) {\n\t\t\treturn record.hidden !== true;\n\t\t});\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Settings.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\thidden: {\n\t\t\t\t\t\t$ne: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1\n\t\t\t\t\t}\n\t\t\t\t}).fetch()\n\t\t\t};\n\t\t}\n\t\treturn records;\n\t}\n});\n\nRocketChat.models.Settings.cache.on('changed', function(type, setting) {\n\tif (setting['public'] === true) {\n\t\tRocketChat.Notifications.notifyAllInThisInstance('public-settings-changed', type, _.pick(setting, '_id', 'value', 'editor', 'properties'));\n\t}\n\treturn RocketChat.Notifications.notifyLoggedInThisInstance('private-settings-changed', type, setting);\n});\n\nRocketChat.Notifications.streamAll.allowRead('private-settings-changed', function() {\n\tif (this.userId == null) {\n\t\treturn false;\n\t}\n\treturn RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting');\n});\n","/* eslint no-multi-spaces: 0 */\n/* eslint comma-spacing: 0 */\nimport s from 'underscore.string';\n\nMeteor.methods({\n\taddOAuthService(name) {\n\n\t\tcheck(name, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'addOAuthService' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'add-oauth-service') !== true) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Adding OAuth Services is not allowed', { method: 'addOAuthService', action: 'Adding_OAuth_Services' });\n\t\t}\n\n\t\tname = name.toLowerCase().replace(/[^a-z0-9_]/g, '');\n\t\tname = s.capitalize(name);\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }`                        , false             , { type: 'boolean', group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Enable', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-url`                    , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'URL', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-token_path`             , '/oauth/token'    , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Token_Path', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-token_sent_via`         , 'payload'         , { type: 'select' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Token_Sent_Via', persistent: true, values: [ { key: 'header', i18nLabel: 'Header' }, { key: 'payload', i18nLabel: 'Payload' } ] });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-identity_token_sent_via`, 'default'         , { type: 'select' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Identity_Token_Sent_Via', persistent: true, values: [ { key: 'default', i18nLabel: 'Same_As_Token_Sent_Via' }, { key: 'header', i18nLabel: 'Header' }, { key: 'payload', i18nLabel: 'Payload' } ] });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-identity_path`          , '/me'             , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Identity_Path', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-authorize_path`         , '/oauth/authorize', { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Authorize_Path', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-scope`                  , 'openid'          , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Scope', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-id`                     , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_id', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-secret`                 , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Secret', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-login_style`            , 'popup'           , { type: 'select' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Login_Style', persistent: true, values: [ { key: 'redirect', i18nLabel: 'Redirect' }, { key: 'popup', i18nLabel: 'Popup' }, { key: '', i18nLabel: 'Default' } ] });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-button_label_text`      , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Button_Label_Text', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-button_label_color`     , '#FFFFFF'         , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Button_Label_Color', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-button_color`           , '#13679A'         , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Button_Color', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-username_field`         , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Username_Field', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-merge_users`            , false             , { type: 'boolean', group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Merge_Users', persistent: true });\n\t}});\n","Meteor.methods({\n\trefreshOAuthService() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'refreshOAuthService' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'add-oauth-service') !== true) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Refresh OAuth Services is not allowed', { method: 'refreshOAuthService', action: 'Refreshing_OAuth_Services' });\n\t\t}\n\n\t\tServiceConfiguration.configurations.remove({});\n\n\t\tRocketChat.models.Settings.update({_id: /^Accounts_OAuth_.+/}, {$set: {_updatedAt: new Date}}, {multi: true});\n\t}\n});\n","Meteor.methods({\n\taddUserToRoom(data) {\n\t\treturn Meteor.call('addUsersToRoom', {\n\t\t\trid: data.rid,\n\t\t\tusers: [ data.username ]\n\t\t});\n\t}\n});\n","Meteor.methods({\n\taddUsersToRoom(data = {}) {\n\t\t// Validate user and room\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (!Match.test(data.rid, String)) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\t// Get user and room details\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\t\tconst userId = Meteor.userId();\n\t\tconst user = Meteor.user();\n\t\tconst userInRoom = Array.isArray(room.usernames) && room.usernames.includes(user.username);\n\n\t\t// Can't add to direct room ever\n\t\tif (room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-cant-invite-for-direct-room', 'Can\\'t invite user to direct rooms', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\t// Can add to any room you're in, with permission, otherwise need specific room type permission\n\t\tlet canAddUser = false;\n\t\tif (userInRoom && RocketChat.authz.hasPermission(userId, 'add-user-to-joined-room', room._id)) {\n\t\t\tcanAddUser = true;\n\t\t} else if (room.t === 'c' && RocketChat.authz.hasPermission(userId, 'add-user-to-any-c-room')) {\n\t\t\tcanAddUser = true;\n\t\t} else if (room.t === 'p' && RocketChat.authz.hasPermission(userId, 'add-user-to-any-p-room')) {\n\t\t\tcanAddUser = true;\n\t\t}\n\n\t\t// Adding wasn't allowed\n\t\tif (!canAddUser) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\t// Missing the users to be added\n\t\tif (!Array.isArray(data.users)) {\n\t\t\tthrow new Meteor.Error('error-invalid-arguments', 'Invalid arguments', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\t// Validate each user, then add to room\n\t\tdata.users.forEach((username) => {\n\t\t\tconst newUser = RocketChat.models.Users.findOneByUsername(username);\n\t\t\tif (!newUser) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-username', 'Invalid username', {\n\t\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.addUserToRoom(data.rid, newUser, user);\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tarchiveRoom(rid) {\n\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'archiveRoom' });\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'archiveRoom' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'archive-room', room._id)) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', { method: 'archiveRoom' });\n\t\t}\n\n\t\tif (room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-direct-message-room', 'Direct Messages can not be archived', { method: 'archiveRoom' });\n\t\t}\n\n\t\treturn RocketChat.archiveRoom(rid);\n\t}\n});\n","Meteor.methods({\n\tblockUser({rid, blocked}) {\n\n\t\tcheck(rid, String);\n\t\tcheck(blocked, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'blockUser' });\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, Meteor.userId());\n\t\tconst subscription2 = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, blocked);\n\n\t\tif (!subscription || !subscription2) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'blockUser' });\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.setBlockedByRoomId(rid, blocked, Meteor.userId());\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tcheckRegistrationSecretURL(hash) {\n\n\t\tcheck(hash, String);\n\n\t\treturn hash === RocketChat.settings.get('Accounts_RegistrationForm_SecretURL');\n\t}\n});\n","Meteor.methods({\n\tcheckUsernameAvailability(username) {\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setUsername' });\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (user.username && !RocketChat.settings.get('Accounts_AllowUsernameChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'setUsername' });\n\t\t}\n\n\t\tif (user.username === username) {\n\t\t\treturn true;\n\t\t}\n\t\treturn RocketChat.checkUsernameAvailability(username);\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('checkUsernameAvailability', 1, 1000, {\n\tuserId() { return true; }\n});\n","Meteor.methods({\n\tcleanChannelHistory({roomId, latest, oldest, inclusive}) {\n\t\tcheck(roomId, String);\n\t\tcheck(latest, Date);\n\t\tcheck(oldest, Date);\n\t\tcheck(inclusive, Boolean);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'cleanChannelHistory' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'clean-channel-history')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'cleanChannelHistory' });\n\t\t}\n\n\t\tif (inclusive) {\n\t\t\tRocketChat.models.Messages.remove({\n\t\t\t\trid: roomId,\n\t\t\t\tts: {\n\t\t\t\t\t$gte: oldest,\n\t\t\t\t\t$lte: latest\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tRocketChat.models.Messages.remove({\n\t\t\t\trid: roomId,\n\t\t\t\tts: {\n\t\t\t\t\t$gt: oldest,\n\t\t\t\t\t$lt: latest\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tcreateChannel(name, members, readOnly = false, customFields = {}) {\n\t\tcheck(name, String);\n\t\tcheck(members, Match.Optional([String]));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'createChannel' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-c')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'createChannel' });\n\t\t}\n\n\t\treturn RocketChat.createRoom('c', name, Meteor.user() && Meteor.user().username, members, readOnly, {customFields});\n\t}\n});\n","Meteor.methods({\n\tcreateToken(userId) {\n\t\tif (Meteor.userId() !== userId && !RocketChat.authz.hasPermission(Meteor.userId(), 'user-generate-access-token')) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', { method: 'createToken' });\n\t\t}\n\t\tconst token = Accounts._generateStampedLoginToken();\n\t\tAccounts._insertLoginToken(userId, token);\n\t\treturn {\n\t\t\tuserId,\n\t\t\tauthToken: token.token\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tcreatePrivateGroup(name, members, readOnly = false, customFields = {}, extraData = {}) {\n\t\tcheck(name, String);\n\t\tcheck(members, Match.Optional([String]));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'createPrivateGroup' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-p')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'createPrivateGroup' });\n\t\t}\n\n\t\t// validate extra data schema\n\t\tcheck(extraData, Match.ObjectIncluding({\n\t\t\ttokenpass: Match.Maybe({\n\t\t\t\trequire: String,\n\t\t\t\ttokens: [{\n\t\t\t\t\ttoken: String,\n\t\t\t\t\tbalance: String\n\t\t\t\t}]\n\t\t\t})\n\t\t}));\n\n\t\treturn RocketChat.createRoom('p', name, Meteor.user() && Meteor.user().username, members, readOnly, {customFields, ...extraData});\n\t}\n});\n","import moment from 'moment';\n\nMeteor.methods({\n\tdeleteMessage(message) {\n\t\tcheck(message, Match.ObjectIncluding({\n\t\t\t_id: String\n\t\t}));\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteMessage'\n\t\t\t});\n\t\t}\n\t\tconst originalMessage = RocketChat.models.Messages.findOneById(message._id, {\n\t\t\tfields: {\n\t\t\t\tu: 1,\n\t\t\t\trid: 1,\n\t\t\t\tfile: 1,\n\t\t\t\tts: 1\n\t\t\t}\n\t\t});\n\t\tif (originalMessage == null) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteMessage',\n\t\t\t\taction: 'Delete_message'\n\t\t\t});\n\t\t}\n\t\tconst forceDelete = RocketChat.authz.hasPermission(Meteor.userId(), 'force-delete-message', originalMessage.rid);\n\t\tconst hasPermission = RocketChat.authz.hasPermission(Meteor.userId(), 'delete-message', originalMessage.rid);\n\t\tconst deleteAllowed = RocketChat.settings.get('Message_AllowDeleting');\n\t\tconst deleteOwn = originalMessage && originalMessage.u && originalMessage.u._id === Meteor.userId();\n\t\tif (!(hasPermission || (deleteAllowed && deleteOwn)) && !(forceDelete)) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteMessage',\n\t\t\t\taction: 'Delete_message'\n\t\t\t});\n\t\t}\n\t\tconst blockDeleteInMinutes = RocketChat.settings.get('Message_AllowDeleting_BlockDeleteInMinutes');\n\t\tif (blockDeleteInMinutes != null && blockDeleteInMinutes !== 0 && !forceDelete) {\n\t\t\tif (originalMessage.ts == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst msgTs = moment(originalMessage.ts);\n\t\t\tif (msgTs == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst currentTsDiff = moment().diff(msgTs, 'minutes');\n\t\t\tif (currentTsDiff > blockDeleteInMinutes) {\n\t\t\t\tthrow new Meteor.Error('error-message-deleting-blocked', 'Message deleting is blocked', {\n\t\t\t\t\tmethod: 'deleteMessage'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn RocketChat.deleteMessage(originalMessage, Meteor.user());\n\t}\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tdeleteUserOwnAccount(password) {\n\n\t\tcheck(password, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'deleteUserOwnAccount' });\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowDeleteOwnAccount')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'deleteUserOwnAccount' });\n\t\t}\n\n\t\tconst userId = Meteor.userId();\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'deleteUserOwnAccount' });\n\t\t}\n\n\t\tif (user.services && user.services.password && s.trim(user.services.password.bcrypt)) {\n\t\t\tconst result = Accounts._checkPassword(user, { digest: password, algorithm: 'sha-256' });\n\t\t\tif (result.error) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', { method: 'deleteUserOwnAccount' });\n\t\t\t}\n\t\t} else if (user.username !== s.trim(password)) {\n\t\t\tthrow new Meteor.Error('error-invalid-username', 'Invalid username', { method: 'deleteUserOwnAccount' });\n\t\t}\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.deleteUser(userId);\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","const Filter = Npm.require('bad-words');\n\nRocketChat.callbacks.add('beforeSaveMessage', function(message) {\n\n\tif (RocketChat.settings.get('Message_AllowBadWordsFilter')) {\n\t\tconst badWordsList = RocketChat.settings.get('Message_BadWordsFilterList');\n\t\tlet options;\n\n\t\t// Add words to the blacklist\n\t\tif (!!badWordsList && badWordsList.length) {\n\t\t\toptions = {\n\t\t\t\tlist: badWordsList.split(',')\n\t\t\t};\n\t\t}\n\t\tconst filter = new Filter(options);\n\t\tmessage.msg = filter.clean(message.msg);\n\t}\n\n\treturn message;\n\n}, 1, 'filterBadWords');\n","import _ from 'underscore';\n\nRocketChat.callbacks.add('beforeSaveMessage', function(message) {\n\t// Test if the message mentions include @all.\n\tif (message.mentions != null &&\n\t\t_.pluck(message.mentions, '_id').some((item) => item === 'all')) {\n\n\t\t// Check if the user has permissions to use @all in both global and room scopes.\n\t\tif (!RocketChat.authz.hasPermission(message.u._id, 'mention-all') && !RocketChat.authz.hasPermission(message.u._id, 'mention-all', message.rid)) {\n\n\t\t\t// Get the language of the user for the error notification.\n\t\t\tconst language = RocketChat.models.Users.findOneById(message.u._id).language;\n\t\t\tconst action = TAPi18n.__('Notify_all_in_this_room', {}, language);\n\n\t\t\t// Add a notification to the chat, informing the user that this\n\t\t\t// action is not allowed.\n\t\t\tRocketChat.Notifications.notifyUser(message.u._id, 'message', {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: message.rid,\n\t\t\t\tts: new Date,\n\t\t\t\tmsg: TAPi18n.__('error-action-not-allowed', { action }, language)\n\t\t\t});\n\n\t\t\t// Also throw to stop propagation of 'sendMessage'.\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Notify all in this room not allowed', {\n\t\t\t\tmethod: 'filterATAllTag',\n\t\t\t\taction: 'Notify_all_in_this_room'\n\t\t\t});\n\t\t}\n\t}\n\n\treturn message;\n\n}, 1, 'filterATAllTag');\n","import _ from 'underscore';\n\nMeteor.methods({\n\tgetChannelHistory({rid, latest, oldest, inclusive, count = 20, unreads}) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getChannelHistory' });\n\t\t}\n\n\t\tconst fromUserId = Meteor.userId();\n\t\tconst room = Meteor.call('canAccessRoom', rid, fromUserId);\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\t//Make sure they can access the room\n\t\tif (room.t === 'c' && !RocketChat.authz.hasPermission(fromUserId, 'preview-c-room') && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\t//Ensure latest is always defined.\n\t\tif (_.isUndefined(latest)) {\n\t\t\tlatest = new Date();\n\t\t}\n\n\t\t//Verify oldest is a date if it exists\n\t\tif (!_.isUndefined(oldest) && !_.isDate(oldest)) {\n\t\t\tthrow new Meteor.Error('error-invalid-date', 'Invalid date', { method: 'getChannelHistory' });\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: count\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = { 'editedAt': 0 };\n\t\t}\n\n\t\tlet records = [];\n\t\tif (_.isUndefined(oldest) && inclusive) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestampInclusive(rid, latest, options).fetch();\n\t\t} else if (_.isUndefined(oldest) && !inclusive) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestamp(rid, latest, options).fetch();\n\t\t} else if (!_.isUndefined(oldest) && inclusive) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestampsInclusive(rid, oldest, latest, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestamps(rid, oldest, latest, options).fetch();\n\t\t}\n\n\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\tconst messages = _.map(records, (message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, { _id: fromUserId });\n\t\t\tif (message.u && message.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(message.u._id);\n\t\t\t\tmessage.u.name = user && user.name;\n\t\t\t}\n\t\t\tif (message.mentions && message.mentions.length && UI_Use_Real_Name) {\n\t\t\t\tmessage.mentions.forEach((mention) => {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\t\t\t\tmention.name = user && user.name;\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn message;\n\t\t});\n\n\t\tif (unreads) {\n\t\t\tlet unreadNotLoaded = 0;\n\t\t\tlet firstUnread = undefined;\n\n\t\t\tif (!_.isUndefined(oldest)) {\n\t\t\t\tconst firstMsg = messages[messages.length - 1];\n\t\t\t\tif (!_.isUndefined(firstMsg) && firstMsg.ts > oldest) {\n\t\t\t\t\tconst unreadMessages = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestamps(rid, oldest, firstMsg.ts, { limit: 1, sort: { ts: 1 } });\n\t\t\t\t\tfirstUnread = unreadMessages.fetch()[0];\n\t\t\t\t\tunreadNotLoaded = unreadMessages.count();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tmessages: messages || [],\n\t\t\t\tfirstUnread,\n\t\t\t\tunreadNotLoaded\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tmessages: messages || []\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tgetFullUserData({ filter = '', limit }) {\n\t\tconst result = RocketChat.getFullUserData({ userId: Meteor.userId(), filter, limit });\n\n\t\tif (!result) {\n\t\t\treturn result;\n\t\t}\n\n\t\treturn result.fetch();\n\t}\n});\n","Meteor.methods({\n\tgetRoomJoinCode(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getJoinCode' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'view-join-code')) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', { method: 'getJoinCode' });\n\t\t}\n\n\t\tconst [ room ] = RocketChat.models.Rooms.findById(rid).fetch();\n\n\t\treturn room && room.joinCode;\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tgetRoomRoles(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getRoomRoles' });\n\t\t}\n\n\t\tcheck(rid, String);\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\t'u.username': 1\n\t\t\t},\n\t\t\tfields: {\n\t\t\t\trid: 1,\n\t\t\t\tu: 1,\n\t\t\t\troles: 1\n\t\t\t}\n\t\t};\n\n\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\tconst roles = RocketChat.models.Roles.find({ scope: 'Subscriptions', description: { $exists: 1, $ne: '' } }).fetch();\n\t\tconst subscriptions = RocketChat.models.Subscriptions.findByRoomIdAndRoles(rid, _.pluck(roles, '_id'), options).fetch();\n\n\t\tif (!UI_Use_Real_Name) {\n\t\t\treturn subscriptions;\n\t\t} else {\n\t\t\treturn subscriptions.map(subscription => {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(subscription.u._id);\n\t\t\t\tsubscription.u.name = user && user.name;\n\t\t\t\treturn subscription;\n\t\t\t});\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tgetServerInfo() {\n\t\treturn RocketChat.Info;\n\t}\n});\n","Meteor.methods({\n\tgetSingleMessage(msgId) {\n\t\tcheck(msgId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getSingleMessage' });\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(msgId);\n\n\t\tif (!msg && !msg.rid) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tMeteor.call('canAccessRoom', msg.rid, Meteor.userId());\n\n\t\treturn msg;\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tgetUserRoles() {\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getUserRoles' });\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\t'username': 1\n\t\t\t},\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\troles: 1\n\t\t\t}\n\t\t};\n\n\t\tconst roles = RocketChat.models.Roles.find({ scope: 'Users', description: { $exists: 1, $ne: '' } }).fetch();\n\t\tconst roleIds = _.pluck(roles, '_id');\n\n\t\t// Security issue: we should not send all user's roles to all clients, only the 'public' roles\n\t\t// We must remove all roles that are not part of the query from the returned users\n\t\tconst users = RocketChat.models.Users.findUsersInRoles(roleIds, null, options).fetch();\n\t\tfor (const user of users) {\n\t\t\tuser.roles = _.intersection(user.roles, roleIds);\n\t\t}\n\t\treturn users;\n\t}\n});\n","Meteor.methods({\n\tinsertOrUpdateUser(userData) {\n\n\t\tcheck(userData, Object);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'insertOrUpdateUser' });\n\t\t}\n\n\t\treturn RocketChat.saveUser(Meteor.userId(), userData);\n\t}\n});\n","Meteor.methods({\n\tjoinDefaultChannels(silenced) {\n\t\tcheck(silenced, Match.Optional(Boolean));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'joinDefaultChannels' });\n\t\t}\n\n\t\tthis.unblock();\n\t\treturn RocketChat.addUserToDefaultChannels(Meteor.user(), silenced);\n\t}\n});\n","Meteor.methods({\n\tjoinRoom(rid, code) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'joinRoom' });\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'joinRoom' });\n\t\t}\n\n\t\t// TODO we should have a 'beforeJoinRoom' call back so external services can do their own validations\n\t\tconst user = Meteor.user();\n\t\tif (room.tokenpass && user && user.services && user.services.tokenpass) {\n\t\t\tconst balances = RocketChat.updateUserTokenpassBalances(user);\n\n\t\t\tif (!RocketChat.Tokenpass.validateAccess(room.tokenpass, balances)) {\n\t\t\t\tthrow new Meteor.Error('error-not-allowed', 'Token required', { method: 'joinRoom' });\n\t\t\t}\n\t\t} else {\n\t\t\tif ((room.t !== 'c') || (RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room') !== true)) {\n\t\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'joinRoom' });\n\t\t\t}\n\n\t\t\tif ((room.joinCodeRequired === true) && (code !== room.joinCode) && !RocketChat.authz.hasPermission(Meteor.userId(), 'join-without-join-code')) {\n\t\t\t\tthrow new Meteor.Error('error-code-invalid', 'Invalid Room Password', { method: 'joinRoom' });\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.addUserToRoom(rid, user);\n\t}\n});\n","Meteor.methods({\n\tleaveRoom(rid) {\n\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'leaveRoom' });\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\tconst user = Meteor.user();\n\n\t\tif (room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'leaveRoom' });\n\t\t}\n\n\t\tif (!Array.from(room.usernames || []).includes(user.username)) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'You are not in this room', { method: 'leaveRoom' });\n\t\t}\n\n\t\t// If user is room owner, check if there are other owners. If there isn't anyone else, warn user to set a new owner.\n\t\tif (RocketChat.authz.hasRole(user._id, 'owner', room._id)) {\n\t\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', room._id).fetch().length;\n\t\t\tif (numOwners === 1) {\n\t\t\t\tthrow new Meteor.Error('error-you-are-last-owner', 'You are the last owner. Please set new owner before leaving the room.', { method: 'leaveRoom' });\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.removeUserFromRoom(rid, Meteor.user());\n\t}\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tremoveOAuthService(name) {\n\n\t\tcheck(name, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'removeOAuthService' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'add-oauth-service') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'removeOAuthService' });\n\t\t}\n\n\t\tname = name.toLowerCase().replace(/[^a-z0-9_]/g, '');\n\t\tname = s.capitalize(name);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-url`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-token_path`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-identity_path`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-authorize_path`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-scope`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-token_sent_via`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-identity_token_sent_via`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-id`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-secret`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-button_label_text`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-button_label_color`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-button_color`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-login_style`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-username_field`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-merge_users`);\n\t}\n});\n","Meteor.methods({\n\trestart_server() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'restart_server' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasRole(Meteor.userId(), 'admin') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'restart_server' });\n\t\t}\n\n\t\tMeteor.setTimeout(() => {\n\t\t\tMeteor.setTimeout(() => {\n\t\t\t\tconsole.warn('Call to process.exit() timed out, aborting.');\n\t\t\t\tprocess.abort();\n\t\t\t}, 1000);\n\t\t\tprocess.exit(1);\n\t\t}, 1000);\n\n\t\treturn {\n\t\t\tmessage: 'The_server_will_restart_in_s_seconds',\n\t\t\tparams: [2]\n\t\t};\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\t'robot.modelCall'(model, method, args) {\n\t\tcheck(model, String);\n\t\tcheck(method, String);\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'robot.modelCall'\n\t\t\t});\n\t\t}\n\t\tif (!RocketChat.authz.hasRole(Meteor.userId(), 'robot')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'robot.modelCall'\n\t\t\t});\n\t\t}\n\t\tconst m = RocketChat.models[model];\n\n\t\tif (!m || !_.isFunction(m[method])) {\n\t\t\tthrow new Meteor.Error('error-invalid-method', 'Invalid method', {\n\t\t\t\tmethod: 'robot.modelCall'\n\t\t\t});\n\t\t}\n\t\tconst cursor = RocketChat.models[model][method].apply(RocketChat.models[model], args);\n\t\treturn cursor && cursor.fetch ? cursor.fetch() : cursor;\n\t}\n});\n","/* eslint new-cap: 0 */\n\nMeteor.methods({\n\tsaveSetting(_id, value, editor) {\n\t\tif (Meteor.userId() === null) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing settings is not allowed', {\n\t\t\t\tmethod: 'saveSetting'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'edit-privileged-setting')) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing settings is not allowed', {\n\t\t\t\tmethod: 'saveSetting'\n\t\t\t});\n\t\t}\n\n\t\t//Verify the _id passed in is a string.\n\t\tcheck(_id, String);\n\n\t\tconst setting = RocketChat.models.Settings.db.findOneById(_id);\n\n\t\t//Verify the value is what it should be\n\t\tswitch (setting.type) {\n\t\t\tcase 'roomPick':\n\t\t\t\tcheck(value, Match.OneOf([Object], ''));\n\t\t\t\tbreak;\n\t\t\tcase 'boolean':\n\t\t\t\tcheck(value, Boolean);\n\t\t\t\tbreak;\n\t\t\tcase 'int':\n\t\t\t\tcheck(value, Number);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tcheck(value, String);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tRocketChat.settings.updateById(_id, value, editor);\n\t\treturn true;\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tsendInvitationEmail(emails) {\n\t\tcheck(emails, [String]);\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'sendInvitationEmail'\n\t\t\t});\n\t\t}\n\t\tif (!RocketChat.authz.hasRole(Meteor.userId(), 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'sendInvitationEmail'\n\t\t\t});\n\t\t}\n\t\tconst rfcMailPattern = /^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n\t\tconst validEmails = _.compact(_.map(emails, function(email) {\n\t\t\tif (rfcMailPattern.test(email)) {\n\t\t\t\treturn email;\n\t\t\t}\n\t\t}));\n\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\t\tlet html;\n\t\tlet subject;\n\t\tconst user = Meteor.user();\n\t\tconst lng = user.language || RocketChat.settings.get('language') || 'en';\n\t\tif (RocketChat.settings.get('Invitation_Customized')) {\n\t\t\tsubject = RocketChat.settings.get('Invitation_Subject');\n\t\t\thtml = RocketChat.settings.get('Invitation_HTML');\n\t\t} else {\n\t\t\tsubject = TAPi18n.__('Invitation_Subject_Default', {\n\t\t\t\tlng\n\t\t\t});\n\t\t\thtml = TAPi18n.__('Invitation_HTML_Default', {\n\t\t\t\tlng\n\t\t\t});\n\t\t}\n\t\tsubject = RocketChat.placeholders.replace(subject);\n\t\tvalidEmails.forEach(email => {\n\t\t\tthis.unblock();\n\t\t\thtml = RocketChat.placeholders.replace(html, {\n\t\t\t\temail\n\t\t\t});\n\t\t\ttry {\n\t\t\t\tEmail.send({\n\t\t\t\t\tto: email,\n\t\t\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\t\t\tsubject,\n\t\t\t\t\thtml: header + html + footer\n\t\t\t\t});\n\t\t\t} catch ({message}) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ message }`, {\n\t\t\t\t\tmethod: 'sendInvitationEmail',\n\t\t\t\t\tmessage\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn validEmails;\n\t}\n});\n","import moment from 'moment';\n\nMeteor.methods({\n\tsendMessage(message) {\n\t\tcheck(message, Object);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'sendMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (message.ts) {\n\t\t\tconst tsDiff = Math.abs(moment(message.ts).diff());\n\t\t\tif (tsDiff > 60000) {\n\t\t\t\tthrow new Meteor.Error('error-message-ts-out-of-sync', 'Message timestamp is out of sync', {\n\t\t\t\t\tmethod: 'sendMessage',\n\t\t\t\t\tmessage_ts: message.ts,\n\t\t\t\t\tserver_ts: new Date().getTime()\n\t\t\t\t});\n\t\t\t} else if (tsDiff > 10000) {\n\t\t\t\tmessage.ts = new Date();\n\t\t\t}\n\t\t} else {\n\t\t\tmessage.ts = new Date();\n\t\t}\n\n\t\tif (message.msg && message.msg.length > RocketChat.settings.get('Message_MaxAllowedSize')) {\n\t\t\tthrow new Meteor.Error('error-message-size-exceeded', 'Message size exceeds Message_MaxAllowedSize', {\n\t\t\t\tmethod: 'sendMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(Meteor.userId(), {\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tname: 1\n\t\t\t}\n\t\t});\n\n\t\tconst room = Meteor.call('canAccessRoom', message.rid, user._id);\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(message.rid, Meteor.userId());\n\t\tif (subscription && subscription.blocked || subscription.blocker) {\n\t\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: room._id,\n\t\t\t\tts: new Date,\n\t\t\t\tmsg: TAPi18n.__('room_is_blocked', {}, user.language)\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\n\t\tif ((room.muted||[]).includes(user.username)) {\n\t\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: room._id,\n\t\t\t\tts: new Date,\n\t\t\t\tmsg: TAPi18n.__('You_have_been_muted', {}, user.language)\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\n\t\tif (message.alias == null && RocketChat.settings.get('Message_SetNameToAliasEnabled')) {\n\t\t\tmessage.alias = user.name;\n\t\t}\n\n\t\tif (Meteor.settings['public'].sandstorm) {\n\t\t\tmessage.sandstormSessionId = this.connection.sandstormSessionId();\n\t\t}\n\n\t\tRocketChat.metrics.messagesSent.inc(); // TODO This line needs to be moved to it's proper place. See the comments on: https://github.com/RocketChat/Rocket.Chat/pull/5736\n\t\treturn RocketChat.sendMessage(user, message, room);\n\t}\n});\n// Limit a user, who does not have the \"bot\" role, to sending 5 msgs/second\nRocketChat.RateLimiter.limitMethod('sendMessage', 5, 1000, {\n\tuserId(userId) {\n\t\treturn !RocketChat.authz.hasPermission(userId, 'send-many-messages');\n\t}\n});\n","Meteor.methods({\n\tsendSMTPTestEmail() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'sendSMTPTestEmail'\n\t\t\t});\n\t\t}\n\t\tconst user = Meteor.user();\n\t\tif (!user.emails && !user.emails[0] && user.emails[0].address) {\n\t\t\tthrow new Meteor.Error('error-invalid-email', 'Invalid email', {\n\t\t\t\tmethod: 'sendSMTPTestEmail'\n\t\t\t});\n\t\t}\n\t\tthis.unblock();\n\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\t\tconsole.log(`Sending test email to ${ user.emails[0].address }`);\n\t\ttry {\n\t\t\tEmail.send({\n\t\t\t\tto: user.emails[0].address,\n\t\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\t\tsubject: 'SMTP Test Email',\n\t\t\t\thtml: `${ header }<p>You have successfully sent an email</p>${ footer }`\n\t\t\t});\n\t\t} catch ({message}) {\n\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ message }`, {\n\t\t\t\tmethod: 'sendSMTPTestEmail',\n\t\t\t\tmessage\n\t\t\t});\n\t\t}\n\t\treturn {\n\t\t\tmessage: 'Your_mail_was_sent_to_s',\n\t\t\tparams: [user.emails[0].address]\n\t\t};\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'sendSMTPTestEmail',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 1000);\n","Meteor.methods({\n\tsetAdminStatus(userId, admin) {\n\n\t\tcheck(userId, String);\n\t\tcheck(admin, Match.Optional(Boolean));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setAdminStatus' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'assign-admin-role') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'setAdminStatus' });\n\t\t}\n\n\t\tconst user = Meteor.users.findOne({ _id: userId }, { fields: { username: 1 } });\n\n\t\tif (admin) {\n\t\t\treturn Meteor.call('authorization:addUserToRole', 'admin', user.username);\n\t\t} else {\n\t\t\treturn Meteor.call('authorization:removeUserFromRole', 'admin', user.username);\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tsetRealName(name) {\n\n\t\tcheck(name, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setRealName' });\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowRealNameChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'setRealName' });\n\t\t}\n\n\t\tif (!RocketChat.setRealName(Meteor.userId(), name)) {\n\t\t\tthrow new Meteor.Error('error-could-not-change-name', 'Could not change name', { method: 'setRealName' });\n\t\t}\n\n\t\treturn name;\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('setRealName', 1, 1000, {\n\tuserId: () => true\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tsetUsername(username, param = {}) {\n\t\tconst { joinDefaultChannelsSilenced } = param;\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setUsername' });\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (user.username && !RocketChat.settings.get('Accounts_AllowUsernameChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'setUsername' });\n\t\t}\n\n\t\tif (user.username === username || (user.username && user.username.toLowerCase() === username.toLowerCase())) {\n\t\t\treturn username;\n\t\t}\n\n\t\tlet nameValidation;\n\t\ttry {\n\t\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t\t} catch (error) {\n\t\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t\t}\n\n\t\tif (!nameValidation.test(username)) {\n\t\t\tthrow new Meteor.Error('username-invalid', `${ _.escape(username) } is not a valid username, use only letters, numbers, dots, hyphens and underscores`);\n\t\t}\n\n\t\tif (!RocketChat.checkUsernameAvailability(username)) {\n\t\t\tthrow new Meteor.Error('error-field-unavailable', `<strong>${ _.escape(username) }</strong> is already in use :(`, { method: 'setUsername', field: username });\n\t\t}\n\n\t\tif (!RocketChat.setUsername(user._id, username)) {\n\t\t\tthrow new Meteor.Error('error-could-not-change-username', 'Could not change username', { method: 'setUsername' });\n\t\t}\n\n\t\tif (!user.username) {\n\t\t\tMeteor.runAsUser(user._id, () => Meteor.call('joinDefaultChannels', joinDefaultChannelsSilenced));\n\t\t\tMeteor.defer(function() {\n\t\t\t\treturn RocketChat.callbacks.run('afterCreateUser', RocketChat.models.Users.findOneById(user._id));\n\t\t\t});\n\t\t}\n\n\t\treturn username;\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('setUsername', 1, 1000, {\n\tuserId() { return true; }\n});\n","Meteor.methods({\n\tsetEmail(email) {\n\n\t\tcheck (email, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setEmail' });\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowEmailChange')) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Changing email is not allowed', { method: 'setEmail', action: 'Changing_email' });\n\t\t}\n\n\t\tif (user.emails && user.emails[0] && user.emails[0].address === email) {\n\t\t\treturn email;\n\t\t}\n\n\t\tif (!RocketChat.setEmail(user._id, email)) {\n\t\t\tthrow new Meteor.Error('error-could-not-change-email', 'Could not change email', { method: 'setEmail' });\n\t\t}\n\n\t\treturn email;\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('setEmail', 1, 1000, {\n\tuserId(/*userId*/) { return true; }\n});\n","Meteor.methods({\n\tunarchiveRoom(rid) {\n\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'unarchiveRoom' });\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'unarchiveRoom' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'unarchive-room', room._id)) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', { method: 'unarchiveRoom' });\n\t\t}\n\n\t\treturn RocketChat.unarchiveRoom(rid);\n\t}\n});\n","Meteor.methods({\n\tunblockUser({rid, blocked}) {\n\n\t\tcheck(rid, String);\n\t\tcheck(blocked, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'blockUser' });\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, Meteor.userId());\n\t\tconst subscription2 = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, blocked);\n\n\t\tif (!subscription || !subscription2) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'blockUser' });\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.unsetBlockedByRoomId(rid, blocked, Meteor.userId());\n\n\t\treturn true;\n\t}\n});\n","import moment from 'moment';\n\nMeteor.methods({\n\tupdateMessage(message) {\n\n\t\tcheck(message, Match.ObjectIncluding({_id:String}));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'updateMessage' });\n\t\t}\n\n\t\tconst originalMessage = RocketChat.models.Messages.findOneById(message._id);\n\n\t\tif (!originalMessage || !originalMessage._id) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst hasPermission = RocketChat.authz.hasPermission(Meteor.userId(), 'edit-message', message.rid);\n\t\tconst editAllowed = RocketChat.settings.get('Message_AllowEditing');\n\t\tconst editOwn = originalMessage.u && originalMessage.u._id === Meteor.userId();\n\n\t\tif (!hasPermission && (!editAllowed || !editOwn)) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Message editing not allowed', { method: 'updateMessage', action: 'Message_editing' });\n\t\t}\n\n\t\tconst blockEditInMinutes = RocketChat.settings.get('Message_AllowEditing_BlockEditInMinutes');\n\t\tif (Match.test(blockEditInMinutes, Number) && blockEditInMinutes !== 0) {\n\t\t\tlet currentTsDiff;\n\t\t\tlet msgTs;\n\n\t\t\tif (Match.test(originalMessage.ts, Number)) {\n\t\t\t\tmsgTs = moment(originalMessage.ts);\n\t\t\t}\n\t\t\tif (msgTs) {\n\t\t\t\tcurrentTsDiff = moment().diff(msgTs, 'minutes');\n\t\t\t}\n\t\t\tif (currentTsDiff > blockEditInMinutes) {\n\t\t\t\tthrow new Meteor.Error('error-message-editing-blocked', 'Message editing is blocked', { method: 'updateMessage' });\n\t\t\t}\n\t\t}\n\n\t\t// It is possible to have an empty array as the attachments property, so ensure both things exist\n\t\tif (originalMessage.attachments && originalMessage.attachments.length > 0 && originalMessage.attachments[0].description !== undefined) {\n\t\t\tmessage.attachments = originalMessage.attachments;\n\t\t\tmessage.attachments[0].description = message.msg;\n\t\t\tmessage.msg = originalMessage.msg;\n\t\t}\n\n\t\tmessage.u = originalMessage.u;\n\n\t\treturn RocketChat.updateMessage(message, Meteor.user());\n\t}\n});\n","import {\n\tChannelsRoomType,\n\tConversationRoomType,\n\tDirectMessageRoomType,\n\tFavoriteRoomType,\n\tPrivateRoomType,\n\tPublicRoomType,\n\tUnreadRoomType\n} from '../lib/roomTypes';\n\nRocketChat.roomTypes.add(new UnreadRoomType());\nRocketChat.roomTypes.add(new FavoriteRoomType());\nRocketChat.roomTypes.add(new ConversationRoomType());\nRocketChat.roomTypes.add(new ChannelsRoomType());\nRocketChat.roomTypes.add(new PublicRoomType());\nRocketChat.roomTypes.add(new PrivateRoomType());\nRocketChat.roomTypes.add(new DirectMessageRoomType());\n"]}