{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:sms/settings.js","meteor://ðŸ’»app/packages/rocketchat:sms/SMS.js","meteor://ðŸ’»app/packages/rocketchat:sms/services/twilio.js"],"names":["Meteor","startup","RocketChat","settings","addGroup","add","type","i18nLabel","values","key","section","enableQuery","_id","value","SMS","enabled","services","accountSid","authToken","fromNumber","registerService","name","service","getService","Error","get","Twilio","constructor","parse","data","from","From","to","To","body","Body","extra","toCountry","ToCountry","toState","ToState","toCity","ToCity","toZip","ToZip","fromCountry","FromCountry","fromState","FromState","fromCity","FromCity","fromZip","FromZip","send","toNumber","message","client","Npm","require","messages","create","response","headers","error","reason"],"mappings":"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","file":"/packages/rocketchat_sms.js","sourcesContent":["Meteor.startup(function() {\n\tRocketChat.settings.addGroup('SMS', function() {\n\t\tthis.add('SMS_Enabled', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Enabled'\n\t\t});\n\n\t\tthis.add('SMS_Service', 'twilio', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [{\n\t\t\t\tkey: 'twilio',\n\t\t\t\ti18nLabel: 'Twilio'\n\t\t\t}],\n\t\t\ti18nLabel: 'Service'\n\t\t});\n\n\t\tthis.section('Twilio', function() {\n\t\t\tthis.add('SMS_Twilio_Account_SID', '', {\n\t\t\t\ttype: 'string',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'SMS_Service',\n\t\t\t\t\tvalue: 'twilio'\n\t\t\t\t},\n\t\t\t\ti18nLabel: 'Account_SID'\n\t\t\t});\n\t\t\tthis.add('SMS_Twilio_authToken', '', {\n\t\t\t\ttype: 'string',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'SMS_Service',\n\t\t\t\t\tvalue: 'twilio'\n\t\t\t\t},\n\t\t\t\ti18nLabel: 'Auth_Token'\n\t\t\t});\n\t\t});\n\t});\n});\n","/* globals RocketChat */\nRocketChat.SMS = {\n\tenabled: false,\n\tservices: {},\n\taccountSid: null,\n\tauthToken: null,\n\tfromNumber: null,\n\n\tregisterService(name, service) {\n\t\tthis.services[name] = service;\n\t},\n\n\tgetService(name) {\n\t\tif (!this.services[name]) {\n\t\t\tthrow new Meteor.Error('error-sms-service-not-configured');\n\t\t}\n\t\treturn new this.services[name](this.accountSid, this.authToken, this.fromNumber);\n\t}\n};\n\nRocketChat.settings.get('SMS_Enabled', function(key, value) {\n\tRocketChat.SMS.enabled = value;\n});\n","/* globals RocketChat */\nclass Twilio {\n\tconstructor() {\n\t\tthis.accountSid = RocketChat.settings.get('SMS_Twilio_Account_SID');\n\t\tthis.authToken = RocketChat.settings.get('SMS_Twilio_authToken');\n\t}\n\tparse(data) {\n\t\treturn {\n\t\t\tfrom: data.From,\n\t\t\tto: data.To,\n\t\t\tbody: data.Body,\n\n\t\t\textra: {\n\t\t\t\ttoCountry: data.ToCountry,\n\t\t\t\ttoState: data.ToState,\n\t\t\t\ttoCity: data.ToCity,\n\t\t\t\ttoZip: data.ToZip,\n\t\t\t\tfromCountry: data.FromCountry,\n\t\t\t\tfromState: data.FromState,\n\t\t\t\tfromCity: data.FromCity,\n\t\t\t\tfromZip: data.FromZip\n\t\t\t}\n\t\t};\n\t}\n\tsend(fromNumber, toNumber, message) {\n\t\tconst client = Npm.require('twilio')(this.accountSid, this.authToken);\n\n\t\tclient.messages.create({\n\t\t\tto: toNumber,\n\t\t\tfrom: fromNumber,\n\t\t\tbody: message\n\t\t});\n\t}\n\tresponse(/* message */) {\n\t\treturn {\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'text/xml'\n\t\t\t},\n\t\t\tbody: '<Response></Response>'\n\t\t};\n\t}\n\terror(error) {\n\t\tlet message = '';\n\t\tif (error.reason) {\n\t\t\tmessage = `<Message>${ error.reason }</Message>`;\n\t\t}\n\t\treturn {\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'text/xml'\n\t\t\t},\n\t\t\tbody: `<Response>${ message }</Response>`\n\t\t};\n\t}\n}\n\nRocketChat.SMS.registerService('twilio', Twilio);\n"]}